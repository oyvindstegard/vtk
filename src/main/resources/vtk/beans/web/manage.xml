<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd">

  <!-- Temporarily redirect ?vrtx=thumbnail on manage hostname to view hostname until editor is fixed to use thumbnail service
    to generate image URLs -->
  <bean id="manage.redirectThumbnails" class="vtk.web.service.ServiceImpl">
    <property name="order" value="-5" />
    <property name="assertions">
      <list>
        <bean class="vtk.web.service.InvertAssertion">
          <property name="assertion">
            <bean class="vtk.web.service.ConfigAssertion">
              <property name="config" value="${webHostName}" />
              <property name="expectedValue" value="${manage.hostName}" />
            </bean>
          </property>
        </bean>
        <ref bean="manage.hostNameAssertion" />
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="vrtx" />
          <property name="parameterValue" value="thumbnail" />
        </bean>
      </list>
    </property>
    <property name="handlerInterceptors">
      <list>
        <!-- Redirect to view hostname -->
        <bean class="vtk.web.interceptors.ConfigurableRedirector">
          <property name="hostName" value="${webHostName}" />
        </bean>
      </list>
    </property>
    <!-- Dummy handler that is never invoked (the handler interceptor will prevent it): -->
    <property name="handler">
      <bean class="org.springframework.web.servlet.mvc.ParameterizableViewController">
        <property name="viewName" value="HTTP_200_OK" />
      </bean>
    </property>
  </bean>


  <!-- Kicks in when webHostName != manage.hostName and missing ?vrtx=admin: -->
  <bean id="manage.redirectService" class="vtk.web.service.ServiceImpl">
    <property name="order" value="-2" />
    <property name="assertions">
      <list>
        <!-- Assert that webHostName is different from manage.hostName and missing vrtx=admin: -->
        <bean class="vtk.web.service.InvertAssertion">
          <property name="assertion">
            <bean class="vtk.web.service.ConfigAssertion">
              <property name="config" value="${webHostName}" />
              <property name="expectedValue" value="${manage.hostName}" />
            </bean>
          </property>
        </bean>
        <ref bean="manage.hostNameAssertion" />
        <bean class="vtk.web.service.InvertAssertion">
          <property name="assertion" ref="adminVrtxParameterRule" />
        </bean>
      </list>
    </property>
    <property name="handlerInterceptors">
      <list>
        <!-- Redirect to admin hostname with ?vrtx=admin -->
        <bean class="vtk.web.interceptors.ConfigurableRedirector">
          <property name="replacedParameters">
            <map>
              <entry key="vrtx" value="admin" />
            </map>
          </property>
        </bean>
      </list>
    </property>
    <!-- Dummy handler that is never invoked (the handler interceptor will prevent it): -->
    <property name="handler">
      <bean class="org.springframework.web.servlet.mvc.ParameterizableViewController">
        <property name="viewName" value="HTTP_200_OK" />
      </bean>
    </property>
  </bean>



  <!-- Kicks in when webHostName != manage.hostName and request.hostname = manage.hostname and manage.protocol == https and
    request.protocol == http: -->
  <bean id="manage.redirectToHTTPSService" class="vtk.web.service.ServiceImpl">
    <property name="order" value="-100" />
    <property name="assertions">
      <list>
        <bean class="vtk.web.service.InvertAssertion">
          <property name="assertion">
            <bean class="vtk.web.service.ConfigAssertion">
              <property name="config" value="${webHostName}" />
              <property name="expectedValue" value="${manage.hostName}" />
            </bean>
          </property>
        </bean>
        <ref bean="manage.hostNameAssertion" />

        <!-- protocol == http and manage.protocol = https -->
        <bean class="vtk.web.service.ConfigAssertion">
          <property name="config" value="${manage.protocol}" />
          <property name="expectedValue" value="https" />
        </bean>
        <bean class="vtk.web.service.RequestProtocolAssertion">
          <property name="protocol" value="http" />
        </bean>
      </list>
    </property>
    <property name="handlerInterceptors">
      <list>
        <!-- Redirect to manage hostname -->
        <bean class="vtk.web.interceptors.ConfigurableRedirector">
          <property name="protocol" value="${manage.protocol}" />
          <property name="hostName" value="${manage.hostName}" />
          <property name="port" value="${manage.port}" />
        </bean>
      </list>
    </property>
    <!-- Dummy handler that is never invoked (the handler interceptor will prevent it): -->
    <property name="handler">
      <bean class="org.springframework.web.servlet.mvc.ParameterizableViewController">
        <property name="viewName" value="HTTP_200_OK" />
      </bean>
    </property>
  </bean>



  <!-- MANAGE services -->
  <bean id="manageService" class="vtk.web.service.ServiceImpl">
    <property name="order" value="-1" />
    <property name="assertions">
      <list>
        <ref bean="manage.serviceAssertion" />
      </list>
    </property>
    <property name="urlPostProcessors" ref="manage.urlPostProcessors" />
    <property name="servletFilters">
      <list>
        <ref bean="system.csrfPreventionHandler" />
        <ref bean="system.decoratingFilter" />
      </list>
    </property>
    <property name="handlerInterceptors">
      <list>
        <bean class="vtk.web.FullDomainRedirectInterceptor">
          <property name="hostName" value="${manage.hostName}" />
        </bean>
        <bean class="vtk.web.interceptors.ServiceBasedHeaderControl">
          <property name="headers">
            <map>
              <entry key="X-FRAME-OPTIONS" value="SAMEORIGIN" />
            </map>
          </property>
          <property name="exceptionAttribute" value="manage.preventXFrameOptionsHeader" />
        </bean>
      </list>
    </property>
    <property name="attributes">
      <map>
        <entry key="localeResolver" value-ref="manageLocaleResolver" />
        <entry key-ref="system.decoratorTemplateAttribute" value="admin.html" />
        <entry key="inhibit-caching" value="true" />
      </map>
    </property>
    <property name="authenticationChallenge" ref="${webAuthenticationChallenge}" />
  </bean>


  <bean id="manage.serviceAssertion" class="vtk.web.service.AndAssertion">
    <property name="assertions">
      <list>
        <ref bean="manage.portAssertion" />
        <ref bean="manage.hostNameAssertion" />
        <ref bean="manage.protocolAssertion" />
        <ref bean="adminVrtxParameterRule" />
      </list>
    </property>
  </bean>

  <bean id="manage.urlPostProcessors" class="org.springframework.beans.factory.config.ListFactoryBean">
    <property name="sourceList">
      <list>
      </list>
    </property>
  </bean>


  <bean id="manage.protocolAssertion" class="vtk.web.service.RequestProtocolAssertion">
    <property name="protocol" value="${manage.protocol}" />
  </bean>


  <bean id="manage.resourceNotFoundService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="-10000" />
    <property name="assertions">
      <list>
        <bean class="vtk.web.service.InvertAssertion">
          <property name="assertion">
            <bean class="vtk.web.service.ResourceExistsAssertion" />
          </property>
        </bean>
      </list>
    </property>
    <property name="handler">
      <!-- Will throw ResourceNotFoundException which will be caught by manage error handler: -->
      <bean class="vtk.web.display.file.ResourceAwareParameterizableViewController">
        <property name="viewName" value="404" />
      </bean>
    </property>
    <property name="attributes">
      <map>
        <entry key-ref="system.decoratorTemplateAttribute" value="admin-error.html" />
      </map>
    </property>
  </bean>


  <bean id="manage.notAuthorizedService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="-9999" />
    <property name="assertions">
      <list>
        <bean class="vtk.web.service.InvertAssertion">
          <property name="assertion" ref="manage.permissionAssertion" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="manage.notAuthorizedHandler" />
    <property name="attributes">
      <map>
        <entry key-ref="system.decoratorTemplateAttribute" value="admin-error.html" />
      </map>
    </property>
  </bean>

  <bean id="manage.notAuthorizedHandler" 
        class="org.springframework.web.servlet.mvc.ParameterizableViewController">
    <property name="statusCode">
      <bean class="org.springframework.http.HttpStatus" factory-method="valueOf">
        <constructor-arg value="FORBIDDEN" />
      </bean>
    </property>
    <property name="viewName" value="manage.notAuthorizedView" />
  </bean>

  <bean id="manage.notAuthorizedView" parent="freemarkerView">
    <property name="url" value="pages/error/403.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
      </list>
    </property>
  </bean>
  

  <bean id="setNorwegianNBLocaleService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="-10000" />
    <property name="assertions">
      <list>
        <ref bean="requestLocaleNotNorwegianNB" />
        <ref bean="localeParameterEqualsNO" />
      </list>
    </property>
    <property name="handler" ref="setNorwegianNBLocaleController" />
  </bean>

  <bean id="setNorwegianNNLocaleService" class="vtk.web.service.ServiceImpl">

    <property name="parent" ref="manageService" />
    <property name="order" value="-10000" />
    <property name="assertions">
      <list>
        <ref bean="requestLocaleNotNorwegianNN" />
        <ref bean="localeParameterEqualsNN" />
      </list>
    </property>
    <property name="handler" ref="setNorwegianNNLocaleController" />
  </bean>

  <bean id="setEnglishLocaleService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="-10000" />
    <property name="assertions">
      <list>
        <ref bean="requestLocaleNotEnglish" />
        <ref bean="localeParameterEqualsEN" />
      </list>
    </property>
    <property name="handler" ref="setEnglishLocaleController" />
  </bean>

  <bean id="permissionsService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="attributes">
      <map>
        <entry key="tabOrder">
          <value type="java.lang.Integer">200</value>
        </entry>
      </map>
    </property>
    <property name="assertions">
      <bean class="vtk.web.service.RequestParameterAssertion">
        <property name="parameterName" value="mode" />
        <property name="parameterValue" value="permissions" />
      </bean>
    </property>
    <property name="handler" ref="permissionsHandler" />
  </bean>

  <bean parent="manage.tabsBuilder">
    <property name="arguments" ref="permissionsService" />
  </bean>

  <bean id="manage.refreshLockService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="assertions">
      <list>
        <ref bean="manage.refreshLockRequestParameter" />
      </list>
    </property>
    <property name="handler">
      <ref bean="manage.refreshLockHandler" />
    </property>
    <property name="attributes">
      <map>
        <entry key="x-prevent-decorating" value="true" />
      </map>
    </property>
  </bean>

  <bean id="aboutResourceService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="attributes">
      <map>
        <entry key="tabOrder">
          <value type="java.lang.Integer">400</value>
        </entry>
      </map>
    </property>
    <property name="assertions">
      <list>
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="mode" />
          <property name="parameterValue" value="about" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="aboutResourceHandler" />
  </bean>

  <bean parent="manage.tabsBuilder">
    <property name="arguments" ref="aboutResourceService" />
  </bean>

  <bean id="manageCollectionListingService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="1" />
    <property name="attributes">
      <map>
        <entry key="tabOrder">
          <value type="java.lang.Integer">0</value>
        </entry>
      </map>
    </property>
    <property name="assertions">
      <ref bean="resourceInCollection" />
    </property>
    <property name="handler" ref="manageCollectionListingHandler" />
  </bean>

  <bean parent="manage.tabsBuilder">
    <property name="arguments" ref="manageCollectionListingService" />
  </bean>


  <bean id="manage.unlockFormService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="assertions">
      <list>
        <bean class="vtk.web.service.ResourceLockedAssertion">
          <property name="byCurrentUser" value="false" />
        </bean>
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="unlock-form" />
        </bean>
      </list>
    </property>
    <property name="attributes">
      <map>
        <entry key="resourceMenuRightOrder">
          <value type="java.lang.Integer">999</value>
        </entry>
        <entry key-ref="system.decoratorTemplateAttribute" value="dialog-template.html" />
      </map>
    </property>
    <property name="handler" ref="manage.unlockFormHandler" />
  </bean>

  <bean parent="manage.resourceMenuRightBuilder">
    <property name="arguments" ref="manage.unlockFormService" />
  </bean>

  <bean id="manage.unlockResourceService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="assertions">
      <list>
        <ref bean="manage.postRequestAssertion" />
        <ref bean="unlockPermissionAssertion" />
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="unlock" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="manage.unlockResourceHandler" />
  </bean>


  <bean id="fileUploadService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageCollectionListingService" />
    <property name="order" value="-980" />
    <property name="assertions">
      <list>
        <!-- <ref bean="manage.postRequestAssertion" /> <bean class="vtk.web.service.RequestContentTypeRegexpAssertion">
          <property name="pattern" value="multipart/form-data" /> </bean> -->
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="upload-file" />
        </bean>
        <ref bean="bindPermissionAssertion" />
        <ref bean="resourceInCollection" />
      </list>
    </property>
    <property name="handler" ref="fileUploadHandler" />
    <property name="attributes">
      <map>
        <entry key-ref="system.decoratorTemplateAttribute" value="dialog-template.html" />
      </map>
    </property>
  </bean>

  <bean parent="collectionMenuBuilder">
    <property name="arguments" ref="fileUploadService" />
  </bean>

  <bean id="createDocumentService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageCollectionListingService" />
    <property name="order" value="-970" />
    <property name="assertions">
      <list>
        <ref bean="bindPermissionAssertion" />
        <ref bean="resourceInCollection" />
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="create-document" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="createDocumentHandler" />
    <property name="attributes">
      <map>
        <entry key-ref="system.decoratorTemplateAttribute" value="dialog-template.html" />
      </map>
    </property>
  </bean>

  <bean parent="collectionMenuBuilder">
    <property name="arguments" ref="createDocumentService" />
  </bean>


  <bean id="createCollectionService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageCollectionListingService" />
    <property name="order" value="-960" />
    <property name="assertions">
      <list>
        <ref bean="bindPermissionAssertion" />
        <ref bean="resourceInCollection" />
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="create-directory" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="createCollectionHandler" />
    <property name="attributes">
      <map>
        <entry key-ref="system.decoratorTemplateAttribute" value="dialog-template.html" />
      </map>
    </property>
  </bean>

  <bean parent="collectionMenuBuilder">
    <property name="arguments" ref="createCollectionService" />
  </bean>
  
  <bean id="renameService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="-1000" />
    <property name="attributes">
      <map>
        <entry key="resourceMenuLeftOrder">
          <value type="java.lang.Integer">0</value>
        </entry>
        <entry key-ref="system.decoratorTemplateAttribute" value="dialog-template.html" />
      </map>
    </property>
    <property name="assertions">
      <list>
        <ref local="deleteResourcePermissionAssertion" />
        <ref local="resourceNotRootAssertion" />
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="rename" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="renameHandler" />
  </bean>

  <bean parent="manage.resourceMenuLeftBuilder">
    <property name="arguments" ref="renameService" />
  </bean>
  
  <bean id="aclInheritanceService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="permissionsService" />
    <property name="assertions">
      <list>
        <ref local="manage.postRequestAssertion" />
        <ref local="resourceNotRootAssertion" />
        <ref local="writeACLPermissionAssertion" />
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="toggle-acl-inheritance" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="aclInheritanceHandler" />
  </bean>

  <bean id="editReadWritePermissionsService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="permissionsService" />
    <property name="assertions">
      <list>
        <ref local="writeACLPermissionAssertion" />
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="edit-read-write-permissions" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="editReadWritePermissionsHandler" />
  </bean>

  <bean id="editReadPermissionsService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="permissionsService" />
    <property name="assertions">
      <list>
        <ref local="writeACLPermissionAssertion" />
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="edit-read-permissions" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="editReadPermissionsHandler" />
  </bean>

  <bean id="editAdminPermissionsService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="permissionsService" />
    <property name="assertions">
      <list>
        <ref local="writeACLPermissionAssertion" />
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="edit-admin-permissions" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="editAdminPermissionsHandler" />
  </bean>

  <bean id="editAddCommentPermissionsService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="permissionsService" />
    <property name="assertions">
      <list>
        <ref local="writeACLPermissionAssertion" />
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="edit-commenting-permissions" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="editAddCommentPermissionsHandler" />
  </bean>

  <bean id="editReadWriteUnpublishedPermissionsService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="permissionsService" />
    <property name="assertions">
      <list>
        <ref local="writeACLPermissionAssertion" />
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="edit-read-write-unpublished-permissions" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="editReadWriteUnpublishedPermissionsHandler" />
  </bean>

  <bean id="editReadProcessedPermissionsService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="permissionsService" />
    <property name="assertions">
      <list>
        <ref local="writeACLPermissionAssertion" />
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="edit-read-processed-permissions" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="editReadProcessedPermissionsHandler" />
  </bean>

  <bean id="resourceTypeIsHtml" 
        class="vtk.repository.resourcetype.ResourceTypeAssertion" parent="repositoryAware">
    <property name="resourceTypeDefinition" ref="htmlResourceTypeDefinition" />
  </bean>

  <bean id="manage.refreshLockHandler" class="vtk.web.actions.lock.LockRefreshController">
    <property name="viewName" value="manage.refreshLockView" />
  </bean>

  <bean id="tidyCopyAction" class="vtk.web.actions.convert.SimpleFilteringCopyAction" parent="repositoryAware">
    <property name="filter">
      <bean class="vtk.web.actions.convert.JTidyTransformer">
        <property name="insertedCssReference" value="${tidyConvertInsertedCssRef}" />
      </bean>
    </property>
  </bean>


  <!-- Create collection with properties (mainly used from Ajax): -->

  <bean id="manage.createCollectionWithPropertiesService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="-9999" />
    <property name="assertions">
      <list>
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="service" />
          <property name="parameterValue" value="create-collection-with-properties" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="manage.createCollectionWithPropertiesHandler" />
  </bean>

  <bean id="manage.createCollectionWithPropertiesHandler"
        class="vtk.web.actions.create.CreateCollectionWithProperties">
    <property name="formView" value="manage.createcollectionwithpropertiesFormView" />
    <property name="successView" value="redirectToManageView" />
  </bean>

  <bean id="manage.createcollectionwithpropertiesFormView" parent="freemarkerView">
    <property name="url" value="pages/create-collection-with-properties.ftl" />
  </bean>


  <!-- Auto-complete service -->
  <bean id="manage.autoCompleteService" class="vtk.web.service.ServiceImpl" parent="autoCompleteService">
    <property name="parent" ref="manageService" />
    <property name="assertions">
      <list>
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="service" />
          <property name="parameterValue" value="resource-autocomplete" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="manage.autoCompleteHandler" />
    <property name="attributes">
      <map>
        <entry key="enable-metrics" value="true" />
      </map>
    </property>
  </bean>

  <bean id="manage.autoCompleteHandler" class="vtk.web.search.QueryHandler">
    <constructor-arg name="searcher" ref="propertySearch.searcher" />
    <constructor-arg name="formats">
      <map>
        <entry key="semicolon-separated">
          <bean class="vtk.web.search.QueryHandler" factory-method="fieldSeparatedResponseHandler">
            <constructor-arg value=";" />
          </bean>
        </entry>
      </map>
    </constructor-arg>
    <constructor-arg name="templates">
      <map>
          <entry key="admin-autocomplete" value="(title =~*{q}* OR name =~*{q}*)"/>
      </map>
    </constructor-arg>
    <constructor-arg name="defaultParameters">
      <map>
        <entry key="t" value="admin-autocomplete" />
        <entry key="tokenize" value="true" />
        <entry key="fields" value="title,uri,collection,type,published" />
        <entry key="format" value="semicolon-separated" />
        <entry key="unique-filter" value="false" />
        <entry key="sort" value="title,lastModified desc" />
      </map>
    </constructor-arg>
  </bean>

  <!-- Locale controllers -->
  <bean id="setNorwegianNBLocaleController" class="vtk.web.actions.locale.SetLocaleController">
    <property name="locale">
      <bean class="java.util.Locale">
        <constructor-arg value="no" />
      </bean>
    </property>
    <property name="localeResolver" ref="manageLocaleResolver" />
  </bean>

  <bean id="setNorwegianNNLocaleController" class="vtk.web.actions.locale.SetLocaleController">
    <property name="locale">
      <bean class="java.util.Locale">
        <constructor-arg value="nn" />
      </bean>
    </property>
    <property name="localeResolver" ref="manageLocaleResolver" />
  </bean>

  <bean id="setEnglishLocaleController" class="vtk.web.actions.locale.SetLocaleController">
    <property name="locale">
      <bean class="java.util.Locale">
        <constructor-arg value="en" />
      </bean>
    </property>
    <property name="localeResolver" ref="manageLocaleResolver" />
  </bean>

  <!-- preview services -->

  <bean id="previewService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="1" />
    <property name="attributes">
      <map>
        <entry key="tabOrder">
          <value type="java.lang.Integer">100</value>
        </entry>
        <entry key="ListMenu.titleResolver" value-ref="preview.workingCopyTabTitle" />
      </map>
    </property>
    <property name="assertions">
      <list>
        <bean class="vtk.repository.resourcetype.ResourceTypeAssertion" parent="repositoryAware">
          <property name="resourceTypeDefinition" ref="collectionResourceTypeDefinition" />
          <property name="invert" value="true" />
        </bean>
        <bean class="vtk.web.service.RequestMethodAssertion">
          <property name="method" value="GET" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="previewFallbackHandler" />
  </bean>

  <bean parent="manage.tabsBuilder">
    <property name="arguments" ref="previewService" />
  </bean>

  <bean id="preview.workingCopyTabTitle" class="vtk.web.view.components.menu.AssertionTitleResolver">
    <property name="assertion">
      <bean class="vtk.web.service.AndAssertion">
        <property name="assertions">
          <list>
            <bean class="vtk.web.service.WorkingCopyAssertion" />
            <bean parent="abstractResourcePrincipalPermissionAssertion">
              <property name="requiresAuthentication" value="true" />
              <property name="considerLocks" value="false" />
              <property name="permission" value="READ_WRITE" />
            </bean>
          </list>
        </property>
      </bean>
    </property>
    <property name="messageKey" value="tabs.previewWorkingCopy" />
  </bean>

  <bean id="preview.mixedModeService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="previewService" />
    <property name="order" value="-1" />
    <property name="assertions">
      <list>
        <!-- <bean class="vtk.web.service.RequestProtocolAssertion"> <property name="protocol" value="https" />
          </bean> -->
        <bean class="vtk.repository.resourcetype.RepositoryOrAssertion">
          <constructor-arg name="assertions">
            <list>
              <bean class="vtk.repository.resourcetype.ResourcePropertyRegexpAssertion">
                <property name="namespace" ref="DEFAULT_NAMESPACE" />
                <property name="name" value="sslMixedMode" />
                <property name="pattern" value="(img|iframe|frame|embed|link|base|object|applet|property|xml:img:?):http://" />
              </bean>
              <bean class="vtk.repository.resourcetype.ResourcePropertyRegexpAssertion">
                <property name="namespace" ref="DEFAULT_NAMESPACE" />
                <property name="name" value="sslMixedMode" />
                <property name="pattern" value="element:style" />
              </bean>
              <bean class="vtk.repository.resourcetype.ResourcePropertyRegexpAssertion">
                <property name="namespace" ref="DEFAULT_NAMESPACE" />
                <property name="name" value="sslMixedMode" />
                <property name="pattern" value="script:" />
              </bean>
              <bean class="vtk.repository.resourcetype.ResourcePropertyRegexpAssertion">
                <property name="namespace" ref="DEFAULT_NAMESPACE" />
                <property name="name" value="sslMixedMode" />
                <property name="patterns">
                  <list>
                    <value>element:ssi:include:feed.*</value>
                    <value>item-picture=\[true\].*</value>
                    <value>url=\[http:.*</value>
                  </list>
                </property>
              </bean>
              <bean class="vtk.repository.resourcetype.ResourcePropertyRegexpAssertion">
                <property name="namespace" ref="DEFAULT_NAMESPACE" />
                <property name="name" value="sslMixedMode" />
                <property name="pattern" value="attr:style" />
              </bean>
              <!-- <bean class="vtk.repository.resourcetype.ResourcePropertyRegexpAssertion"> <property name="namespace" ref="DEFAULT_NAMESPACE"
                   /> <property name="name" value="sslMixedMode" /> <property name="pattern" value="attr:on" /> </bean> -->
            </list>
          </constructor-arg>
        </bean>
      </list>
    </property>
    <property name="handler" ref="preview.displayPopupURLHandler" />
  </bean>


  <bean id="previewHTMLService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="previewService" />
    <property name="assertions">
      <list>
        <ref bean="contentTypeMatchesHtml" />
      </list>
    </property>
    <property name="handler" ref="previewAdminIframeHandler" />
  </bean>


  <bean id="previewImageService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="previewService" />
    <property name="assertions">
      <list>
        <ref bean="contentTypeMatchesImage" />
      </list>
    </property>
    <property name="handler" ref="previewImageHandler" />
  </bean>
  <bean parent="manage.tabMessages.builder">
    <property name="arguments">
      <bean class="vtk.web.referencedata.ServiceReferenceDataProvider">
        <constructor-arg name="service" ref="previewImageService" />
        <constructor-arg name="provider" ref="viewAsWebpageMessageProvider" />
      </bean>
    </property>
  </bean>


  <bean id="previewMediaService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="previewService" />
    <property name="assertions">
      <list>
        <ref bean="contentTypeMatchesMedia" />
      </list>
    </property>
    <property name="handler" ref="previewMediaHandler" />
  </bean>
  <bean parent="manage.tabMessages.builder">
    <property name="arguments">
      <bean class="vtk.web.referencedata.ServiceReferenceDataProvider">
        <constructor-arg name="service" ref="previewMediaService" />
        <constructor-arg name="provider" ref="viewAsWebpageMessageProvider" />
      </bean>
    </property>
  </bean>


  <bean id="previewTextService" class="vtk.web.service.ServiceImpl">
    <property name="order" value="10" />
    <property name="parent" ref="previewService" />
    <property name="assertions">
      <bean class="vtk.web.service.OrAssertion">
        <property name="assertions">
          <list>
              <bean class="vtk.web.service.RepositoryAssertionWrapper">
                <constructor-arg name="assertion" ref="contentTypeMatchesAnyText" />
              </bean>
              <bean class="vtk.web.service.RepositoryAssertionWrapper">
                <constructor-arg name="assertion" ref="json.contentTypeAssertion" />
              </bean>
          </list>
        </property>
      </bean>
    </property>
    <property name="handler" ref="previewTextHandler" />
  </bean>
  
  <bean id="previewIndexFile" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="previewHTMLService" />
    <property name="assertions">
      <list>
        <bean class="vtk.web.service.IsIndexFileAssertion" />
        <ref bean="manage.adminIndexFileFromViewParameter" />
      </list>
    </property>
    <property name="handler" ref="previewAdminIframeHandler" />
  </bean>

  <bean id="previewText.documentTooLargeService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="previewTextService" />
    <property name="assertions">
      <list>
        <bean class="vtk.web.service.ResourceContentLengthAssertion">
          <property name="greaterThanValue" value="${preview.text.maxDocumentSize}" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="previewText.documentTooLargeHandler" />
  </bean>

  <bean id="previewText.documentTooLargeHandler" class="org.springframework.web.servlet.mvc.ParameterizableViewController">
    <property name="viewName" value="previewText.documentTooLargeView" />
  </bean>

  <bean id="previewCollectionListingService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="-1" />
    <property name="attributes">
      <map>
        <entry key="tabOrder">
          <value type="java.lang.Integer">100</value>
        </entry>
      </map>
    </property>
    <property name="assertions">
      <list>
        <ref bean="resourceInCollection" />
        <bean id="previewVrtxParameterRule" class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="preview" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="previewAdminIframeHandler" />
  </bean>

  <bean parent="manage.tabsBuilder">
    <property name="arguments" ref="previewCollectionListingService" />
  </bean>


  <bean id="indexFileMessageProvider" class="vtk.web.referencedata.ServiceReferenceDataProvider">
    <constructor-arg name="service" ref="previewCollectionListingService" />
    <constructor-arg name="provider">
      <bean class="vtk.web.referencedata.provider.IndexFileMessageProvider">
        <property name="modelName" value="tabMessage" />
        <property name="localizationKey" value="preview.folderWithIndexFile.tabMessage" />
      </bean>
    </constructor-arg>
  </bean>

  <bean id="viewAsWebpageMessageProvider" class="vtk.web.referencedata.provider.ResourceMessageProvider">
    <property name="modelName" value="tabMessage" />
    <property name="localizationKey" value="preview.viewAsWebpage.tabMessage" />
  </bean>

  <!-- MANAGE controllers -->
  <bean id="aboutResourceHandler" class="vtk.web.actions.properties.PropertyEditController">
    <property name="propertyTypeDefinitions">
      <list>
        <ref bean="lastModifiedPropDef" />
        <ref bean="modifiedByPropDef" />
        <ref bean="creationTimePropDef" />
        <ref bean="createdByPropDef" />
        <ref bean="ownerPropDef" />
        <!-- resourceType -->
        <!-- webadress -->
        <!-- webDAVadress -->
        <ref bean="contentLocalePropDef" />
        <ref bean="contentLengthPropDef" />
        <ref bean="userTitlePropDef" />
        <ref bean="titlePropDef" />
        <!-- Don't pass in hidden and navigational importance <ref bean="hiddenPropDef" /> <ref bean="importancePropDef"
          /> -->
        <ref bean="keywordsPropDef" />
        <ref bean="descriptionPropDef" />
        <ref bean="verifiedDatePropDef" />
        <ref bean="authorNamePropDef" />
        <ref bean="authorEmailPropDef" />
        <ref bean="authorURLPropDef" />
        <ref bean="contentTypePropDef" />
        <ref bean="userSpecifiedCharacterEncodingPropDef" />
        <ref bean="guessedCharacterEncodingPropDef" />
        <ref bean="characterEncodingPropDef" />
        <ref bean="plaintextEditPropDef" />
        <ref bean="commentsEnabledPropDef" />

        <!-- Unpublished collection inheritable property -->
        <ref bean="unpublishedCollectionPropDef" />

        <!-- Editorial contacts -->
        <ref bean="editorialContactsPropDef" />

        <!-- Collection type -->
        <ref bean="collection.typePropDef" />

        <!-- Media-mxin type -->
        <ref bean="mediaHeightPropDef" />
        <ref bean="mediaWidthPropDef" />
        <ref bean="mediaDurationPropDef" />
        <ref bean="videoref.streamablePercentCompletePropDef" />
        <ref bean="videoref.typePropDef" />
      </list>
    </property>
    <property name="propertyListModelName" value="basicPropList" />
    <property name="propertyMapModelName" value="aboutItems" />
    <property name="formView" value="aboutView" />
    <property name="successView" value="redirectToAboutView" />
    <property name="commandName" value="form" />
    <property name="dateFormat" value="dd.MM.yyyy HH:mm:ss" />
    <property name="valueFactory" ref="valueFactory" />
    <property name="principalManager" ref="principalManager" />
    <property name="documentPrincipalMetadataRetriever" ref="documentPrincipalMetadataRetriever" />
    <property name="localeResolver" ref="manageLocaleResolver" />
  </bean>

  <bean id="fileUploadHandler" class="vtk.web.actions.create.FileUploadController">
    <property name="formView" value="manage.fileUploadView" />
    <property name="successView" value="redirectToManageView" />
    <property name="commandName" value="uploadForm" />
    <property name="fileUpload" ref="fileUpload.store" />
  </bean>

  <bean id="fileUpload.store" class="vtk.repository.FileUpload">
    <constructor-arg ref="repository" />
    <constructor-arg value="${upload.tempDir}" />
    <constructor-arg ref="createResource.nameReplacementMap" />
    <constructor-arg value="true" />
  </bean>

  <bean id="manage.fileUploadView" parent="freemarkerView">
    <property name="url" value="actions/upload.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
      </list>
    </property>
  </bean>

  <bean id="manage.unlockResourceHandler" class="vtk.web.actions.lock.UnlockResourceController">
    <property name="viewName" value="redirectToManageView" />
  </bean>

  <bean id="manage.unlockFormHandler" class="vtk.web.actions.lock.UnlockFormController">
    <property name="formView" value="manage.unlockFormView" />
    <property name="successView" value="redirectToManageView" />
    <property name="commandName" value="unlockFormCommand" />
  </bean>

  <bean id="manage.unlockFormView" parent="freemarkerView">
    <property name="url" value="actions/unlock-form.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
      </list>
    </property>
  </bean>

  <bean id="createDocumentHandler" class="vtk.web.actions.create.TemplateBasedCreateController">
    <property name="formView" value="createDocumentView" />
    <property name="cancelView" value="redirectToManageView" />
    <property name="successView" value="redirectToManageView" />
    <property name="commandName" value="createDocumentForm" />
    <property name="downcaseNames" value="true" />
    <property name="descriptionPropDef" ref="descriptionPropDef" />
    <property name="removePropList">
      <list>
        <ref bean="descriptionPropDef" />
      </list>
    </property>
    <property name="replaceNameChars" ref="createResource.nameReplacementMap" />
    <property name="templateManager" ref="templates.resourceTemplateManager" />
  </bean>

  <bean id="createDocumentView" parent="freemarkerView">
    <property name="url" value="actions/create-document.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
      </list>
    </property>
  </bean>

  <bean id="defaultDocumentTemplates" class="vtk.web.actions.create.DefaultDocumentTemplates">
    <property name="templatesCollection" value="${documentTemplatesCollection}" />
    <property name="repository" ref="repository" />
    <property name="trustedToken" ref="trustedToken" />
    <property name="parseCategoryTemplates" value="${documentTemplatesParseCategoryTemplates}" />
    <property name="parseTopTemplates" value="${documentTemplatesParseTopTemplates}" />
  </bean>

  <bean id="documentTemplatesRefreshTrigger" class="vtk.util.repository.MethodInvokingRepositoryEventTrigger">
    <property name="repository" ref="repository" />
    <property name="uriPattern" value="${documentTemplatesCollection}/.*" />
    <property name="targetObject" ref="defaultDocumentTemplates" />
    <property name="method" value="refresh" />
  </bean>
  <bean parent="cluster.componentRegistration">
    <property name="component" ref="documentTemplatesRefreshTrigger"/>
  </bean>

  <bean id="createResource.nameReplacementMap" class="java.util.HashMap">
    <constructor-arg>
      <map>
        <entry key="\/" value="-" />
        <entry key="\\" value="-" />
        <entry key="\s+" value="-" />
        <entry key="&amp;" value="-" />
        <entry key="," value="" />
        <entry key="\'" value="-" />
        <entry key="&quot;" value="-" />
        <entry key="æ" value="e" />
        <entry key="ø" value="o" />
        <entry key="å" value="a" />
        <entry key="%" value="" />
        <entry key="#" value="" />
        <entry key="\?" value="" />
      </map>
    </constructor-arg>
  </bean>

  <bean id="createCollectionHandler" class="vtk.web.actions.create.TemplateBasedCreateCollectionController">
    <property name="formView" value="manage.createCollectionView" />
    <property name="cancelView" value="redirectToManageView" />
    <property name="successView" value="redirectToManageView" />
    <property name="commandName" value="createCollectionForm" />
    <property name="userTitlePropDef" ref="userTitlePropDef" />
    <property name="downcaseCollectionNames" value="true" />
    <property name="templateManager" ref="templates.resourceTemplateManager" />
    <property name="replaceNameChars" ref="createResource.nameReplacementMap" />
    <property name="descriptionPropDef" ref="descriptionPropDef" />
    <property name="normalFolderProperties">
      <map>
        <entry key-ref="collection.recursiveListingPropDef">
          <bean class="vtk.repository.resourcetype.Value">
            <constructor-arg value="false" type="java.lang.String" />
            <constructor-arg value="STRING" />
          </bean>
        </entry>
      </map>
    </property>
    <property name="publishDatePropDef" ref="publishDatePropDef" />
    <property name="unpublishedCollectionPropDef" ref="unpublishedCollectionPropDef" />
  </bean>

  <bean id="manage.createCollectionView" parent="freemarkerView">
    <property name="url" value="actions/create-collection.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
      </list>
    </property>
  </bean>

  <bean id="renameHandler" class="vtk.web.actions.copymove.RenameController">
    <property name="formView" value="renameView" />
    <property name="successView" value="redirectToManageView" />
    <property name="commandName" value="renameCommand" />
    <property name="validator">
      <bean class="vtk.web.actions.copymove.RenameCommandValidator">
        <property name="replaceNameChars" ref="createResource.nameReplacementMap" />
      </bean>
    </property>
  </bean>

  <bean id="renameView" parent="freemarkerView">
    <property name="url" value="actions/rename.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
      </list>
    </property>
  </bean>

  <bean id="aclInheritanceHandler" class="vtk.web.actions.permissions.ToggleAclInheritanceController">
    <property name="viewName" value="redirectToPermissionsView" />
  </bean>

  <bean id="abstractPermissionsHandler" abstract="true" class="vtk.web.actions.permissions.ACLEditController">
    <property name="formView" value="permissionsView" />
    <property name="validator">
      <bean class="vtk.web.actions.permissions.ACLEditCommandValidator">
        <property name="principalManager" ref="principalManager" />
        <property name="principalFactory" ref="principalFactory" />
        <property name="repository" ref="repository" />
      </bean>
    </property>
    <property name="principalManager" ref="principalManager" />
    <property name="principalFactory" ref="principalFactory" />
    <property name="permissionShortcuts" ref="permissionShortcuts" />
    <property name="permissionShortcutsConfig" ref="permissionShortcutsProvider.config" />
    <property name="roleManager" ref="roleManager" />
    <property name="localeResolver" ref="manageLocaleResolver" />
    <property name="documentPrincipalMetadataRetriever" ref="documentPrincipalMetadataRetriever" />
    <property name="repository" ref="repository" />
  </bean>

  <bean id="editReadPermissionsHandler" parent="abstractPermissionsHandler">
    <property name="privilege" value="READ" />
    <property name="successView" value="redirectToPermissionsView" />
    <property name="commandName" value="permissionsForm_read" />
  </bean>

  <bean id="editReadWritePermissionsHandler" parent="abstractPermissionsHandler">
    <property name="privilege" value="READ_WRITE" />
    <property name="successView" value="redirectToPermissionsView" />
    <property name="commandName" value="permissionsForm_read-write" />
  </bean>

  <bean id="editAdminPermissionsHandler" parent="abstractPermissionsHandler">
    <property name="privilege" value="ALL" />
    <property name="successView" value="redirectToPermissionsView" />
    <property name="commandName" value="permissionsForm_all" />
  </bean>

  <bean id="editReadProcessedPermissionsHandler" parent="abstractPermissionsHandler">
    <property name="privilege" value="READ_PROCESSED" />
    <property name="successView" value="redirectToPermissionsView" />
    <property name="commandName" value="permissionsForm_read-processed" />
  </bean>

  <bean id="editAddCommentPermissionsHandler" parent="abstractPermissionsHandler">
    <property name="privilege" value="ADD_COMMENT" />
    <property name="successView" value="redirectToPermissionsView" />
    <property name="commandName" value="permissionsForm_add-comment" />
  </bean>

  <bean id="editReadWriteUnpublishedPermissionsHandler" parent="abstractPermissionsHandler">
    <property name="privilege" value="READ_WRITE_UNPUBLISHED" />
    <property name="successView" value="redirectToPermissionsView" />
    <property name="commandName" value="permissionsForm_read-write-unpublished" />
  </bean>

  <bean id="permissionsHandler" class="vtk.web.display.file.ResourceAwareParameterizableViewController">
    <property name="viewName" value="permissionsView" />
  </bean>

  <bean id="manageCollectionListingHandler" class="vtk.web.display.file.ResourceAwareParameterizableViewController">
    <property name="viewName" value="manageCollectionListingView" />
  </bean>

  <bean id="preview.displayPopupURLHandler" class="vtk.web.display.url.ResourceServiceURLController">
    <property name="viewName" value="preview.displayPopupURLView" />
    <property name="service" ref="viewService" />
    <property name="displayWorkingRevision" value="true" />
    <property name="unpublishedCollectionPropDef" ref="unpublishedCollectionPropDef" />
  </bean>

  <bean id="abstractPreviewIframe" abstract="true" class="vtk.web.display.url.ResourceServiceURLController">
    <property name="webProtocol" value="${webProtocol}" />
    <property name="webProtocolRestricted" value="${webProtocolRestricted}" />
    <property name="unpublishedCollectionPropDef" ref="unpublishedCollectionPropDef" />
  </bean>

  <bean id="previewAdminIframeHandler" parent="abstractPreviewIframe">
    <property name="service" ref="viewService" />
    <property name="viewName" value="previewAdminIframeView" />
    <property name="displayWorkingRevision" value="true" />
  </bean>

  <bean id="previewImageHandler" parent="abstractPreviewIframe">
    <property name="service" ref="viewService" />
    <property name="viewName" value="previewMediaView" />
  </bean>

  <bean id="previewMediaHandler" parent="abstractPreviewIframe">
    <property name="service" ref="viewService" />
    <property name="viewName" value="previewMediaView" />
  </bean>

  <bean id="previewTextHandler" class="vtk.web.display.file.DisplayResourceController">
    <!-- XXX preview size limit.. -->
    <property name="ignoreLastModified" value="true" />
    <property name="viewName" value="previewTextView" />
    <property name="streamToString" value="true" />
  </bean>

  <bean id="previewFallbackHandler" class="vtk.web.display.file.DisplayResourceController">
    <property name="ignoreLastModified" value="true" />
    <property name="viewName" value="previewFallbackView" />
  </bean>

  <bean id="expiresSecProvider" class="vtk.web.referencedata.provider.ResourcePropertiesValueProvider">
    <property name="modelNames">
      <map>
        <entry key="http://www.uio.no/header-control" value="expiresSec" />
      </map>
    </property>
    <property name="properties">
      <list>
        <value>http://www.uio.no/header-control:expires-sec</value>
      </list>
    </property>
  </bean>

  <bean id="decorating.manageNamespace" class="java.lang.String">
    <constructor-arg type="java.lang.String" value="manage" />
  </bean>

  <bean id="manage.javascriptRegistry" class="vtk.web.MediaRegistry" />
  <bean id="manage.cssRegistry" class="vtk.web.MediaRegistry" />
  <bean id="manage.placeholderComponentRegistry" class="vtk.web.decorating.PlaceholderComponentRegistry"/>

  <!-- Convenience bean for registering admin placeholder components.
       Consult the system decorating template files for possible placement identifiers.
  -->
  <bean id="manage.placeholderComponent.register"
        class="org.springframework.beans.factory.config.MethodInvokingBean"
        abstract="true">
    <property name="targetObject" ref="manage.placeholderComponentRegistry" />
    <property name="targetMethod" value="register" />
  </bean>

  <bean id="manage.placeholderComponent" class="vtk.web.decorating.components.DelegatingPlaceholderComponent">
    <constructor-arg ref="manage.placeholderComponentRegistry"/>
    <property name="name" value="placeholder"/>
    <property name="namespace" ref="decorating.manageNamespace"/>
    <property name="description" value="System template placeholder component (for customizations)"/>
  </bean>

  <bean class="vtk.web.AdminMedia">
    <constructor-arg ref="manage.javascriptRegistry" />
    <constructor-arg value="head" />
    <constructor-arg>
      <list>
        <value>${jquery.baseURL}/jquery.min.js</value>
        <value>${jsBaseURL}/frameworks/es5-shim-dejavu.js</value>
        <value>${jquery.baseURL}/plugins/jquery.vortexTips.js</value>
        <value>${jsBaseURL}/vrtx-simple-dialogs.js</value>
        <value>${jsBaseURL}/admin-enhancements.js</value>
      </list>
    </constructor-arg>
  </bean>

  <bean class="vtk.web.AdminMedia">
    <constructor-arg ref="manage.cssRegistry" />
    <constructor-arg value="head" />
    <constructor-arg>
      <list>
        <value>${jquery.baseURL}/plugins/ui/jquery-ui-${jquery.ui.version}.custom/css/smoothness/jquery-ui-${jquery.ui.version}.custom.min.css</value>
        <value>${themeBaseURL}/default.css</value>
      </list>
    </constructor-arg>
  </bean>

  <bean id="manage.titleComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="title" />
    <property name="description" value="Inserts the admin title" />
    <property name="view" ref="manage.titleView" />
  </bean>

  <bean id="manage.titleView" parent="freemarkerView">
    <property name="url" value="system/title.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
      </list>
    </property>
    <property name="attributesMap">
      <map>
        <entry key="localizationKey" value="title.admin">
        </entry>
      </map>
    </property>
  </bean>

  <bean id="manage.cssComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="css" />
    <property name="description" value="Inserts the default admin CSS stylesheets" />
    <property name="view" ref="manage.cssView" />
    <property name="exposeMvcModel" value="true" />
    <property name="parameterDescriptions">
      <map>
        <entry key="place" value="Defines the place to get CSS files from the registry" />
      </map>
    </property>
  </bean>

  <bean id="manage.cssView" parent="freemarkerView">
    <property name="url" value="system/css-registry.ftl" />
    <property name="attributesMap">
      <map>
        <entry key="cssRegistry" value-ref="manage.cssRegistry" />
      </map>
    </property>
  </bean>

  <bean id="manage.javascriptComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="javascript" />
    <property name="description" value="Inserts the default admin Javascript references" />
    <property name="view" ref="manage.javascriptView" />
    <property name="exposeMvcModel" value="true" />
    <property name="parameterDescriptions">
      <map>
        <entry key="place" value="Defines the place to get Javascript files from the registry" />
      </map>
    </property>
  </bean>

  <bean id="manage.javascriptView" parent="freemarkerView">
    <property name="url" value="system/javascript-registry.ftl" />
    <property name="attributesMap">
      <map>
        <entry key="javascriptRegistry" value-ref="manage.javascriptRegistry" />
      </map>
    </property>
  </bean>

  <bean id="manage.breadcrumbComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="breadcrumb" />
    <property name="description" value="Displays the admin breadcrumb trail" />
    <property name="view" ref="manageBreadcrumbView" />
  </bean>

  <bean id="manageBreadcrumbView" parent="freemarkerView">
    <property name="url" value="layouts/breadcrumb.ftl" />
    <property name="referenceDataProviders">
      <list>
        <bean class="vtk.web.referencedata.provider.BreadCrumbProvider">
          <description> Breadcrumb provider that generates links to the manage service </description>
          <property name="breadcrumbName" value="breadcrumb" />
          <property name="service" ref="manageService" />
        </bean>
      </list>
    </property>
  </bean>

  <bean id="manage.leaveAdminComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="leave-admin" />
    <property name="description" value="Displays a link to get out of the admin service" />
    <property name="view" ref="manage.leaveAdminView" />
  </bean>

  <bean id="manage.leaveAdminView" parent="freemarkerView">
    <property name="url" value="system/leave-admin.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="leaveAdminLinkProvider" />
      </list>
    </property>
  </bean>

  <bean id="manage.createDropDownComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="create-drop-down" />
    <property name="description" value="Displays a drop down menu to create new document or collection" />
    <property name="view" ref="manage.createDropDownView" />
  </bean>

  <bean id="manage.createDropDownView" parent="freemarkerView">
    <property name="url" value="system/create-drop-down.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
        <ref bean="createDropDown.urlProvider" />
        <ref bean="createFromDropDown.docService.urlProvider" />
        <ref bean="createFromDropDown.collService.urlProvider" />
        <ref bean="createFromDropDown.upService.urlProvider" />
      </list>
    </property>
  </bean>

  <bean id="manage.principalInfoComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="principal-info" />
    <property name="description" value="Displays prinncipal information and logout URL" />
    <property name="view" ref="manage.principalInfoView" />
  </bean>

  <bean id="manage.principalInfoView" parent="freemarkerView">
    <property name="url" value="system/principal-info.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
        <ref bean="logoutLinkProvider" />
      </list>
    </property>
  </bean>

  <bean id="logoutLinkProvider" class="vtk.web.referencedata.provider.ResourceServiceURLProvider">
    <property name="service" ref="logoutService" />
    <property name="modelName" value="logout" />
    <property name="matchAssertions" value="true" />
  </bean>

  <bean id="manage.repositoryIdComponent" class="vtk.web.decorating.components.StaticTextComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="repository-id" />
    <property name="text" value="${repositoryID}" />
  </bean>

  <bean id="manage.helpComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="help" />
    <property name="description" value="Displays a help link for the admin service" />
    <property name="view" ref="manage.helpView" />
  </bean>

  <bean id="manage.helpView" parent="freemarkerView">
    <property name="url" value="system/help.ftl" />
    <property name="attributesMap">
      <map>
        <entry key="helpURL" value="${helpURL}" />
        <entry key="helpURL.no" value="${helpURL.no}" />
        <entry key="helpURL.nn" value="${helpURL.nn}" />
        <entry key="helpURL.en" value="${helpURL.en}" />
      </map>
    </property>
  </bean>

  <bean id="manage.localizedTextComponent" class="vtk.web.decorating.components.LocalizedTextComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="localized-text" />
  </bean>

  <bean id="manage.localizedMessagesCompontent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="localization" />
    <property name="description" value="Translated messages" />
    <property name="view">
      <bean parent="freemarkerView">
        <property name="url" value="system/localization.ftl" />
      </bean>
    </property>
  </bean>

  <bean id="manage.messagesComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="messages" />
    <property name="description" value="Displays the admin messages" />
    <property name="view" ref="manage.messagesView" />
  </bean>

  <bean id="manage.messagesView" parent="freemarkerView">
    <property name="url" value="system/messages.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
      </list>
    </property>
  </bean>

  <bean id="manage.resourceBarComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="resource-bar" />
    <property name="description" value="Displays resource bar" />
    <property name="view" ref="manage.resourceBarView" />
    <property name="exposeMvcModel" value="true" />
  </bean>

  <bean id="manage.resourceBarView" parent="freemarkerView">
    <property name="url" value="system/resource-bar.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
        <ref bean="serverNowTimeProvider" />
        <ref bean="manage.resourceMenuLeftProvider" />
        <ref bean="manage.resourceMenuRightProvider" />
        <ref bean="manage.refreshLockURLProvider" />
        <!-- Possible temporary assertion via service construct link to minimize concept impact -->
        <bean class="vtk.web.referencedata.provider.ResourceServiceURLProvider">
          <property name="modelName" value="publishLink" />
          <property name="urlName" value="url" />
          <property name="service" ref="publish.publishResourceService" />
          <property name="matchAssertions" value="true" />
        </bean>
        <bean class="vtk.web.referencedata.provider.ResourceServiceURLProvider">
          <property name="modelName" value="unpublishLink" />
          <property name="urlName" value="url" />
          <property name="service" ref="publish.unpublishResourceService" />
          <property name="matchAssertions" value="true" />
        </bean>
        <bean class="vtk.web.referencedata.provider.ResourcePrincipalPermissionsProvider">
          <property name="modelName" value="writePermission" />
          <property name="permission" value="WRITE" />
          <property name="anonymous" value="false" />
          <property name="considerLocks" value="true" />
        </bean>
        <bean class="vtk.web.referencedata.provider.ResourcePrincipalPermissionsProvider">
          <property name="modelName" value="writePermissionAtAll" />
          <property name="permission" value="WRITE" />
          <property name="anonymous" value="false" />
          <property name="considerLocks" value="false" />
        </bean>
        <bean class="vtk.web.referencedata.provider.ResourcePrincipalPermissionsProvider">
          <property name="modelName" value="unlockPermission" />
          <property name="permission" value="UNLOCK" />
          <property name="anonymous" value="false" />
          <property name="considerLocks" value="false" />
        </bean>
      </list>
    </property>
    <property name="attributesMap">
      <map>
        <entry key="repositoryID" value="${repositoryID}" />
      </map>
    </property>
  </bean>

  <bean id="manage.infoMessageComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="system-message" />
    <property name="description" value="Displays an info message (if found in its specified location)" />
    <property name="view" ref="manage.infoMessageView" />
  </bean>

  <bean id="manage.infoMessageView" parent="freemarkerView">
    <property name="url" value="system/system-message.ftl" />
    <property name="referenceDataProviders">
      <list>
        <bean class="vtk.web.referencedata.provider.SpringResourceContentProvider">
          <property name="modelKey" value="systemInfoMessage" />
          <property name="folderLocation" value="${manage.infoMessageFolderLocation}" />
          <property name="repositoryId" value="${repositoryID}" />
          <property name="defaultFile" value="${manage.infoMessageDefaultFile}" />
        </bean>
      </list>
    </property>
  </bean>

  <bean id="manage.tabsComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="tabs" />
    <property name="description" value="Displays the default admin tabs" />
    <property name="view" ref="manageTabView" />
  </bean>

  <bean id="manageTabView" parent="freemarkerView">
    <property name="url" value="layouts/tabs.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="manage.tabsProvider" />
      </list>
    </property>
  </bean>

  <bean id="manage.tabMenuComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="tab-menu" />
    <property name="description" value="Displays the admin tab menu" />
    <property name="view" ref="manage.tabMenuView" />
    <property name="exposeMvcModel" value="false" />
  </bean>

  <bean id="manage.tabMenuView" parent="freemarkerView">
    <property name="url" value="system/tab-menu.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="manage.tabMenuProvider" />
      </list>
    </property>
  </bean>

  <bean id="manage.tabMessageComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="tab-message" />
    <property name="description" value="Displays the admin tab message" />
    <property name="view" ref="manage.tabMessageView" />
    <property name="exposeMvcModel" value="true" />
  </bean>

  <bean id="manage.tabMessageView" parent="freemarkerView">
    <property name="url" value="system/tab-message.ftl" />
    <property name="referenceDataProviders" ref="manage.tabMessages" />
  </bean>

  <bean id="manage.tabMessages" class="java.util.ArrayList" />

  <bean id="manage.tabMessages.builder"
        class="org.springframework.beans.factory.config.MethodInvokingBean" abstract="true">
    <property name="targetObject" ref="manage.tabMessages" />
    <property name="targetMethod" value="add" />
  </bean>

  <bean parent="manage.tabMessages.builder">
    <property name="arguments" ref="expiresSecProvider" />
  </bean>

  <bean parent="manage.tabMessages.builder">
    <property name="arguments" ref="indexFileMessageProvider" />
  </bean>

  <bean id="manage.parentNavigationComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="parent-navigation" />
    <property name="description" value="Displays the parent collection URL" />
    <property name="view" ref="manage.parentNavigationView" />
    <property name="exposeMvcModel" value="true" />
  </bean>

  <bean id="manage.parentNavigationView" parent="freemarkerView">
    <property name="url" value="system/parent-navigation.ftl" />
    <property name="referenceDataProviders">
      <bean class="vtk.web.referencedata.ServiceReferenceDataProvider">
        <constructor-arg name="service" ref="manageCollectionListingService" />
        <constructor-arg name="provider" ref="parentLinkProvider" />
      </bean>
    </property>
  </bean>

  <bean id="manage.tabHelpComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="tab-help" />
    <property name="description" value="Displays a tab help message" />
    <property name="view" ref="manage.tabHelpView" />
    <property name="exposeMvcModel" value="true" />
  </bean>

  <bean id="manage.tabHelpView" parent="freemarkerView">
    <property name="url" value="system/tab-help.ftl" />
  </bean>

  <bean id="manage.versionInfoComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="version-info" />
    <property name="description" value="Displays version information" />
    <property name="view" ref="manage.versionInfoView" />
  </bean>

  <bean id="manage.versionInfoView" parent="freemarkerView">
    <property name="url" value="system/version-info.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="versionProvider" />
      </list>
    </property>
  </bean>

  <bean id="manage.languageSelectComponent" class="vtk.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.manageNamespace" />
    <property name="name" value="language-select" />
    <property name="description" value="Displays the admin language" />
    <property name="view" ref="manage.languageSelectView" />
    <property name="exposeMvcModel" value="true" />
  </bean>

  <bean id="manage.languageSelectView" parent="freemarkerView">
    <property name="url" value="system/language-select.ftl" />
    <property name="referenceDataProviders">
      <ref bean="switchLocaleActionsProvider" />
    </property>
  </bean>

  <bean id="manageLinkProvider" class="vtk.web.referencedata.provider.ResourceServiceURLProvider">
    <property name="modelName" value="manageLink" />
    <property name="service" ref="manageService" />
  </bean>

  <bean id="manage.refreshLockURLProvider" class="vtk.web.referencedata.provider.ResourceServiceURLProvider">
    <property name="service" ref="manage.refreshLockService" />
    <property name="modelName" value="pingURL" />
    <property name="urlName" value="url" />
  </bean>

  <bean id="manage.unlockURLProvider" class="vtk.web.referencedata.provider.ResourceServiceURLProvider">
    <property name="service" ref="manage.unlockResourceService" />
    <property name="modelName" value="unlockURL" />
    <property name="urlName" value="url" />
  </bean>

  <bean id="manage.refreshLockView" parent="freemarkerView">
    <property name="url" value="layouts/lock-refresh-response.ftl" />
  </bean>

  <bean id="asWebpage.urlProvider" class="vtk.web.referencedata.provider.ResourceServiceURLProvider">
    <property name="modelName" value="previewImage" />
    <property name="urlName" value="URL" />
    <!-- create a common mother for all view as webpage services -->
    <property name="service" ref="mediaPlayerService" />
    <property name="staticURLParameters">
      <map>
        <entry key="vrtxPreviewUnpublished" value="true" />
      </map>
    </property>
  </bean>

  <!-- Views -->

  <bean id="previewMediaView" parent="freemarkerView">
    <property name="url" value="pages/preview-admin-iframe.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
        <ref bean="asWebpage.urlProvider" />
        <ref bean="iframeJSProvider" />
        <bean class="vtk.web.referencedata.provider.ResourcePrincipalPermissionsProvider">
          <property name="modelName" value="permissions_ACTION_READ" />
          <property name="permission" value="READ" />
          <property name="anonymous" value="true" />
        </bean>
        <bean class="vtk.web.referencedata.provider.ResourcePrincipalPermissionsProvider">
          <property name="modelName" value="permissions_ACTION_READ_PROCESSED" />
          <property name="permission" value="READ_PROCESSED" />
          <property name="anonymous" value="true" />
        </bean>
        <bean class="vtk.web.referencedata.provider.StaticModelDataProvider">
          <property name="modelDataMap">
            <map>
              <entry key="webProtocol" value="${webProtocol}" />
            </map>
          </property>
        </bean>
      </list>
    </property>
  </bean>


  <bean id="previewAdminIframeView" parent="freemarkerView">
    <property name="url" value="pages/preview-admin-iframe.ftl" />
    <property name="attributesMap">
      <map>
        <entry key="visualizeBrokenLinks" value="${preview.visualizeBrokenLinks}" />
      </map>
    </property>
    <property name="referenceDataProviders">
      <list>
        <ref bean="iframeJSProvider" />
        <ref bean="resourceContextProvider" />
        <bean class="vtk.web.referencedata.provider.ResourcePrincipalPermissionsProvider">
          <property name="modelName" value="permissions_ACTION_READ" />
          <property name="permission" value="READ" />
          <property name="anonymous" value="true" />
        </bean>
        <bean class="vtk.web.referencedata.provider.ResourcePrincipalPermissionsProvider">
          <property name="modelName" value="permissions_ACTION_READ_PROCESSED" />
          <property name="permission" value="READ_PROCESSED" />
          <property name="anonymous" value="true" />
        </bean>
        <bean class="vtk.web.referencedata.provider.StaticModelDataProvider">
          <property name="modelDataMap">
            <map>
              <entry key="webProtocol" value="${webProtocol}" />
            </map>
          </property>
        </bean>
        <bean class="vtk.web.referencedata.provider.ResourceServiceURLProvider">
          <property name="service" ref="decorating.viewUnpublishedService" />
          <property name="modelName" value="versioning" />
          <property name="urlName" value="currentVersionURL" />
        </bean>
      </list>
    </property>
  </bean>

  <bean id="previewTextView" parent="freemarkerView">
    <property name="url" value="pages/preview-text.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
      </list>
    </property>
  </bean>

  <bean id="previewText.documentTooLargeView" parent="freemarkerView">
    <property name="url" value="pages/preview-text-too-large.ftl" />
  </bean>


  <bean id="preview.displayPopupURLView" parent="freemarkerView">
    <property name="url" value="pages/preview-ssl-mixed-mode.ftl" />
    <property name="referenceDataProviders">
      <list>
        <bean class="vtk.web.referencedata.provider.ResourceServiceURLProvider">
          <property name="service" ref="previewPopupService" />
          <property name="modelName" value="preview" />
          <property name="urlName" value="popupURL" />
        </bean>
        <ref bean="resourceContextProvider" />
      </list>
    </property>
  </bean>

  <bean id="previewFallbackView" parent="freemarkerView">
    <property name="url" value="pages/preview-unavailable.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
        <ref bean="resourceDetailProvider" />
      </list>
    </property>
  </bean>

  <bean id="permissionsView" parent="freemarkerView">
    <property name="url" value="pages/permissions.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="adminACLProvider" />
        <ref bean="resourceContextProvider" />
        <bean class="vtk.web.referencedata.provider.StaticModelDataProvider">
          <property name="modelDataMap">
            <map>
              <entry key="webResources" value="${webResources.baseURL}" />
            </map>
          </property>
        </bean>
      </list>
    </property>
    <property name="attributesMap">
      <map>
        <entry key="javascriptRegistry" value-ref="manage.javascriptRegistry" />
      </map>
    </property>
  </bean>

  <bean id="permissionShortcuts" class="org.springframework.beans.factory.config.MapFactoryBean">
    <property name="sourceMap">
      <map key-type="vtk.repository.Privilege">
        <entry key="READ" value-ref="permissionShortcutsProvider.readShortcuts" />
        <entry key="READ_WRITE" value-ref="permissionShortcutsProvider.readWriteShortcuts" />
        <entry key="ADD_COMMENT" value-ref="permissionShortcutsProvider.addCommentShortcuts" />
        <entry key="READ_PROCESSED" value-ref="permissionShortcutsProvider.readProcessedShortcuts" />
      </map>
    </property>
  </bean>

  <bean id="permissionShortcutsProvider.readShortcuts" class="vtk.context.CSVListFactoryBean">
    <property name="csvList" value="${permissions.shortcuts.read}" />
    <property name="trim" value="true" />
  </bean>

  <bean id="permissionShortcutsProvider.readWriteShortcuts" class="vtk.context.CSVListFactoryBean">
    <property name="csvList" value="${permissions.shortcuts.read-write}" />
    <property name="trim" value="true" />
  </bean>

  <bean id="permissionShortcutsProvider.addCommentShortcuts" class="vtk.context.CSVListFactoryBean">
    <property name="csvList" value="${permissions.shortcuts.add-comment}" />
    <property name="trim" value="true" />
  </bean>

  <bean id="permissionShortcutsProvider.readProcessedShortcuts" class="vtk.context.CSVListFactoryBean">
    <property name="csvList" value="${permissions.shortcuts.read-processed}" />
    <property name="trim" value="true" />
  </bean>

  <bean id="permissionShortcutsProvider.config" class="vtk.context.JSONFactoryBean">
    <constructor-arg value="${permissions.shortcuts}" />
  </bean>

  <bean id="redirectToAboutView" class="vtk.web.view.RedirectView">
    <description>Standard HTTP redirect view to the manage service</description>
    <property name="referenceDataProviders">
      <list>
        <ref bean="redirectToAboutProvider" />
      </list>
    </property>
  </bean>

  <bean id="redirectToAboutProvider" class="vtk.web.referencedata.provider.RedirectProvider">
    <property name="redirectToService" ref="aboutResourceService" />
  </bean>

  <bean id="aboutView" parent="freemarkerView">
    <property name="url" value="pages/about.ftl" />
    <property name="referenceDataProviders" ref="aboutView.referenceDataProviders" />
  </bean>

  <bean id="aboutView.referenceDataProviders" class="java.util.ArrayList" />
  
  <bean id="aboutView.referenceDataProvider" 
        class="org.springframework.beans.factory.config.MethodInvokingBean"
        abstract="true">
    <property name="targetObject" ref="aboutView.referenceDataProviders" />
    <property name="targetMethod" value="add" />
  </bean>

  <bean parent="aboutView.referenceDataProvider">
    <property name="arguments" ref="resourceContextProvider" />
  </bean>

  <bean parent="aboutView.referenceDataProvider">
    <property name="arguments" ref="aboutResourceHandler" />
  </bean>

  <bean parent="aboutView.referenceDataProvider">
    <property name="arguments" ref="resourceDetailProvider" />
  </bean>

  <bean id="manageCollectionListingView" parent="freemarkerView">
    <property name="url" value="pages/manage-collectionlisting.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="manageCollectionlistingProvider" />
        <ref bean="resourceContextProvider" />
        <bean class="vtk.web.referencedata.provider.ResourceServiceURLProvider">
          <property name="service" ref="manageCollectionListingService" />
          <property name="modelName" value="action" />
          <property name="urlName" value="submitURL" />
        </bean>
      </list>
    </property>
  </bean>

  <!-- Static files for manage service: -->
  <bean id="manageStaticResourceLocation" class="vtk.resourcemanagement.StaticResourceLocation">
    <property name="uriPrefix" value="${webResources.baseURL}" />
    <property name="resourceLocation" value="${webResources.physicalLocation}" />
  </bean>

  <bean id="manage.staticResourceResolver" class="vtk.resourcemanagement.StaticResourceResolver" />

  <bean class="vtk.web.AdminMedia">
    <constructor-arg ref="manage.javascriptRegistry" />
    <constructor-arg value="preview:head" />
    <constructor-arg>
      <list>
        <value>${jsBaseURL}/cross-doc-com-link.js</value>
        <value>${jsBaseURL}/iframe-admin.js</value>
      </list>
    </constructor-arg>
  </bean>

  <!-- Manage specific providers -->
  <bean id="iframeJSProvider" class="vtk.web.referencedata.provider.StaticModelDataProvider">
    <property name="modelDataMap">
      <map>
        <entry key="javascriptRegistry" value-ref="manage.javascriptRegistry"/>
      </map>
    </property>
  </bean>

  <bean id="adminACLProvider" class="vtk.web.referencedata.provider.ACLProvider">
    <property name="aclInheritanceService" ref="aclInheritanceService" />
    <property name="aclEditServices">
      <map>
        <entry key="READ" value-ref="editReadPermissionsService" />
        <entry key="READ_WRITE" value-ref="editReadWritePermissionsService" />
        <entry key="ALL" value-ref="editAdminPermissionsService" />
        <entry key="ADD_COMMENT" value-ref="editAddCommentPermissionsService" />
        <entry key="READ_PROCESSED" value-ref="editReadProcessedPermissionsService" />
        <entry key="READ_WRITE_UNPUBLISHED" value-ref="editReadWriteUnpublishedPermissionsService" />
      </map>
    </property>
    <property name="permissionShortcuts" ref="permissionShortcuts" />
    <property name="permissionShortcutsConfig" ref="permissionShortcutsProvider.config" />
    <property name="localeResolver" ref="manageLocaleResolver" />
    <property name="documentPrincipalMetadataRetriever" ref="documentPrincipalMetadataRetriever" />
    <property name="principalFactory" ref="principalFactory" />
  </bean>

  <bean id="manageCollectionlistingProvider" class="vtk.web.referencedata.provider.CollectionListingProvider">
    <property name="browsingService" ref="manageService" />
    <property name="aclTooltipHelper" ref="aclTooltipHelper" />
    <property name="childInfoItems">
      <list>
        <value>name</value>
        <value>published</value>
        <value>permissions</value>
        <value>resource-type</value>
        <value>last-modified</value>
      </list>
    </property>
    <property name="retrieveForProcessing" value="false" />
  </bean>

  <bean id="manage.tabMenuProvider" class="vtk.web.referencedata.ServiceReferenceDataProvider">
    <constructor-arg name="service" ref="manageCollectionListingService" />
    <constructor-arg name="provider">
      <bean class="vtk.web.view.components.menu.DefaultListMenuProvider">
        <constructor-arg value="tabMenuRight" />
        <constructor-arg ref="collectionActionServicesFactory" />
      </bean>
    </constructor-arg>
  </bean>

  <bean id="collectionActionServicesFactory" class="vtk.util.SortedCollection">
    <constructor-arg>
      <bean class="org.springframework.core.OrderComparator" />
    </constructor-arg>
    <constructor-arg name="unique" value="true" />
  </bean>

  <bean id="collectionMenuBuilder"
        class="org.springframework.beans.factory.config.MethodInvokingBean" abstract="true">
    <property name="targetObject" ref="collectionActionServicesFactory" />
    <property name="targetMethod" value="add" />
  </bean>

  <bean id="manage.resourceMenuLeftServicesFactory" class="vtk.util.SortedCollection">
    <constructor-arg>
      <bean class="vtk.web.service.ServiceAttributeComparator">
        <property name="attributeName" value="resourceMenuLeftOrder" />
      </bean>
    </constructor-arg>
    <constructor-arg name="unique" value="true" />
  </bean>

  <bean id="manage.resourceMenuLeftBuilder"
        class="org.springframework.beans.factory.config.MethodInvokingBean" abstract="true">
    <property name="targetObject" ref="manage.resourceMenuLeftServicesFactory" />
    <property name="targetMethod" value="add" />
  </bean>

  <bean id="manage.resourceMenuLeftProvider" class="vtk.web.view.components.menu.DefaultListMenuProvider">
    <constructor-arg value="resourceMenuLeft" />
    <constructor-arg value="resourceMenuLeft" />
    <constructor-arg value="true" />
    <constructor-arg ref="manage.resourceMenuLeftServicesFactory" />
  </bean>

  <bean id="resourceMenuLeft.referenceDataProviders" class="vtk.util.SortedCollection">
    <constructor-arg>
      <bean class="org.springframework.core.OrderComparator" />
    </constructor-arg>
    <constructor-arg name="unique" value="true" />
  </bean>

  <bean id="resourceMenuLeft.referenceDataProvidersBuilder"
        class="org.springframework.beans.factory.config.MethodInvokingBean" abstract="true">
    <property name="targetObject" ref="resourceMenuLeft.referenceDataProviders" />
    <property name="targetMethod" value="add" />
  </bean>

  <bean id="manage.resourceMenuRightProvider" class="vtk.web.view.components.menu.DefaultListMenuProvider">
    <constructor-arg value="resourceMenuRight" />
    <constructor-arg value="resourceMenuRight" />
    <constructor-arg value="true" />
    <constructor-arg ref="manage.resourceMenuRightServicesFactory" />
    <constructor-arg ref="resourceMenuRight.referenceDataProviders" />
    <constructor-arg ref="sessionBeanProvider" />
  </bean>

  <bean id="manage.resourceMenuRightServicesFactory" class="vtk.util.SortedCollection">
    <constructor-arg>
      <bean class="vtk.web.service.ServiceAttributeComparator">
        <property name="attributeName" value="resourceMenuRightOrder" />
      </bean>
    </constructor-arg>
    <constructor-arg name="unique" value="true" />
  </bean>

  <bean id="manage.resourceMenuRightBuilder"
        class="org.springframework.beans.factory.config.MethodInvokingBean" abstract="true">
    <property name="targetObject" ref="manage.resourceMenuRightServicesFactory" />
    <property name="targetMethod" value="add" />
  </bean>

  <bean id="resourceMenuRight.referenceDataProviders" class="vtk.util.SortedCollection">
    <constructor-arg>
      <bean class="org.springframework.core.OrderComparator" />
    </constructor-arg>
    <constructor-arg name="unique" value="true" />
  </bean>

  <bean id="resourceMenuRight.referenceDataProvidersBuilder"
        class="org.springframework.beans.factory.config.MethodInvokingBean" abstract="true">
    <property name="targetObject" ref="resourceMenuRight.referenceDataProviders" />
    <property name="targetMethod" value="add" />
  </bean>

  <bean id="manageBreadCrumbProvider" class="vtk.web.referencedata.provider.BreadCrumbProvider">
    <property name="breadcrumbName" value="manageBreadCrumb" />
    <property name="service" ref="manageService" />
  </bean>

  <bean id="versionProvider" class="vtk.web.referencedata.provider.ParameterizableBeanProvider">
    <property name="modelName" value="version" />
    <property name="object">
      <bean class="vtk.util.Version">
      </bean>
    </property>
  </bean>

  <!-- MANAGE assertions -->

  <bean id="manage.postRequestAssertion" class="vtk.web.service.RequestMethodAssertion">
    <property name="method" value="POST" />
  </bean>


  <bean id="manage.permissionAssertion" class="vtk.web.service.OrAssertion">
    <property name="assertions">
      <list>
        <bean class="vtk.web.service.AndAssertion">
          <property name="assertions">
            <list>
              <bean class="vtk.web.service.GroupMembershipAssertion">
                <property name="principalManager" ref="principalManager" />
                <property name="groups" ref="manage.allowedGroups" />
              </bean>
              <bean parent="abstractResourcePrincipalPermissionAssertion">
                <property name="requiresAuthentication" value="true" />
                <property name="considerLocks" value="false" />
                <property name="permission" value="READ" />
              </bean>
            </list>
          </property>
        </bean>
        <bean parent="abstractResourcePrincipalPermissionAssertion">
          <property name="requiresAuthentication" value="true" />
          <property name="considerLocks" value="false" />
          <property name="permission" value="READ_WRITE_UNPUBLISHED" />
        </bean>
        <bean parent="abstractResourcePrincipalPermissionAssertion">
          <property name="requiresAuthentication" value="true" />
          <property name="considerLocks" value="false" />
          <property name="permission" value="ALL" />
        </bean>
      </list>
    </property>
  </bean>

  <bean id="manage.allowedGroups" class="vtk.context.CSVListFactoryBean">
    <property name="csvList" value="${manage.defaultAllowedGroups}" />
  </bean>

  <bean id="requiresReadPermissionAssertion" parent="abstractResourcePrincipalPermissionAssertion">
    <property name="requiresAuthentication" value="true" />
    <property name="permission" value="READ" />
  </bean>

  <bean id="requiresPublishUnpublishPermissionAssertion" parent="abstractResourcePrincipalPermissionAssertion">
    <property name="requiresAuthentication" value="true" />
    <property name="permission" value="PUBLISH_UNPUBLISH" />
  </bean>

  <bean id="requiresReadParentPermissionAssertion" parent="abstractResourcePrincipalPermissionAssertion">
    <property name="parent" value="true" />
    <property name="requiresAuthentication" value="true" />
    <property name="permission" value="READ" />
  </bean>

  <bean id="requiresWritePermissionAssertion" parent="abstractResourcePrincipalPermissionAssertion">
    <property name="requiresAuthentication" value="true" />
    <property name="permission" value="WRITE" />
    <property name="unpublishedPermission" value="READ_WRITE_UNPUBLISHED" />
  </bean>

  <bean id="deleteResourcePermissionAssertion" parent="abstractResourcePrincipalPermissionAssertion">
    <property name="requiresAuthentication" value="true" />
    <property name="permission" value="DELETE" />
    <property name="unpublishedPermission" value="DELETE_UNPUBLISHED" />
  </bean>

  <bean id="writePermissionAssertion" parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" value="WRITE" />
    <property name="unpublishedPermission" value="READ_WRITE_UNPUBLISHED" />
  </bean>

  <bean id="requiresWriteUnpublishedPermissionAssertion" parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" value="READ_WRITE_UNPUBLISHED" />
    <property name="requiresAuthentication" value="true" />
  </bean>

  <bean id="writeUnpublishedPermissionAssertion" parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" value="READ_WRITE_UNPUBLISHED" />
  </bean>

  <!-- Possible temporary assertion to minimize concept impact -->
  <bean id="hasWriteUnpublishedPermissionPrincipalsAssertion" class="vtk.web.service.ResourceHasWriteUnpublishedPermissionPrincipalsAssertion" />

  <bean id="writeParentPermissionAssertion" parent="abstractResourcePrincipalPermissionAssertion">
    <property name="parent" value="true" />
    <property name="permission" value="WRITE" />
  </bean>

  <bean id="bindPermissionAssertion" parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" value="CREATE_UNPUBLISHED" />
  </bean>

  <bean id="writeACLPermissionAssertion" parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" value="WRITE_ACL" />
  </bean>

  <bean id="readProcessedPermissionAssertion" parent="abstractResourcePrincipalPermissionAssertion">
    <property name="requiresAuthentication" value="true" />
    <property name="permission" value="READ_PROCESSED" />
  </bean>

  <bean id="unlockPermissionAssertion" class="vtk.web.service.OrAssertion">
    <property name="assertions">
      <list>
        <bean parent="abstractResourcePrincipalPermissionAssertion">
          <property name="permission" value="ALL" />
          <property name="considerLocks" value="false" />
        </bean>
        <bean class="vtk.web.service.ResourceLockedAssertion">
          <property name="byCurrentUser" value="true" />
        </bean>
      </list>
    </property>
  </bean>

  <bean id="lockPermissionAssertion" parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" value="WRITE" />
    <property name="unpublishedPermission" value="READ_WRITE_UNPUBLISHED" />
  </bean>

  <bean id="delegateOwnershipPermissionAssertion" parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" value="WRITE_ACL" />
  </bean>

  <bean id="adminPermissionAssertion" parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" value="ALL" />
  </bean>

  <bean id="resourceNotRootAssertion" class="vtk.web.service.ResourceURIAssertion">
    <property name="uri" value="/" />
    <property name="inverted" value="true" />
  </bean>

  <bean id="manage.portAssertion" class="vtk.web.service.RequestPortAssertion">
    <property name="port" value="${manage.port}" />
  </bean>

  <bean id="manage.hostNameAssertion" class="vtk.web.service.RequestHostNameAssertion">
    <property name="hostName" value="${manage.hostName}" />
  </bean>

  <bean id="adminVrtxParameterRule" class="vtk.web.service.RequestParameterAssertion">
    <property name="parameterName" value="vrtx" />
    <property name="parameterValue" value="admin" />
  </bean>

  <bean id="manage.refreshLockRequestParameter" class="vtk.web.service.RequestParameterAssertion">
    <property name="parameterName" value="action" />
    <property name="parameterValue" value="refresh-lock" />
  </bean>

  <bean id="manage.adminIndexFileFromViewParameter" class="vtk.web.service.RequestParameterAssertion">
    <property name="parameterName" value="action" />
    <property name="parameterValue" value="admin-index-file-from-view" />
  </bean>

  <bean id="localeParameterEqualsNO" class="vtk.web.service.RequestParameterAssertion">
    <property name="parameterName" value="locale" />
    <property name="parameterValue" value="no" />
  </bean>

  <bean id="localeParameterEqualsNN" class="vtk.web.service.RequestParameterAssertion">
    <property name="parameterName" value="locale" />
    <property name="parameterValue" value="nn" />
  </bean>

  <bean id="localeParameterEqualsEN" class="vtk.web.service.RequestParameterAssertion">
    <property name="parameterName" value="locale" />
    <property name="parameterValue" value="en" />
  </bean>

  <!-- MANAGE error handlers -->
  
  <bean id="abstractReferencedataProvidingErrorHandler" class="vtk.web.DefaultErrorHandler" abstract="true">
    <property name="referenceDataProviders" ref="manageErrorHandler.referenceDataProviders" />
  </bean>

  <bean id="manageErrorHandler.referenceDataProviders" class="java.util.ArrayList">
    <constructor-arg>
      <list>
        <ref bean="leaveAdminLinkProvider" />
        <ref bean="createFromDropDown.docService.urlProvider" />
        <ref bean="createFromDropDown.collService.urlProvider" />
        <ref bean="createFromDropDown.upService.urlProvider" />
        <ref bean="manage.tabsProvider" />
        <ref bean="resourceContextProvider" />
        <ref bean="versionProvider" />
        <ref bean="manageBreadCrumbProvider" />
        <!--ref bean="lockUnlockActionsProvider" /-->
        <ref bean="switchLocaleActionsProvider" />
        <ref bean="manage.resourceMenuLeftProvider" />
        <ref bean="manage.resourceMenuRightProvider" />
        <ref bean="resourceDetailProvider" />
        <!--ref bean="readPermissionsProvider" /-->
        <ref bean="publishProvider" />
        <ref bean="sessionBeanProvider" />
      </list>
    </constructor-arg>
  </bean>

  <bean id="sessionBeanProvider" class="vtk.web.referencedata.provider.SessionBeanProvider">
    <property name="attributeName" value="copymovesession" />
    <property name="modelName" value="session" />
  </bean>

  <bean id="defaultManageErrorHandler" class="vtk.web.DefaultErrorHandler">
    <property name="service" ref="manageService" />
    <property name="errorViewName" value="defaultManageError" />
    <property name="viewResolver" ref="manageErrorViewResolver" />
    <property name="referenceDataProviders" ref="manageErrorHandler.referenceDataProviders" />
    <property name="statusCodeMappings">
      <map>
        <entry key="vtk.repository.ResourceNotFoundException" value="404" />
        <entry key="vtk.repository.AuthorizationException" value="403" />
      </map>
    </property>
  </bean>
  <bean parent="vtk.errorHandlers.builder">
    <property name="arguments" ref="defaultManageErrorHandler" />
  </bean>

  <bean id="manageErrorViewResolver" class="vtk.web.decorating.MappingViewResolver">
    <constructor-arg name="views">
      <map>
        <entry key="defaultManageError" value-ref="defaultManageErrorView" />
      </map>
    </constructor-arg>
  </bean>

  <bean id="defaultManageErrorView" parent="freemarkerView">
    <property name="url" value="pages/error/default-manage-error.ftl" />
  </bean>

  <bean id="requestLocaleNotNorwegianNB" class="vtk.web.service.RequestLocaleMatchAssertion">
    <property name="invert" value="true" />
    <property name="locale">
      <bean class="java.util.Locale">
        <constructor-arg>
          <value>no</value>
        </constructor-arg>
      </bean>
    </property>
    <property name="localeResolver" ref="manageLocaleResolver" />
  </bean>

  <bean id="requestLocaleNotNorwegianNN" class="vtk.web.service.RequestLocaleMatchAssertion">
    <property name="invert" value="true" />
    <property name="locale">
      <bean class="java.util.Locale">
        <constructor-arg>
          <value>nn</value>
        </constructor-arg>
      </bean>
    </property>
    <property name="localeResolver" ref="manageLocaleResolver" />
  </bean>

  <bean id="requestLocaleNotEnglish" class="vtk.web.service.RequestLocaleMatchAssertion">
    <property name="invert" value="true" />
    <property name="locale">
      <bean class="java.util.Locale">
        <constructor-arg>
          <value>en</value>
        </constructor-arg>
      </bean>
    </property>
    <property name="localeResolver" ref="manageLocaleResolver" />
  </bean>

  <!-- Locale resolver for manage service -->
  <bean id="manageLocaleResolver" class="org.springframework.web.servlet.i18n.CookieLocaleResolver">
    <property name="cookieDomain" value="${manage.localeResolver.cookieDomain}" />
    <property name="cookieName" value="${manage.localeresolver.cookieName}" />
    <property name="cookieMaxAge" value="315360000" />
    <property name="defaultLocale">
      <bean class="java.util.Locale">
        <constructor-arg value="${manage.defaultLocale}" />
      </bean>
    </property>
  </bean>

  <!-- Email -->
  <bean id="email.executor" class="vtk.util.mail.MailExecutor">
    <constructor-arg ref="email.taskExecutor" />
    <constructor-arg ref="email.javaMailSender" />
    <constructor-arg value="${email.recipients.alwaysAcceptDomains}" />
  </bean>

  <bean id="email.javaMailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
    <property name="host" value="${email.mailServer}" />
    <property name="port" value="${email.mailServerPort}" />
    <property name="protocol" value="${email.mailServerProtocol}" />
    <property name="defaultEncoding" value="utf-8" />
  </bean>

  <bean id="email.taskExecutor" class="org.springframework.core.task.SimpleAsyncTaskExecutor">
    <property name="concurrencyLimit" value="${email.concurrencyLimit}" />
  </bean>

  <!-- <bean id="taskExecutor" class="org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor"> <property name="corePoolSize"
    value="10" /> <property name="maxPoolSize" value="25" /> <property name="queueCapacity" value="50" /> </bean> -->

  <bean id="emailApprovalService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="-999" />
    <property name="handler" ref="emailApprovalHandler" />
    <property name="assertions">
      <list>
        <ref bean="writeUnpublishedPermissionAssertion" />
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="email-approval" />
        </bean>
      </list>
    </property>
  </bean>

  <bean id="emailApprovalHandler" class="vtk.web.actions.publish.ApprovalViaEmailController">
    <property name="manageService" ref="manageService" />
    <property name="viewName" value="emailApproval.view" />
    <property name="resourceManager" ref="resourceManager" />
    <property name="mailExecutor" ref="email.executor" />
    <property name="mailTemplateProvider" ref="emailApproval.mailTemplateProvider" />
    <property name="editorialContactsPropDef" ref="editorialContactsPropDef" />
    <property name="principalFactory" ref="principalFactory" />
  </bean>

  <bean id="emailApproval.view" parent="freemarkerView">
    <property name="url" value="pages/email-approval.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
      </list>
    </property>
  </bean>

  <bean id="emailApproval.mailTemplateProvider" class="vtk.util.mail.MailTemplateProvider">
    <property name="view" ref="emailApproval.mailTemplateView" />
    <property name="resourceDetailProvider" ref="resourceDetailProvider" />
  </bean>

  <bean id="emailApproval.mailTemplateView" parent="freemarkerView">
    <property name="url" value="pages/approval-mail-template.ftl"></property>
  </bean>

  <!-- Reauthenticate -->

  <bean id="reauthenticate" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="-999" />
    <property name="assertions">
      <list>
        <bean class="vtk.web.service.RequestParameterAssertion">
          <property name="parameterName" value="service" />
          <property name="parameterValue" value="reauthenticate" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="reauthenticateHandler" />
    <property name="attributes">
      <map>
        <entry key="x-prevent-decorating" value="true" />
      </map>
    </property>
  </bean>

  <bean id="reauthenticateHandler" class="org.springframework.web.servlet.mvc.ParameterizableViewController">
    <property name="viewName" value="reauthenticate.view" />
  </bean>

  <bean id="reauthenticate.view" parent="freemarkerView">
    <property name="url" value="pages/reauth.ftl"></property>
  </bean>


  <bean id="manage.actionService" class="vtk.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="-100" />
    <property name="assertions">
      <list>
        <bean class="vtk.web.service.RequestMethodAssertion">
          <property name="method" value="GET"/>
        </bean>
        <bean class="vtk.web.service.RequestParameterExistsAssertion">
          <property name="parameterName" value="admin-action" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="manage.actionService.handler" />
    <property name="attributes">
      <map>
        <entry key="x-prevent-decorating" value="true" />
      </map>
    </property>
  </bean>

  <bean id="manage.actionService.inputProvider" class="vtk.util.repository.RepositoryInputSourceProvider">
    <constructor-arg name="repository" ref="repository" />
    <constructor-arg name="prefix">
      <bean parent="uri.abstractBean">
        <property name="arguments" value="${manage.dynamicActionsLocation}" />
      </bean>
    </constructor-arg>
  </bean>

  <bean id="manage.actionService.handler" class="vtk.web.ActionTemplateHandler">
    <constructor-arg name="provider" ref="manage.actionService.inputProvider" />
    <constructor-arg name="parameter" value="admin-action" />
    <constructor-arg name="referenceDataProviders">
      <list>
        <bean class="vtk.web.referencedata.provider.ParameterizableBeanProvider">
          <property name="modelName" value="webResources" />
          <property name="object" value="${webResources.baseURL}" />
        </bean>
        <ref bean="resourceContextProvider" />
      </list>
    </constructor-arg>
  </bean>

  <!-- Override to be able to construct links based on admin permission: -->
  <bean id="manage.actionService.withAdminPermission" parent="manage.actionService">
    <property name="parent" ref="manage.actionService" />
    <property name="assertions" ref="adminPermissionAssertion"/>
  </bean>

  <!-- Override to be able to construct links based on admin permission: -->
  <bean id="manage.actionService.withWritePermission" parent="manage.actionService">
    <property name="parent" ref="manage.actionService" />
    <property name="assertions" ref="writePermissionAssertion"/>
  </bean>

</beans>
