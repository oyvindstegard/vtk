<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd">

  <bean id="clientaddr.authenticationHandler" class="vtk.security.web.clientaddr.ClientAddressAuthenticationHandler">
    <constructor-arg name="identifier" value="ClientAddr" />
    <constructor-arg name="provider" ref="clientaddr.specProvider" />
  </bean>

  <bean id="clientaddr.specProvider" class="vtk.security.web.clientaddr.JsonClientAddrSpec" />

  <bean id="clientaddr.jsonHandler" class="vtk.util.repository.ResourceJsonEvents">
    <constructor-arg name="consumer" ref="clientaddr.specProvider" />
  </bean>

  <bean id="clientaddr.configEventSource" class="vtk.util.repository.ResourceContentEvents">
    <constructor-arg name="uri">
      <bean parent="uri.abstractBean">
        <property name="arguments" value="${clientaddrauth.config}" />
      </bean>
    </constructor-arg>
    <constructor-arg name="token" ref="trustedToken" />
    <constructor-arg name="consumer" ref="clientaddr.jsonHandler" />
  </bean>

  <!-- XXX: must also send cluster events -->
  <bean id="clientaddr.eventEmitter" class="vtk.util.repository.RepositoryEventHandler">
    <constructor-arg name="async" value="true" />
    <constructor-arg name="consumer" ref="clientaddr.configEventSource" />
  </bean>

</beans>

