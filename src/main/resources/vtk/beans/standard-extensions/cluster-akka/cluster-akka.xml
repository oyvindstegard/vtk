<?xml version="1.0" encoding="utf-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd">

  <!-- Override bean "systemIndexAccessor" in vtk/beans/query.xml -->
  <bean id="systemIndexAccessor" class="vtk.repository.index.IndexManager">
    <property name="storageRootPath" value="${indexStorageRootPath}"/>
    <property name="storageId" value="property_index"/>
    <property name="forceUnlock" value="true"/>
    <property name="maxLockAcquireTimeOnShutdown" value="20"/>
    <property name="searcherFactory" ref="searcherFactory"/>
    <property name="keepOldCommits" value="5" />
    <property name="useSimpleLockFactory" value="true" />
    <property name="writeLockTimeoutSeconds" value="30" />
  </bean>

  
  <!-- Override bean "systemIndex" in vtk/beans/query.xml -->
  <bean id="systemIndex" class="vtk.repository.index.PropertySetIndexImpl">
    <property name="indexAccessor" ref="systemIndexAccessor"/>
    <property name="documentMapper" ref="documentMapper"/>
    <property name="initClusterRole" value="SLAVE" />
  </bean>

  <bean id="akka.actorSystem.config" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
    <property name="targetObject">
      <bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="targetClass" value="com.typesafe.config.ConfigFactory" />
        <property name="targetMethod" value="parseString" />
        <property name="arguments">
          <list>
            <value type="java.lang.String">akka.remote.netty.tcp.port=${cluster.port}</value>
          </list>
        </property>
      </bean>
    </property>
    <property name="targetMethod" value="withFallback" />
    <property name="arguments">
      <bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="targetClass" value="com.typesafe.config.ConfigFactory" />
        <property name="targetMethod" value="load" />
      </bean>
    </property>
  </bean>


  <bean id="akka.actorSystem" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
    <property name="targetClass" value="akka.actor.ActorSystem" />
    <property name="targetMethod" value="create" />
    <property name="arguments">
      <list>
        <value type="java.lang.String">vtk-cluster</value>
        <ref bean="akka.actorSystem.config" />
      </list>
    </property>
  </bean>

  <bean id="cluster.manager" class="vtk.cluster.AkkaClusterManager" 
        init-method="init" destroy-method="destroy">
    <!--constructor-arg name="port" value="${cluster.port}" /-->
    <constructor-arg name="system" ref="akka.actorSystem" />
    <constructor-arg name="clusterComponents" ref="cluster.components" />
  </bean>


</beans>

