<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

  <!-- File resource -->

  <bean id="fileResourceTypeDefinition"
    class="org.vortikal.repository.resourcetype.PrimaryResourceTypeDefinitionImpl">
    <property name="name" value="file" />
    <property name="namespace" ref="DEFAULT_NAMESPACE" />
    <property name="parentTypeDefinition" ref="resourceResourceTypeDefinition" />

    <property name="propertyTypeDefinitions">
      <list>
        <ref bean="contentTypePropDef" />
        <ref bean="contentLengthPropDef" />
      </list>
    </property>

    <property name="assertions">
      <list>
        <ref bean="fileAssertion" />
      </list>
    </property>
  </bean>

  <bean id="contentTypePropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl">
    <property name="name" value="contentType" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_ACL_WRITE" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="contentTypeEvaluator" />
  </bean>

  <bean id="contentTypeEvaluator" class="org.vortikal.repository.resourcetype.property.ContentTypeEvaluator" />

  <bean id="contentLengthPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl">
    <property name="name" value="contentLength" />
    <property name="type" value="LONG" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_UNEDITABLE" />
    <property name="mandatory" value="true" />
    <property name="contentModificationEvaluator" ref="contentLengthEvaluator" />
    <property name="defaultValue">
      <bean class="org.vortikal.repository.resourcetype.Value">
        <constructor-arg type="long">
          <value>0</value>
        </constructor-arg>
      </bean>
    </property>
  </bean>

  <bean id="contentLengthEvaluator" class="org.vortikal.repository.resourcetype.property.ContentLengthEvaluator" />

  <!-- Assertion that matches all non-collection resources (files) -->
  <bean id="fileAssertion" class="org.vortikal.web.service.ResourceIsCollectionAssertion">
    <property name="invert" value="true" />
  </bean>


  <!-- Content type assertions -->

  <bean id="contentTypeMatchesText" class="org.vortikal.web.service.ResourceContentTypeRegexpAssertion">
    <property name="pattern" value="(application/(x-)?xml)|(text/(plain|html|xml))" />
  </bean>

  <bean id="contentTypeMatchesAnyText" class="org.vortikal.web.service.ResourceContentTypeRegexpAssertion">
    <property name="pattern" value="text/.+" />
    <property name="exceptionPattern" value="text/rtf" />
  </bean>

  <!-- Assertion that matches on all textual content types: -->
  <bean id="contentTypeIsTextual" 
        class="org.vortikal.web.service.ResourceContentTypeRegexpAssertion">
    <property name="pattern" value="(application/(x-)?xml)|(application/x-php)|(text/(.+))" />
    <property name="exceptionPattern" value="text/rtf" />
  </bean>


  <bean id="contentTypeMatchesXml" class="org.vortikal.web.service.ResourceContentTypeRegexpAssertion">
    <property name="pattern" value="(text|application)/(x-)?xml" />
  </bean>

  <bean id="contentTypeMatchesHtml" class="org.vortikal.web.service.ResourceContentTypeRegexpAssertion">
    <property name="pattern" value="text/html" />
  </bean>

  <bean id="contentTypeMatchesTextOrHtml" class="org.vortikal.web.service.ResourceContentTypeRegexpAssertion">
    <property name="pattern" value="text/(plain|html)" />
  </bean>

  <bean id="contentTypeMatchesXmlOrHtml" class="org.vortikal.web.service.ResourceContentTypeRegexpAssertion">
    <property name="pattern" value="(application/(x-)?xml)|(text/(xml|html))" />
  </bean>

  <bean id="contentTypeMatchesXmlOrHtmlOrCollection"
    class="org.vortikal.web.service.ResourceContentTypeRegexpAssertion">
    <property name="pattern" value="(application/(x-)?xml)|(text/(xml|html))|(application/x-vortex-collection)" />
  </bean>

  <bean id="contentTypeMatchesImage" class="org.vortikal.web.service.ResourceContentTypeRegexpAssertion">
    <property name="pattern" value="image/.+" />
  </bean>

</beans>
