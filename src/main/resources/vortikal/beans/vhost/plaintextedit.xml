<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" 
"http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

  
  <bean id="plaintextEditService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="categories">
      <set>
        <value>tabMenu</value>
      </set>
    </property>
    <property name="attributes">
      <map>
        <entry key="tabOrder"><value type="java.lang.Integer">160</value></entry>
      </map>
    </property>
    <property name="order" value="-100" />
    <property name="assertions">
      <list>
        <ref bean="requiresWritePermissionAssertion" />
        <ref bean="actionParameterEqualsPlaintextEdit" />

        <ref bean="resourceTypeIsText" />
        <ref bean="resourceTypeIsNotManagedXml" />
      </list>
    </property>
    <property name="handler">
      <ref bean="plaintextEditHandler" />
    </property>
  </bean>

  <bean id="plaintextXMLEditService" parent="plaintextEditService">
    <property name="assertions">
      <list>
        <ref bean="requiresWritePermissionAssertion" />
        <ref bean="actionParameterEqualsPlaintextEdit" />
        <ref bean="resourceTypeIsManagedXml" />
        <ref bean="plaintextEditPropertyIsSet" />
      </list>
    </property>
  </bean>

  <bean id="resourceTypeIsText" class="org.vortikal.web.service.ResourceTypeAssertion">
    <property name="resourceTypeDefinition" ref="textResourceTypeDefinition" />
  </bean>

  <bean id="resourceTypeIsNotManagedXml" parent="resourceTypeIsManagedXml">
    <property name="invert" value="true" />
  </bean>

  <bean id="plaintextEditPropertyIsSet"
        class="org.vortikal.web.service.ResourcePropertyAssertion">
    <property name="namespace" ref="DEFAULT_NAMESPACE" />
    <property name="name" value="plaintext-edit" />
    <property name="checkExistenceOnly" value="true" />
  </bean>

  <bean id="actionParameterEqualsPlaintextEdit"
        class="org.vortikal.web.service.RequestParameterAssertion">
    <property name="parameterName" value="action" />
    <property name="parameterValue" value="plaintext-edit" />
  </bean>

  <bean id="plaintextViewResolver" parent="adminViewResolver">
    <property name="views">
      <map>
        <entry key="plaintextEdit" value-ref="plaintextEditView" />
      </map>
    </property>
  </bean>


  <bean id="plaintextEditView" parent="freemarkerView">
    <property name="url" value="pages/plaintext-edit.ftl" />
    <property name="referenceDataProviders">
      <list>
        <bean class="org.vortikal.web.referencedata.provider.StaticModelDataProvider">
          <property name="modelDataMap">
            <map>
              <entry key="cssURLs" value-ref="plainEditCSSURLs" />
            </map>
          </property>
        </bean>
      </list>
    </property>
  </bean>

  <bean id="plainEditCSSURLs" class="java.util.ArrayList">
    <constructor-arg>
      <list>
        <value>${cssBaseURL}/basic.css</value>
        <value>${cssBaseURL}/tabs.css</value>
        <value>${cssBaseURL}/plain-edit.css</value>
      </list>
    </constructor-arg>
  </bean>

  <!-- Plaintext edit controller -->
  
  <bean id="plaintextEditHandler"
        class="org.vortikal.edit.plaintext.PlaintextEditController"
        parent="requestLocalRepositoryAware">
    <property name="formView" value="plaintextEdit" />
    <property name="successView" value="plaintextEdit" />
    <property name="cancelView" value="redirectToManage" />
    <property name="commandName" value="plaintextEditForm" />
    <property name="commandClass" value="org.vortikal.edit.plaintext.PlaintextEditCommand" />
  </bean>

</beans>
