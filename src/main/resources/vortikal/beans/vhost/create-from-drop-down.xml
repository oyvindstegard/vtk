<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" 
                       "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

  <!-- Retrieve services -->

  <bean id="createDocumentDropDown.retrieveService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="-9999" />
    <property name="assertions">
      <list>
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="service" />
          <property name="parameterValue" value="create-document-from-drop-down" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="createDocumentDropDown.handler" />
  </bean>

  <bean id="createDocumentDropDown.handler" class="org.vortikal.web.actions.create.CreateDropDownJSON">
    <property name="provider" ref="createDropDown.provider" />
    <property name="service" ref="createDocumentService" />
  </bean>

  <bean id="createCollectionDropDown.retrieveService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="-9999" />
    <property name="assertions">
      <list>
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="service" />
          <property name="parameterValue" value="create-collection-from-drop-down" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="createCollectionDropDown.handler" />
  </bean>

  <bean id="createCollectionDropDown.handler" class="org.vortikal.web.actions.create.CreateDropDownJSON">
    <property name="provider" ref="createDropDown.provider" />
    <property name="service" ref="createCollectionService" />
  </bean>

  <bean id="uploadFileDropDown.retrieveService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="-9999" />
    <property name="assertions">
      <list>
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="service" />
          <property name="parameterValue" value="upload-file-from-drop-down" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="uploadFileDropDown.handler" />
  </bean>

  <bean id="uploadFileDropDown.handler" class="org.vortikal.web.actions.create.CreateDropDownJSON">
    <property name="provider" ref="createDropDown.provider" />
    <property name="service" ref="fileUploadService" />
  </bean>
  
  <bean id="createDropDown.provider" class="org.vortikal.web.actions.create.CreateDropDownProvider">
    <property name="searcher" ref="systemIndexSearcher" />
    <property name="repository" ref="repository" />
  </bean>
  
  <bean id="createCollectionFromDropDownIframeService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="viewService" />
    <property name="handler" ref="createCollectionFromDropDownIframeHandler" />
    <property name="assertions">
      <bean class="org.vortikal.web.service.RequestParameterAssertion">
        <property name="parameterName" value="display" />
        <property name="parameterValue" value="create-collection-from-drop-down-iframe" />
      </bean>
    </property>
  </bean>

  <bean id="createCollectionFromDropDownIframeHandler" class="org.vortikal.web.actions.create.CreateFromDropDownIframeController">
    <property name="viewName" value="createFromDropDownIframe.view" />
    <property name="serviceUri" value="create-collection" />
  </bean>

  <bean id="createCollectionFromDropDownService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="handler" ref="createCollectionFromDropDownHandler" />
    <property name="assertions">
      <bean class="org.vortikal.web.service.RequestParameterAssertion">
        <property name="parameterName" value="display" />
        <property name="parameterValue" value="create-collection-from-drop-down" />
      </bean>
    </property>
  </bean>

  <bean id="createCollectionFromDropDownHandler" class="org.vortikal.web.actions.create.CreateFromDropDownController">
    <property name="viewName" value="createFromDropDown.view" />
    <property name="type" value="create-collection" />
  </bean>
  
  <bean id="createDocFromDropDownIframeService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="viewService" />
    <property name="handler" ref="createDocFromDropDownIframeHandler" />
    <property name="assertions">
      <bean class="org.vortikal.web.service.RequestParameterAssertion">
        <property name="parameterName" value="display" />
        <property name="parameterValue" value="create-document-from-drop-down-iframe" />
      </bean>
    </property>
  </bean>

  <bean id="createDocFromDropDownIframeHandler" class="org.vortikal.web.actions.create.CreateFromDropDownIframeController">
    <property name="viewName" value="createFromDropDownIframe.view" />
    <property name="serviceUri" value="create-document" />
  </bean>

  <bean id="createDocFromDropDownService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="handler" ref="createDocFromDropDownHandler" />
    <property name="assertions">
      <bean class="org.vortikal.web.service.RequestParameterAssertion">
        <property name="parameterName" value="display" />
        <property name="parameterValue" value="create-document-from-drop-down" />
      </bean>
    </property>
  </bean>

  <bean id="createDocFromDropDownHandler" class="org.vortikal.web.actions.create.CreateFromDropDownController">
    <property name="viewName" value="createFromDropDown.view" />
    <property name="type" value="create-document" />
  </bean>
  
  <bean id="uploadFileFromDropDownIframeService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="viewService" />
    <property name="handler" ref="uploadFileFromDropDownIframeHandler" />
    <property name="assertions">
      <bean class="org.vortikal.web.service.RequestParameterAssertion">
        <property name="parameterName" value="display" />
        <property name="parameterValue" value="upload-file-from-drop-down-iframe" />
      </bean>
    </property>
  </bean>

  <bean id="uploadFileFromDropDownIframeHandler" class="org.vortikal.web.actions.create.CreateFromDropDownIframeController">
    <property name="viewName" value="createFromDropDownIframe.view" />
    <property name="serviceUri" value="upload-file" />
  </bean>
  
  <bean id="uploadFileFromDropDownService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="handler" ref="uploadFileFromDropDownHandler" />
    <property name="assertions">
      <bean class="org.vortikal.web.service.RequestParameterAssertion">
        <property name="parameterName" value="display" />
        <property name="parameterValue" value="upload-file-from-drop-down" />
      </bean>
    </property>
  </bean>

  <bean id="uploadFileFromDropDownHandler" class="org.vortikal.web.actions.create.CreateFromDropDownController">
    <property name="viewName" value="createFromDropDown.view" />
    <property name="type" value="upload-file" />
  </bean>

  <bean id="createFromDropDown.viewResolver" parent="viewResolver">
    <property name="views">
      <map>
        <entry key="createFromDropDownIframe.view" value-ref="createFromDropDownIframe.view" />
        <entry key="createFromDropDown.view" value-ref="createFromDropDown.view" />
      </map>
    </property>
  </bean>
  
  <bean id="createFromDropDownIframe.view" parent="freemarkerView">
    <property name="url" value="pages/create-from-drop-down-iframe.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
        <ref bean="createFromDropDown.docService.urlProvider" />
        <ref bean="createFromDropDown.collService.urlProvider" />
        <ref bean="createFromDropDown.upService.urlProvider" />
      </list>
    </property>
  </bean>

  <bean id="createFromDropDown.view" parent="freemarkerView">
    <property name="url" value="pages/create-from-drop-down.ftl" />
    <property name="referenceDataProviders">
      <ref bean="resourceContextProvider" />
    </property>
    <property name="attributesMap">
      <map>
        <entry key="cssURLs">
          <list>
            <value>${themeBaseURL}/default.css</value>
            <value>${themeBaseURL}/report/jquery.treeview.css</value>
          </list>
        </entry>
        <entry key="jsURLs">
          <list>
            <value>${webResources.baseURL}/jquery/jquery-${jquery.version}.min.js"></value>
            <value>${webResources.baseURL}/jquery/plugins/jquery.vortexTips.js</value>
            <value>${webResources.baseURL}/jquery/plugins/jquery.treeview.js</value>
            <value>${webResources.baseURL}/jquery/plugins/jquery.treeview.async.js</value>
            <value>${webResources.baseURL}/jquery/plugins/jquery.scrollTo-1.4.2-min.js"></value>
          </list>
        </entry>
      </map>
    </property>
  </bean>
  
  <bean id="createFromDropDown.docService.urlProvider" class="org.vortikal.web.referencedata.provider.ResourceServiceURLProvider">
    <property name="service" ref="createDocFromDropDownService" />
    <property name="modelName" value="docUrl" />
    <property name="urlName" value="url" />
  </bean>
  <bean id="createFromDropDown.collService.urlProvider" class="org.vortikal.web.referencedata.provider.ResourceServiceURLProvider">
    <property name="service" ref="createCollectionFromDropDownService" />
    <property name="modelName" value="collUrl" />
    <property name="urlName" value="url" />
  </bean>
  <bean id="createFromDropDown.upService.urlProvider" class="org.vortikal.web.referencedata.provider.ResourceServiceURLProvider">
    <property name="service" ref="uploadFileFromDropDownService" />
    <property name="modelName" value="upUrl" />
    <property name="urlName" value="url" />
  </bean>
  
  <bean id="createFromDropDownIframe.docService.urlProvider" class="org.vortikal.web.referencedata.provider.ResourceServiceURLProvider">
    <property name="service" ref="createDocFromDropDownIframeService" />
    <property name="modelName" value="docUrl" />
    <property name="urlName" value="url" />
  </bean>
  <bean id="createFromDropDownIframe.collService.urlProvider" class="org.vortikal.web.referencedata.provider.ResourceServiceURLProvider">
    <property name="service" ref="createCollectionFromDropDownIframeService" />
    <property name="modelName" value="collUrl" />
    <property name="urlName" value="url" />
  </bean>
  <bean id="createFromDropDownIframe.upService.urlProvider" class="org.vortikal.web.referencedata.provider.ResourceServiceURLProvider">
    <property name="service" ref="uploadFileFromDropDownIframeService" />
    <property name="modelName" value="upUrl" />
    <property name="urlName" value="url" />
  </bean>

</beans>