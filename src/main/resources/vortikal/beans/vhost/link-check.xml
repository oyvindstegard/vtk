<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" 
                       "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

  <bean id="linkCheckService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="-999" />
    <property name="assertions">
      <list>
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="link-check" />
        </bean>
        <bean class="org.vortikal.web.service.OrAssertion">
          <property name="assertions">
            <list>
              <ref bean="htmlOrJsonContentTypeAssertion" />
              <ref bean="hasIndexFileAssertion" />
            </list>
          </property>
        </bean>
      </list>
    </property>
    <property name="handler" ref="linkCheckHandler" />
  </bean>

  <bean id="htmlOrJsonContentTypeAssertion" class="org.vortikal.web.service.OrAssertion">
    <property name="assertions">
      <list>
        <ref bean="contentTypeMatchesHtml" />
        <ref bean="json.contentTypeAssertion" />
      </list>
    </property>
  </bean>

  <bean id="linkCheckHandler" class="org.vortikal.web.display.linkcheck.LinkCheckController" parent="repositoryAware">
    <property name="cacheManager" ref="ehCacheManager" />
  </bean>

</beans>