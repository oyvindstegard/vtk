<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>
  
  <bean id="structuredResources.typeAssertion" class="org.vortikal.web.service.ResourceTypeAssertion">
    <property name="resourceTypeDefinition" ref="json.managedObjectResourceType" />
  </bean>

  <bean id="structuredResources.displayService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="displayResourceService" />
    <property name="assertions">
      <list>
        <ref bean="structuredResources.typeAssertion" />
      </list>
    </property>
    <property name="handlerInterceptors">
      <list>
        <ref bean="noCacheViewHandlerInterceptor" />
      </list>
    </property>
    <property name="handler" ref="structuredResources.displayHandler" />
  </bean>
  
  <bean id="structuredResources.previewService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="previewService" />
    <property name="assertions">
      <list>
        <ref bean="structuredResources.typeAssertion" />
      </list>
    </property>
    <property name="handler" ref="previewIframeHandler" />
  </bean>

  <bean id="structuredResources.editService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="-9800" />
    <property name="assertions">
      <list>
        <ref bean="structuredResources.typeAssertion" />
        <ref bean="requiresWritePermissionAssertion" />
        <ref bean="editor.modeParameterAssertion" />
        <ref bean="editor.parameterEqualsEdit" />
      </list>
    </property>
    <property name="categories">
      <set>
        <value>tabMenu</value>
      </set>
    </property>
    <property name="attributes">
      <map>
        <entry key="tabOrder">
          <value type="java.lang.Integer">152</value>
        </entry>
      </map>
    </property>
    <property name="handler" ref="structuredResources.editHandler" />
  </bean>
  
  <bean id="structuredResources.displayHandler"
        class="org.vortikal.resourcemanagement.view.StructuredResourceDisplayController"
    parent="requestLocalRepositoryAware"
    depends-on="structuredResource.parser">
    <property name="viewName" value="structuredResources.displayView" />
    <property name="viewService" ref="viewService" />
    <property name="queryParserFactory" ref="queryParserFactory" />
    <property name="searcher" ref="systemIndexSearcher" />
    <property name="resourceManager" ref="structuredResources.resourceManager" />
    <property name="htmlParser" ref="decorating.htmlParser" />
    <property name="templateManager" ref="structuredResources.templateManager" />
    <property name="resourceModelKey" value="structured-resource" />
    <property name="valueFormatterRegistry" ref="valueFormatterRegistry" />
    <property name="postFilter" ref="decorating.ssiNodeFilter" />
    <property name="configProviders">
      <list>
        <bean class="org.vortikal.web.referencedata.provider.FixedResourceServiceURLProvider">
          <property name="repository" ref="repository" />
          <property name="uri" value="/" />
          <property name="appendPath" value="${flash.baseURL}/audioplayer.swf" />
          <property name="service" ref="viewService" />
          <property name="modelName" value="flashPlayer" />
          <property name="urlName" value="flashURL" />
        </bean>
        <bean class="org.vortikal.web.referencedata.provider.FixedResourceServiceURLProvider">
          <property name="repository" ref="repository" />
          <property name="uri" value="/" />
          <property name="appendPath" value="${jsBaseURL}/audio-player.js" />
          <property name="service" ref="viewService" />
          <property name="modelName" value="flashPlayer" />
          <property name="urlName" value="jsURL" />
        </bean>
      </list>
    </property>
  </bean>

  <bean id="structuredResources.templateManager" class="org.vortikal.resourcemanagement.view.DecoratorTemplateManager">
    <property name="templateFactory" ref="structuredResources.decoratorTemplateFactory" />
    <property name="resourceManager" ref="structuredResources.resourceManager" />
  </bean>
  
  <bean id="structuredResources.decoratorTemplateFactory"
        class="org.vortikal.web.decorating.ParsedHtmlDecoratorTemplateFactory">
    <property name="htmlParser" ref="decorating.htmlParser" />
    <property name="componentResolver" ref="decorating.defaultComponentResolver" />
    <property name="componentParser" ref="decorating.dollarSyntaxTemplateParser" />
  </bean>

  <bean id="structuredResources.componentNamespace" class="java.lang.String">
    <constructor-arg type="java.lang.String" value="json" />
  </bean>

  <bean id="structuredResources.fieldSelectComponent"
        class="org.vortikal.resourcemanagement.view.StructuredResourceFieldComponent">
    <property name="namespace" ref="structuredResources.componentNamespace" />
    <property name="name" value="field" />
    <property name="resourceModelKey" value="structured-resource" />
  </bean>

  <bean id="structuredResources.editHandler" class="org.vortikal.resourcemanagement.edit.StructuredResourceEditor">
    <property name="resourceManager" ref="structuredResources.resourceManager" />
    <property name="repository" ref="repository" />
    <property name="formView" value="structuredResources.editView" />
    <property name="successView" value="redirectToManage" />
  </bean>
  
  <bean id="structuredResources.viewResolver" parent="decoratorViewResolver">
    <property name="views">
      <map>
        <entry key="structuredResources.displayView" value-ref="structuredResources.displayView" />
      </map>
    </property>
  </bean>
  
  <bean id="structuredResources.wrappingViewResolver" parent="adminViewResolver">
    <property name="views">
      <map>
        <entry key="structuredResources.editView" value-ref="structuredResources.editView" />
      </map>
    </property>
  </bean>
  
  <bean id="structuredResources.displayView" class="org.vortikal.web.decorating.TemplateView">
    <property name="templateRef" value="structured-resources.template" />
    <property name="templateManager" ref="article.templateManager" />
  </bean>
  
  <bean id="structuredResources.editView" parent="freemarkerView">
    <property name="url" value="structured-resources/editor.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
        <bean class="org.vortikal.web.referencedata.provider.FixedResourceServiceURLProvider">
          <property name="repository" ref="repository" />
          <property name="service" ref="staticResourceService" />
          <property name="uri" value="/" />
          <property name="appendPath" value="${editor.fck.resourcesURL}" />
          <property name="modelName" value="fckeditorBase" />
          <property name="urlName" value="url" />
        </bean>
        <bean class="org.vortikal.web.referencedata.provider.StaticURIServiceURLProvider">
          <property name="service" ref="editor.browseService" />
          <property name="path" value="${editor.fck.browseURL}" />
          <property name="modelName" value="fckBrowse" />
        </bean>
                <bean class="org.vortikal.web.referencedata.provider.ResourceServiceURLProvider">
          <property name="repository" ref="repository" />
          <property name="service" ref="viewService" />
          <property name="modelName" value="fckeditorBase" />
          <property name="urlName" value="documentURL" />
        </bean>
        
        <bean class="org.vortikal.web.referencedata.provider.StaticModelDataProvider">
          <property name="modelDataMap">
            <map>
              <entry key="jsBaseURL" value="${jsBaseURL}" />
              <entry key="webResources" value="${webResources.baseURL}" />
              <entry key="themeBaseURL" value="${themeBaseURL}" />
            </map>
          </property>
        </bean>
      </list>
    </property>
  </bean>
        
  <!-- Head components for CSS and JavaScript -->     
        
  <bean id="person.componentNamespace" class="java.lang.String">
    <constructor-arg type="java.lang.String" value="person" />
  </bean>
  
  <bean id="project.componentNamespace" class="java.lang.String">
    <constructor-arg type="java.lang.String" value="project" />
  </bean>
  
   <bean id="structured-article.componentNamespace" class="java.lang.String">
    <constructor-arg type="java.lang.String" value="structured-article" />
  </bean>
  
   <bean id="frontpage.componentNamespace" class="java.lang.String">
    <constructor-arg type="java.lang.String" value="frontpage" />
  </bean>
  
  <bean id="structured-article.cssComponent"
        class="org.vortikal.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="structured-article.componentNamespace" />
    <property name="name" value="css" />
    <property name="description" value="Inserts CSS references for new articles and events" />
    <property name="view" ref="structured-article.cssView" />
  </bean>

  <bean id="structured-article.cssView" parent="freemarkerView">
    <property name="url" value="system/css.ftl" />
    <property name="attributesMap">
      <map>
        <entry key="cssURLs">
          <list>
            <value>${themeBaseURL}/structured-resources/view-structured-article.css</value>
            <value>${themeBaseURL}/structured-resources/view-structured-container.css</value>
            <value>${themeBaseURL}/structured-resources/share.css</value>
          </list>
        </entry>
      </map>
    </property>
  </bean>

  <bean id="structured-article.javascriptComponent"
        class="org.vortikal.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="structured-article.componentNamespace" />
    <property name="name" value="javascript" />
    <property name="description" value="Inserts the default article/event javascript references" />
    <property name="view" ref="structured-article.javascriptView" />
    <property name="exposeMvcModel" value="true" />
  </bean>

  <bean id="structured-article.javascriptView" parent="freemarkerView">
    <property name="url" value="system/javascript.ftl" />
    <property name="attributesMap">
      <map>
        <entry key="jsURLs">
          <list>    
            <value>${webResources.baseURL}/jquery/jquery-1.3.2.min.js</value>
            <value>${webResources.baseURL}/js/share.js</value>
          </list>
        </entry>
      </map>
    </property>
  </bean>
  
      <bean id="frontpage.cssComponent"
        class="org.vortikal.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="frontpage.componentNamespace" />
    <property name="name" value="css" />
    <property name="description" value="Inserts CSS references for frontpages" />
    <property name="view" ref="frontpage.cssView" />
  </bean>
  
    <bean id="frontpage.cssView" parent="freemarkerView">
    <property name="url" value="system/css.ftl" />
    <property name="attributesMap">
      <map>
        <entry key="cssURLs">
          <list>
            <value>${themeBaseURL}/structured-resources/view-frontpage.css</value>
            <value>${themeBaseURL}/view-container.css</value>
          </list>
        </entry>
      </map>
    </property>
  </bean>
  
    <bean id="person.cssComponent"
        class="org.vortikal.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="person.componentNamespace" />
    <property name="name" value="css" />
    <property name="description" value="Inserts CSS references for persons" />
    <property name="view" ref="person.cssView" />
  </bean>

  <bean id="person.cssView" parent="freemarkerView">
    <property name="url" value="system/css.ftl" />
    <property name="attributesMap">
      <map>
        <entry key="cssURLs">
          <list>
            <value>${themeBaseURL}/structured-resources/view-person.css</value>
            <value>${webResources.baseURL}/jquery-ui-tabs-customized/css/ui-lightness/jquery-ui-1.7.2.custom.css</value>
            <value>${themeBaseURL}/view-container.css</value>
          </list>
        </entry>
      </map>
    </property>
  </bean>
  
  <bean id="person.javascriptComponent"
        class="org.vortikal.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="person.componentNamespace" />
    <property name="name" value="javascript" />
    <property name="description" value="Inserts the default person javascript references" />
    <property name="view" ref="person.javascriptView" />
    <property name="exposeMvcModel" value="true" />
  </bean>

  <bean id="person.javascriptView" parent="freemarkerView">
    <property name="url" value="system/javascript.ftl" />
    <property name="attributesMap">
      <map>
        <entry key="jsURLs">
          <list>
            <value>${webResources.baseURL}/jquery/jquery-1.3.2.min.js</value>
            <value>${webResources.baseURL}/jquery-ui-tabs-customized/js/jquery-ui-1.7.2.custom.min.js</value>
            <value>${webResources.baseURL}/js/tabs.js</value>
          </list>
        </entry>
      </map>
    </property>
  </bean>
  
  <bean id="decorating.publicationsComponent"
        class="org.vortikal.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="decorating.resourceNamespace" />
    <property name="name" value="publications" />
    <property name="description" value="List publications from Frida" />
    <property name="view" ref="decorating.publicationsComponent.view" />
  </bean>

  <bean id="decorating.publicationsComponent.view" parent="freemarkerView">
    <property name="url" value="layouts/publications.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceContextProvider" />
        <ref bean="decorating.publicationsComponent.publicationsProvider" />
      </list>
    </property>
  </bean>
  
  <bean id="decorating.publicationsComponent.publicationsProvider"
        class="org.vortikal.web.referencedata.provider.FridaPublicationsProvider"
        parent="requestLocalRepositoryAware">
  </bean>
  
  <bean id="project.cssComponent"
        class="org.vortikal.web.decorating.components.ViewRenderingDecoratorComponent">
    <property name="namespace" ref="project.componentNamespace" />
    <property name="name" value="css" />
    <property name="description" value="Inserts CSS references for projects" />
    <property name="view" ref="project.cssView" />
  </bean>

  <bean id="project.cssView" parent="freemarkerView">
    <property name="url" value="system/css.ftl" />
    <property name="attributesMap">
      <map>
        <entry key="cssURLs">
          <list>
            <value>${themeBaseURL}/structured-resources/view-project.css</value>
            <value>${themeBaseURL}/view-container.css</value>
          </list>
        </entry>
      </map>
    </property>
   </bean>
  
</beans>
