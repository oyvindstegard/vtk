<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>
	
	<import resource="text.xml" />
	<import resource="mixins/visual-profile.xml" />

    <!-- APT resource -->
	<bean id="aptResource"
		class="org.vortikal.repository.resourcetype.PrimaryResourceTypeDefinitionImpl">
		<property name="name" value="apt-resource" />
		<property name="namespace" ref="DEFAULT_NAMESPACE" />
		<property name="parentTypeDefinition" ref="textResourceTypeDefinition" />
		<property name="assertions">
			<list>
				<ref bean="contentTypeMatchesApt" />
			</list>
		</property>
	    <property name="mixinTypeDefinitions">
		    <list>
			    <ref bean="visualProfileMixinResourceTypeDef" />
		    </list>
	    </property>
		<property name="propertyTypeDefinitions">
			<list>
				<ref bean="aptTitlePropDef" />
				<ref bean="aptOverriddenTitlePropDef" />
			</list>
		</property>
	</bean>

	<bean id="contentTypeMatchesApt"
		class="org.vortikal.web.service.ResourceContentTypeRegexpAssertion">
		<property name="pattern" value="text/x-apt" />
	</bean>

	<bean id="aptTitlePropDef"
		class="org.vortikal.repository.resourcetype.OverridablePropertyTypeDefinitionImpl"
		parent="abstractPropDef">
		<property name="name" value="aptTitle" />
		<property name="contentModificationEvaluator" ref="aptTitlePropertyEvaluator" />
	</bean>

	<bean id="aptTitlePropertyEvaluator"
		class="org.vortikal.repository.resourcetype.property.DoxiaTitleEvaluator">
		<property name="characterEncodingPropertyDefinition" ref="characterEncodingPropDef" />
		<property name="parserClass" value="org.apache.maven.doxia.module.apt.AptParser" />
	</bean>

	<bean id="aptOverriddenTitlePropDef"
		class="org.vortikal.repository.resourcetype.OverridingPropertyTypeDefinitionImpl">
		<property name="overriddenPropDef" ref="titlePropDef" />
		<property name="contentModificationEvaluator" ref="aptOverriddenTitlePropertyEvaluator" />
		<property name="nameModificationEvaluator" ref="aptOverriddenTitlePropertyEvaluator" />
	</bean>

	<bean id="aptOverriddenTitlePropertyEvaluator" parent="titleEvaluator">
		<property name="fallbackTitlePropDef" ref="aptTitlePropDef" />
	</bean>
	
</beans>