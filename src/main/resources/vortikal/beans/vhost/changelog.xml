<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

  <!-- Event database dumper for new system index (logger id = 1 and logger type = 3)  -->
  <bean id="repository.eventDumper" 
    class="org.vortikal.repository.RepositoryEventDumperImpl">
    <property name="dataAccessor" ref="${repository.dao}"/>
    <property name="repository" ref="repository"/>
    <property name="loggerId" value="1" />
    <property name="loggerType" value="3" />
  </bean>

  <!-- Resource change notifier for new system index -->
  <bean id="repository.resourceChangeNotifier"
    class="org.vortikal.repository.index.observation.ResourceChangeNotifierImpl">
    <property name="indexDao" ref="repository.indexDao"/>
  </bean>

  <!-- Simple trigger bean for pollChanges() in 
       'repository.resourceChangeNotifier' -->
  <bean id="repository.indexUpdateTrigger" 
        class="org.vortikal.scheduling.SimpleMethodInvokingTriggerBean">
    
    <property name="targetMethodName" value="pollChanges"/>
    <property name="targetObject" ref="repository.resourceChangeNotifier"/>
    <property name="triggerThreadName" value="${repositoryID}.indexupdater"/>
    <property name="startDelay" value="20000"/>
    <property name="repeatInterval" value="5000"/>
    <property name="startTriggerAfterInitialization" value="true"/>
    <property name="abortTriggerOnTargetMethodException" value="false"/>

  </bean>

</beans>
