<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" 
"http://www.springframework.org/dtd/spring-beans.dtd">

<beans>
  
  <bean id="editor.service" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <property name="order" value="-9800" />
    <property name="assertions">
      <list>
        <ref bean="editor.modeParameterAssertion" />
        <ref bean="requiresWritePermissionAssertion" />
        <!--ref bean="resourceTypeInXhtmlTrans" /-->
        <ref bean="editor.parameterEqualsEdit" />
      </list>
    </property>
  </bean>


  <bean id="editor.abstractEditService" class="org.vortikal.web.service.ServiceImpl" abstract="true">
    <property name="parent" ref="editor.service" />
    <property name="order" value="-9800" />
    <property name="categories">
      <set>
        <value>tabMenu</value>
      </set>
    </property>
    <property name="attributes">
      <map><entry key="tabOrder"><value type="java.lang.Integer">152</value></entry></map>
    </property>
  </bean>

  <bean id="editor.unstructuredXhtmlEditService" parent="editor.abstractEditService">
    <property name="assertions">
      <list>
        <ref bean="resourceTypeIsXhtmlTrans" />
      </list>
    </property>
    <property name="handler" ref="editor.unstructuredXhtmlEditHandler" />
  </bean>

  <bean id="editor.collectionEditService" parent="editor.abstractEditService">
    <property name="assertions">
      <list>
        <ref bean="resourceIsCollection" />
      </list>
    </property>
    <property name="handler" ref="editor.collectionEditHandler" />
  </bean>

  <bean id="editor.articleListingEditService" parent="editor.abstractEditService">
    <property name="assertions">
      <list>
        <ref bean="resourceIsArticleListing" />
      </list>
    </property>
    <property name="handler" ref="editor.articleListingEditHandler" />
  </bean>

  <bean id="editor.eventListingEditService" parent="editor.abstractEditService">
    <property name="assertions">
      <list>
        <ref bean="resourceIsEventListing" />
      </list>
    </property>
    <property name="handler" ref="editor.eventListingEditHandler" />
  </bean>

  <bean id="editor.documentEditService" parent="editor.abstractEditService">
    <property name="assertions">
      <list>
        <ref bean="resourceTypeIsDocument" />
      </list>
    </property>
    <property name="handler" ref="editor.editHandler" />
  </bean>

  <bean id="editor.browseService" class="org.vortikal.web.service.ServiceImpl">
    <property name="order" value="-999" />
    <property name="assertions">
      <list>
        <ref bean="editor.browseUriAssertion" />
        <ref bean="editor.parameterEqualsBrowse" />
      </list>
    </property>
    <property name="handlerInterceptors">
      <list>
        <ref bean="noCacheHandlerInterceptor" />
      </list>
    </property>
    <property name="handler">
      <bean class="org.vortikal.edit.fckeditor.FCKeditorConnector"
            parent="requestLocalRepositoryAware">
        <property name="viewService" ref="viewService" />
        <property name="browseViewName" value="editor.browseView" />
        <property name="uploadStatusViewName" value="editor.uploadStatusView" />
      </bean>
    </property>
  </bean>

  <bean id="editor.getSourceStripHeadersInterceptor"
        class="org.vortikal.web.controller.HeaderControlHandlerInterceptor">
    <property name="includeLastModifiedHeader" value="false" />
    <property name="includeEtagHeader" value="false" />
  </bean>

  <bean id="editor.browseUriAssertion"
        class="org.vortikal.web.service.RequestURIRegexpAssertion">
    <property name="pattern" value="${editor.fck.browseURL}" />
  </bean>

  <bean id="editor.modeParameterAssertion"
        class="org.vortikal.web.service.RequestParameterAssertion">
    <property name="parameterName" value="mode" />
    <property name="parameterValue" value="editor" />
  </bean>

  <bean id="editor.parameterEqualsEdit"
        class="org.vortikal.web.service.RequestParameterAssertion">
    <property name="parameterName" value="action" />
    <property name="parameterValue" value="edit" />
  </bean>

  <bean id="editor.parameterEqualsBrowse"
        class="org.vortikal.web.service.RequestParameterAssertion">
    <property name="parameterName" value="action" />
    <property name="parameterValue" value="browse" />
  </bean>

  <bean id="editor.wrappingViewResolver" parent="adminViewResolver">
    <property name="views">
      <map>
        <entry key="editor.editView" value-ref="editor.editView" />
      </map>
    </property>
  </bean>

  <bean id="editor.plainViewResolver" class="org.vortikal.web.view.decorating.MappingViewResolver">
    <property name="views">
      <map>
        <entry key="editor.browseView" value-ref="editor.browseView" />
        <entry key="editor.uploadStatusView" value-ref="editor.uploadStatusView" />
      </map>
    </property>
  </bean>


  <bean id="editor.editView" parent="freemarkerView">
    <property name="url" value="editor/editor.ftl" />
    <property name="referenceDataProviders">
      <list>

        <ref bean="resourceContextProvider" />

        <ref bean="manage.refreshLockURLProvider" />
        <ref bean="manage.unlockURLProvider" />

        <bean class="org.vortikal.web.referencedata.provider.FixedResourceServiceURLProvider">
          <property name="repository" ref="repository" />
          <property name="service" ref="staticResourceService" />
          <property name="uri" value="/" />
          <property name="appendPath" value="${editor.fck.resourcesURL}" />
          <property name="modelName" value="fckeditorBase" />
          <property name="urlName" value="url" />
        </bean>

        <bean class="org.vortikal.web.referencedata.provider.ResourceServiceURLProvider">
          <property name="repository" ref="repository" />
          <property name="service" ref="viewService" />
          <property name="modelName" value="fckeditorBase" />
          <property name="urlName" value="documentURL" />
        </bean>

        <bean class="org.vortikal.web.referencedata.provider.StaticURIServiceURLProvider">
          <property name="service" ref="editor.browseService" />
          <property name="path" value="${editor.fck.browseURL}" />
          <property name="modelName" value="fckBrowse" />
        </bean>

        <bean class="org.vortikal.web.referencedata.provider.FixedResourceServiceURLProvider">
          <property name="repository" ref="repository" />
          <property name="service" ref="staticResourceService" />
          <property name="uri" value="/" />
          <property name="appendPath" value="${yui.baseURL}" />
          <property name="modelName" value="yuiBase" />
          <property name="urlName" value="url" />
        </bean>

        <bean class="org.vortikal.web.referencedata.provider.StaticModelDataProvider">
          <property name="modelDataMap">
            <map>
              <entry key="cssURLs" value-ref="editor.editCSSURLs" />
              <entry key="editorHelpURL" value="${editor.helpURL}" />
              <entry key="autoCompleteBaseURL" value="${autoComplete.appResourceURL}" />
              <entry key="fckEditorAreaCSSURL" value-ref="editor.fckEditorAreaCSSURL" />
            </map>
          </property>
        </bean>
      </list>
    </property>
  </bean>

  <bean id="editor.browseView" parent="freemarkerView">
    <property name="url" value="fckeditor/browse.ftl" />
    <property name="contentType" value="text/xml;charset=utf-8" />
    <property name="referenceDataProviders">
      <list>
      </list>
    </property>
  </bean>

  <bean id="editor.uploadStatusView" parent="freemarkerView">
    <property name="url" value="fckeditor/upload-status.ftl" />
    <property name="contentType" value="text/html;charset=utf-8" />
    <property name="referenceDataProviders">
      <list>
      </list>
    </property>
  </bean>

  <bean id="editor.editCSSURLs" class="java.util.ArrayList">
    <constructor-arg>
      <list>
        <value>${themeBaseURL}/basic.css</value>
        <value>${themeBaseURL}/tabs.css</value>
        <value>${themeBaseURL}/editor.css</value>
      </list>
    </constructor-arg>
  </bean>

  <bean id="editor.fckEditorAreaCSSURL" class="java.util.ArrayList">
    <constructor-arg>
	<list>
              <value>${themeBaseURL}/editor-container.css</value>
              <value>${themeBaseURL}/fck_editorarea.css</value>
        </list>
    </constructor-arg>
  </bean>

  <!-- Editor main controllers -->
  
  <bean id="editor.unstructuredXhtmlEditHandler"
        class="org.vortikal.edit.editor.UnstructuredXHtmlEditController">
    <property name="resourceManager" ref="editor.unstructuredXhtmlResourceManager" />
    <property name="formView" value="editor.editView" />
    <property name="successView" value="redirectToManage" />
  </bean>

  <bean id="editor.collectionEditHandler"
        class="org.vortikal.edit.editor.ResourceEditController">
    <property name="resourceManager" ref="editor.collectionResourceManager" />
    <property name="formView" value="editor.editView" />
    <property name="successView" value="redirectToManage" />
  </bean>

  <bean id="editor.articleListingEditHandler"
        class="org.vortikal.edit.editor.ResourceEditController">
    <property name="resourceManager" ref="editor.articleListingResourceManager" />
    <property name="formView" value="editor.editView" />
    <property name="successView" value="redirectToManage" />
  </bean>

  <bean id="editor.eventListingEditHandler"
        class="org.vortikal.edit.editor.ResourceEditController">
    <property name="resourceManager" ref="editor.eventListingResourceManager" />
    <property name="formView" value="editor.editView" />
    <property name="successView" value="redirectToManage" />
  </bean>

  <bean id="editor.editHandler"
        class="org.vortikal.edit.editor.ResourceEditController">
    <property name="resourceManager" ref="resourceManager" />
    <property name="formView" value="editor.editView" />
    <property name="successView" value="redirectToManage" />
  </bean>

  <bean id="editor.unstructuredXhtmlResourceManager"
        class="org.vortikal.edit.editor.ResourceWrapperManager"
        parent="requestLocalRepositoryAware">
    <property name="htmlParser" ref="decorating.htmlParser" />
    <property name="htmlPropsFilter" ref="resourceManager.htmlPropsFilter" />
    <property name="contentResourceType" ref="xhtml10TransResourceTypeDefinition" />
    <property name="editPropertyProvider">
      <bean class="org.vortikal.edit.editor.ConfigurableEditablePropertyProvider">
        <property name="preContentProperties">
          <list>
            <ref bean="htmlTitlePropDef" />
          </list>
        </property>
      </bean>
    </property>
  </bean>

  <bean id="editor.collectionResourceManager"
        class="org.vortikal.edit.editor.ResourceWrapperManager"
        parent="requestLocalRepositoryAware">
    <property name="htmlParser" ref="decorating.htmlParser" />
    <property name="htmlPropsFilter" ref="resourceManager.htmlPropsFilter" />
    <property name="contentResourceType" ref="xhtml10TransResourceTypeDefinition" />
    <property name="editPropertyProvider">
      <bean class="org.vortikal.edit.editor.ConfigurableEditablePropertyProvider">
        <property name="preContentProperties">
          <list>
            <ref bean="userTitlePropDef" />
            <ref bean="introductionPropDef" />
            <ref bean="introductionImagePropDef" />
            <ref bean="introductionImageCaptionPropDef" />
            
            <!--ref bean="collection.recursiveListingPropDef" /-->
            <ref bean="collection.pageLimitPropDef" />
            <ref bean="collection.sortingPropDef" />
            <ref bean="collection.hideLastModifiedPropDef" />
            <ref bean="collection.hideIntroductionPropDef" />

          </list>
        </property>
      </bean>
    </property>
  </bean>

  <bean id="editor.articleListingResourceManager"
        class="org.vortikal.edit.editor.ResourceWrapperManager"
        parent="requestLocalRepositoryAware">
    <property name="htmlParser" ref="decorating.htmlParser" />
    <property name="htmlPropsFilter" ref="resourceManager.htmlPropsFilter" />
    <property name="contentResourceType" ref="xhtml10TransResourceTypeDefinition" />
    <property name="editPropertyProvider">
      <bean class="org.vortikal.edit.editor.ConfigurableEditablePropertyProvider">
        <property name="preContentProperties">
          <list>
            <ref bean="userTitlePropDef" />
            <ref bean="introductionPropDef" />
            <ref bean="introductionImagePropDef" />
            <ref bean="introductionImageCaptionPropDef" />
            <ref bean="articleListing.featuredArticlesPropDef"/>
            <ref bean="collection.pageLimitPropDef" />
            <ref bean="articleListing.recursiveListingPropDef" />
            <ref bean="articleListing.sortingPropDef" />
            <ref bean="articleListing.hidePublishedDatePropDef" />
            <ref bean="articleListing.hideIntroductionPropDef" />
            <ref bean="articleListing.hideIntroductionImagePropDef" />
          </list>
        </property>
      </bean>
    </property>
  </bean>


  <bean id="editor.eventListingResourceManager"
        class="org.vortikal.edit.editor.ResourceWrapperManager"
        parent="requestLocalRepositoryAware">
    <property name="htmlParser" ref="decorating.htmlParser" />
    <property name="htmlPropsFilter" ref="resourceManager.htmlPropsFilter" />
    <property name="contentResourceType" ref="xhtml10TransResourceTypeDefinition" />
    <property name="editPropertyProvider">
      <bean class="org.vortikal.edit.editor.ConfigurableEditablePropertyProvider">
        <property name="preContentProperties">
          <list>
            <ref bean="userTitlePropDef" />
            <ref bean="introductionPropDef" />
            <ref bean="introductionImagePropDef" />
            <ref bean="introductionImageCaptionPropDef" />
            <ref bean="collection.pageLimitPropDef" />

            <ref bean="eventListing.recursiveListingPropDef" />

            <ref bean="eventListing.hideEndDatePropDef" />
            <ref bean="eventListing.hideLocationPropDef" />

            <ref bean="articleListing.hideIntroductionPropDef" />
            <ref bean="articleListing.hideIntroductionImagePropDef" />

          </list>
        </property>
      </bean>
    </property>
  </bean>


  <!-- Experimental "structured XHTML editor" (with managed title and h1:

  <bean id="editor.structuredXhtmlEditService" parent="editor.abstractEditService">
    <property name="assertions">
      <list>
        <ref bean="resourceTypeIsXhtmlTrans" />
      </list>
    </property>
    <property name="handler" ref="editor.structuredXhtmlEditHandler" />
  </bean>
  <bean id="editor.structuredXhtmlEditHandler"
        class="org.vortikal.edit.editor.StructuredXHtmlEditController">
    <property name="resourceManager" ref="resourceManager" />
    <property name="formView" value="editor.structuredXhtmlView" />
    <property name="successView" value="redirectToManage" />
  </bean>

  <bean id="editor.structuredXhtmlView" parent="editor.editView">
    <property name="url" value="editor/structured-xhtml-editor.ftl" />
  </bean>
  -->

</beans>
