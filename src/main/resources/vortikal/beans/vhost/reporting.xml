<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN"
                       "http://www.springframework.org/dtd/spring-beans.dtd">

<!--  Beans for repository data reporting -->
<beans>

    <!--  Data report manager -->
    <bean id="dataReportManager" class="org.vortikal.repository.reporting.DataReportManagerImpl">
        <property name="dataReportDAO" ref="repository.indexDataReportDAO"/>
        <property name="cache" ref="dataReportManagerCache"/>
    </bean>

    <!-- A SimpleCache instance for the data report manager -->
    <bean id="dataReportManagerCache" class="org.vortikal.util.cache.SimpleCacheImpl">
        <property name="refreshTimestampOnGet" value="false"/>
        <property name="timeoutSeconds" value="60"/>
    </bean>

    <!-- Data report DAO using system index. -->
    <bean id="repository.indexDataReportDAO" class="org.vortikal.repository.index.IndexDataReportDAO">
        <property name="systemIndexAccessor" ref="systemIndexAccessor" />
        <property name="documentMapper" ref="documentMapper" />
        <property name="fieldValueMapper" ref="fieldValueMapper" />
        <property name="queryAuthFilterFactory" ref="queryAuthorizationFilterFactory" />
    </bean>

    <!--  Data report DAO using database (This DAO does not provide security filtering) -->
    <bean id="repository.dataReportDAO" class="org.vortikal.repository.store.db.SqlMapDataReportDAO">
        <property name="sqlMapClient" ref="repository.sqlMapClient"/>
        <property name="sqlMaps" ref="repository.statementMappings" />
        <property name="valueFactory" ref="valueFactory"/>
    </bean> 

</beans>