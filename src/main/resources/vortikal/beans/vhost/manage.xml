<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" 
"http://www.springframework.org/dtd/spring-beans.dtd">

<beans>


  <!-- MANAGE services -->
  
  <!-- (deleteResourceService has been moved out of manageService and
       made a root level service because in some cases delete URLs
       could not be generated since manageService requires read
       permission) -->
  <bean id="deleteResourceService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="webService" />
    <property name="order" value="490" />
    <property name="categories">
      <set>
        <value>resourceMenu</value>
      </set>
    </property>
    <property name="attributes">
      <map>
        <entry key="resourceMenuOrder"><value type="java.lang.Integer">100</value></entry>
      </map>
    </property>
    <property name="assertions">
      <list>
        <ref local="resourceNotRootAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="vrtx" />
          <property name="parameterValue" value="admin" />
        </bean>
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="delete" />
        </bean>
        <ref local="deleteResourcePermissionAssertion" />
      </list>
    </property>  
    <property name="handlerInterceptors">
      <list>
        <ref bean="noCacheHandlerInterceptor" />
      </list>
    </property>
    <property name="handler">
      <ref bean="deleteResourceHandler" />
    </property>
  </bean>

  <bean id="manageService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="webService" />
    <property name="order" value="500" />
    <property name="assertions">
      <list>
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="vrtx" />
          <property name="parameterValue" value="admin" />
        </bean>
        <ref bean="requiresReadPermissionAssertion" />
      </list>
    </property>
    <property name="handlerInterceptors">
      <list>
        <ref bean="noCacheHandlerInterceptor" />
      </list>
    </property>
    <property name="services">
      <list>
        <ref bean="setNorwegianNBLocaleService" />
        <ref bean="setNorwegianNNLocaleService" />
        <ref bean="setEnglishLocaleService" />
        <!--ref bean="deleteResourceService" /-->
        <ref bean="lockResourceService" />
        <ref bean="unlockResourceService" />
        <ref bean="previewCollectionListingService" />
        <ref bean="aboutResourceService" />
        <ref bean="permissionsService" />
        <ref bean="manageCollectionListingService" />
        <ref bean="previewService"/>
      </list>
    </property>        
  </bean>

  <bean id="setNorwegianNBLocaleService"
        class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref bean="requestLocaleNotNorwegianNB"/>
        <ref bean="localeParameterEqualsNO" />
      </list>
    </property>
    <property name="handler">
      <ref bean="setNorwegianNBLocaleController"/>
    </property>
  </bean>


  <bean id="setNorwegianNNLocaleService"
        class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref bean="requestLocaleNotNorwegianNN"/>
        <ref bean="localeParameterEqualsNN" />
      </list>
    </property>
    <property name="handler">
      <ref bean="setNorwegianNNLocaleController"/>
    </property>
  </bean>


  <bean id="setEnglishLocaleService"
        class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref bean="requestLocaleNotEnglish" />
        <ref bean="localeParameterEqualsEN" />
      </list>
    </property>
    <property name="handler">
      <ref bean="setEnglishLocaleController"/>
    </property>
  </bean>

  <bean id="permissionsService" class="org.vortikal.web.service.ServiceImpl">
    <!--property name="order"><value>-9550</value></property-->
    <property name="categories">
      <set>
        <value>tabMenu</value>
      </set>
    </property>
    <property name="attributes">
      <map>
        <entry key="tabOrder"><value type="java.lang.Integer">200</value></entry>
      </map>
    </property>
    <property name="assertions">
      <list>
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName">
            <value>mode</value>
          </property>
          <property name="parameterValue">
            <value>permissions</value>
          </property>
        </bean>      
      </list>
    </property>
    <property name="services">
      <list>
        <ref bean="aclInheritanceService" />
        <ref bean="editWritePermissionsService" />
        <ref bean="editReadPermissionsService" />
        <ref bean="editAdminPermissionsService" />
        <ref bean="editBindPermissionsService" />
        <ref bean="editReadProcessedPermissionsService" />
      </list>
    </property>
    <property name="handler">
      <ref bean="permissionsHandler" />
    </property>
  </bean>        



  <bean id="aboutResourceService" class="org.vortikal.web.service.ServiceImpl">
    <!--property name="parent" ref="manageService" /-->
    <property name="categories">
      <set>
        <value>tabMenu</value>
      </set>
    </property>
    <property name="attributes">
      <map>
        <entry key="tabOrder"><value type="java.lang.Integer">300</value></entry>
      </map>
    </property>
    <property name="assertions">
      <list>
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="mode" />
          <property name="parameterValue" value="about" />
        </bean>      
      </list>
    </property>
    <property name="services">
      <list>
        <ref bean="renameService" />
        <ref bean="ownershipService" />
        <ref bean="setContentTypeService" />
        <ref bean="setContentLanguageService" />
        <ref bean="setCharacterEncodingService" />
        <ref bean="setResourcePropertyService" />
        <ref bean="deleteResourcePropertyService" />      
      </list>
    </property>
    <property name="handler" ref="aboutResourceHandler" />
  </bean>        

  
  <bean id="manageCollectionListingService" class="org.vortikal.web.service.ServiceImpl">
    <!--property name="order"><value>-10000</value></property-->
    <property name="categories">
      <set>
        <value>tabMenu</value>
      </set>
    </property>
    <property name="attributes">
      <map>
        <entry key="tabOrder"><value type="java.lang.Integer">0</value></entry>
      </map>
    </property>
    <property name="assertions">
      <list>
        <bean class="org.vortikal.web.service.ResourceIsCollectionAssertion" />
      </list>
    </property>
    <property name="handler">
      <ref bean="manageCollectionListingHandler" />
    </property>
    <property name="services">
      <list>
        <ref bean="createDocumentService" />
        <ref bean="createCollectionService" />
        <ref bean="fileUploadService" />
      </list>        
    </property>
  </bean>        
  


  <bean id="fileUploadService" class="org.vortikal.web.service.ServiceImpl">
    <property name="order"><value>-1000</value></property>
    <property name="categories">
      <set>
        <value>collectionMenu</value>
      </set>
    </property>
    <property name="assertions">
      <list>
        <ref bean="bindPermissionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName">
            <value>action</value>
          </property>
          <property name="parameterValue">
            <value>upload-file</value>
          </property>
        </bean>
        <bean class="org.vortikal.web.service.ResourceIsCollectionAssertion" />
      </list>
    </property>
    <property name="handler">
      <ref bean="fileUploadHandler" />
    </property>
  </bean>        

  


  <bean id="lockResourceService" class="org.vortikal.web.service.ServiceImpl">
    <property name="categories">
      <set>
        <value>lockUnlockAction</value>
      </set>
    </property>
    <property name="assertions">
      <list>
        <ref bean="lockPermissionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName">
            <value>action</value>
          </property>
          <property name="parameterValue">
            <value>lock</value>
          </property>
        </bean>
      </list>
    </property>  
    <property name="handler">
      <ref bean="lockResourceHandler" />
    </property>
  </bean>


  <bean id="unlockResourceService" class="org.vortikal.web.service.ServiceImpl">
    <property name="categories">
      <set>
        <value>lockUnlockAction</value>
      </set>
    </property>
    <property name="assertions">
      <list>
        <ref bean="unlockPermissionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName">
            <value>action</value>
          </property>
          <property name="parameterValue">
            <value>unlock</value>
          </property>
        </bean>
      </list>
    </property>  
    <property name="handler">
      <ref bean="unlockResourceHandler" />
    </property>
  </bean>


  <bean id="createDocumentService" class="org.vortikal.web.service.ServiceImpl">
    <property name="order"><value>-999</value></property>
    <property name="categories">
      <set>
        <value>collectionMenu</value>
      </set>
    </property>
    <property name="assertions">
      <list>
        <ref bean="bindPermissionAssertion" />
        <ref bean="resourceIsCollectionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName">
            <value>action</value>
          </property>
          <property name="parameterValue">
            <value>create-document</value>
          </property>
        </bean>
      </list>
    </property>  
    <property name="handler">
      <ref bean="createDocumentHandler" />
    </property>
  </bean>

  <bean id="createCollectionService" class="org.vortikal.web.service.ServiceImpl">
    <property name="order"><value>0</value></property>
    <property name="categories">
      <set>
        <value>collectionMenu</value>
      </set>
    </property>
    <property name="assertions">
      <list>
        <ref bean="bindPermissionAssertion" />
        <ref bean="resourceIsCollectionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName">
            <value>action</value>
          </property>
          <property name="parameterValue">
            <value>create-directory</value>
          </property>
        </bean>
      </list>
    </property>  
    <property name="handler">
      <ref bean="createCollectionHandler" />
    </property>
  </bean>

  <bean id="renameService" class="org.vortikal.web.service.ServiceImpl">
    <property name="order"><value>-1000</value></property>
    <property name="categories">
      <set>
        <value>resourceMenu</value>
      </set>
    </property>
    <property name="attributes">
      <map>
        <entry key="resourceMenuOrder"><value type="java.lang.Integer">0</value></entry>
      </map>
    </property>
    <property name="assertions">
      <list>
        <ref local="deleteResourcePermissionAssertion" />
        <ref local="resourceNotRootAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName">
            <value>action</value>
          </property>
          <property name="parameterValue">
            <value>rename</value>
          </property>
        </bean>
      </list>
    </property>
    <property name="handler">
      <ref bean="renameHandler" />
    </property>
  </bean>
  
  <bean id="ownershipService" class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref local="delegateOwnershipPermissionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName">
            <value>action</value>
          </property>
          <property name="parameterValue">
            <value>delegate-ownership</value>
          </property>
        </bean>
      </list>
    </property>  
    <property name="handler">
      <ref bean="ownershipHandler" />
    </property>
  </bean>

  <bean id="aclInheritanceService" class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref local="resourceNotRootAssertion" />
        <ref local="writeACLPermissionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="toggle-acl-inheritance" />
        </bean>
      </list>
    </property>  
    <property name="handler" ref="aclInheritanceHandler" />
  </bean>

  <bean id="editWritePermissionsService" class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref local="writeACLPermissionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="edit-write-permissions" />
        </bean>
      </list>
    </property>  
    <property name="handler" ref="editWritePermissionsHandler" />
  </bean>

  <bean id="editReadPermissionsService" class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref local="writeACLPermissionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="edit-read-permissions" />
        </bean>
      </list>
    </property>  
    <property name="handler" ref="editReadPermissionsHandler" />
  </bean>

  <bean id="editAdminPermissionsService" class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref local="writeACLPermissionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="edit-admin-permissions" />
        </bean>
      </list>
    </property>  
    <property name="handler" ref="editAdminPermissionsHandler" />
  </bean>


  <bean id="editBindPermissionsService" class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref local="writeACLPermissionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="edit-bind-permissions" />
        </bean>
      </list>
    </property>  
    <property name="handler" ref="editBindPermissionsHandler" />
  </bean>


  <bean id="editReadProcessedPermissionsService" class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref local="writeACLPermissionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="edit-read-processed-permissions" />
        </bean>
      </list>
    </property>  
    <property name="handler" ref="editReadProcessedPermissionsHandler" />
  </bean>


  <bean id="setContentTypeService" class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref bean="writePermissionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName">
            <value>action</value>
          </property>
          <property name="parameterValue">
            <value>edit-content-type</value>
          </property>
        </bean>
      </list>
    </property>  
    <property name="handler">
      <ref bean="setContentTypeController" />
    </property>
  </bean>

  <bean id="setContentLanguageService" class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref bean="writePermissionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName">
            <value>action</value>
          </property>
          <property name="parameterValue">
            <value>edit-language-type</value>
          </property>
        </bean>
      </list>
    </property>  
    <property name="handler">
      <ref bean="setContentLanguageController" />
    </property>
  </bean>

  <bean id="setCharacterEncodingService" class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref bean="writePermissionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName">
            <value>action</value>
          </property>
          <property name="parameterValue">
            <value>edit-character-encoding</value>
          </property>
        </bean>
        <ref bean="contentTypeMatchesText" />
      </list>
    </property>  
    <property name="handler">
      <ref bean="setCharacterEncodingController" />
    </property>
  </bean>


  <bean id="setResourcePropertyService"
        class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref bean="writePermissionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName">
            <value>action</value>
          </property>
          <property name="parameterValue">
            <value>set-property</value>
          </property>
        </bean>
      </list>    
    </property>
    <property name="handler">
      <ref bean="setResourcePropertyController" />
    </property>
  </bean>


  <bean id="deleteResourcePropertyService"
        class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref bean="writePermissionAssertion" />
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName">
            <value>action</value>
          </property>
          <property name="parameterValue">
            <value>delete-property</value>
          </property>
        </bean>
      </list>    
    </property>
    <property name="handler">
      <ref bean="deleteResourcePropertyController" />
    </property>
  </bean>
  
  
  <bean id="transformHtmlToXhtmlService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="manageService" /> 
    <property name="order" value="-997" />
    <property name="categories">
      <set>
        <value>resourceMenu</value>
      </set>
    </property>
    <property name="attributes">
      <map>
        <entry key="resourceMenuOrder"><value type="java.lang.Integer">2000</value></entry>
      </map>
    </property>
    <property name="assertions">
      <list>
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="html-to-xhtml" />
        </bean>
        <ref bean="resourceTypeIsHtml" /> 
        <ref bean="resourceTypeIsNotXhtmlTrans" /> 
        <ref bean="bindPermissionAssertion" />
      </list>
    </property>
    <property name="handler" ref="htmlToXhtmlHandler" />
  </bean>
  
  <bean id="resourceTypeIsHtml" class="org.vortikal.web.service.ResourceTypeAssertion">
    <property name="resourceTypeDefinition" ref="htmlResourceTypeDefinition" />
  </bean>

  <bean id="resourceTypeIsNotXhtmlTrans" class="org.vortikal.web.service.ResourceTypeAssertion">
    <property name="resourceTypeDefinition" ref="xhtml10TransResourceTypeDefinition" />
    <property name="invert" value="true" />
  </bean>

  <bean id="htmlToXhtmlHandler" 
        class="org.vortikal.web.controller.repository.copy.CopyController"
        parent="requestLocalRepositoryAware">
    <property name="extension" value="-kopi.html" />
    <property name="parentViewOnSuccess" value="true" />
    <property name="copyAction" ref="tidyCopyAction" />
    <property name="formView" value="admin" />
    <property name="successView" value="redirectToManage" />
    <property name="cancelView" value="redirectToManage" />
    <property name="commandClass" value="org.vortikal.web.controller.repository.copy.CopyCommand" />
    <property name="validator">
      <bean class="org.vortikal.web.controller.repository.copy.CopyCommandValidator"
        parent="requestLocalRepositoryAware" />
    </property>
  </bean>
  
  <bean id="tidyCopyAction" 
        class="org.vortikal.web.controller.repository.copy.SimpleFilteringCopyAction"
        parent="requestLocalRepositoryAware">
    <property name="filter">
      <bean class="org.vortikal.web.controller.repository.tidy.JTidyTransformer">
        <property name="insertedCssReference" value="${tidyConvertInsertedCssRef}" />
      </bean>
    </property>
  </bean>

  <!-- preview services -->
  
  <bean id="previewService" class="org.vortikal.web.service.ServiceImpl">
    <!--property name="order"><value>-9900</value></property-->
    <property name="categories">
      <set>
        <value>tabMenu</value>
      </set>
    </property>
    <property name="attributes">
      <map>
        <entry key="tabOrder"><value type="java.lang.Integer">100</value></entry>
      </map>
    </property>
    <property name="assertions">
      <list>
        <bean
         class="org.vortikal.web.service.ResourceIsCollectionAssertion">
          <property name="invert" value="true" />
        </bean>
        <bean class="org.vortikal.web.service.RequestMethodAssertion">
          <property name="method">
            <value>GET</value>
          </property>       
        </bean>
      </list>
    </property>
    <property name="handler">
      <ref bean="previewFallbackHandler" />
    </property>
    <property name="services">
      <list>
        <ref bean="previewHTMLService" />
        <ref bean="previewImageService" />
        <ref bean="previewTextService" />
      </list>    
    </property>
  </bean>


  <bean id="previewHTMLService" class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref bean="contentTypeMatchesHtml" />
      </list>
    </property>
    <property name="handler">
      <ref bean="previewHTMLHandler" />
    </property>
  </bean>


  <bean id="previewImageService" class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref bean="contentTypeMatchesImage" />
      </list>
    </property>
    <property name="handler">
      <ref bean="previewImageHandler" />
    </property>
  </bean>


  <bean id="previewTextService" class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref bean="contentTypeMatchesAnyText" />
      </list>
    </property>
    <property name="handler">
      <ref bean="previewTextHandler" />
    </property>
  </bean>


  <bean id="previewCollectionListingService" class="org.vortikal.web.service.ServiceImpl">
    <!--property name="order" value="-9900" /-->
    <property name="categories">
      <set>
        <value>tabMenu</value>
      </set>
    </property>
    <property name="attributes">
      <map>
        <entry key="tabOrder"><value type="java.lang.Integer">100</value></entry>
      </map>
    </property>
    <property name="assertions">
      <list>
        <ref bean="resourceIsCollectionAssertion" />
        <bean id="previewVrtxParameterRule" class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="action" />
          <property name="parameterValue" value="preview" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="previewCollectionHandler" />
    <property name="services">
      <list>
        <ref bean="previewIndexFileService" />
      </list>    
    </property>
  </bean>

  <bean id="previewCollectionListingServiceInterceptor"
        class="org.vortikal.web.ReferenceDataProvidingHandlerInterceptor">
    <property name="providers">
      <ref bean="indexFileMessageProvider" />
    </property>
  </bean>


  <bean id="indexFileMessageProvider"
        class="org.vortikal.web.referencedata.provider.ResourceMessageProvider">
    <description>
      This provider depends on a 'resource' entry being present in the
      model (use for example with the ResourceServiceURLController).
    </description>
    <property name="resourceInModelKey" value="childResource" />
    <property name="modelName" value="tabMessage" />
    <property name="localizationKey" value="preview.folderWithIndexFile.tabMessage" />
    <!--property name="repository" ref="repository" /-->
    <!--property name="assertions" -->
  </bean>



  <bean id="previewIndexFileService" class="org.vortikal.web.service.ServiceImpl">
    <property name="assertions">
      <list>
        <ref bean="hasIndexFileAssertion" />
      </list>
    </property>
    <property name="handlerInterceptors">
      <list>
        <ref bean="previewCollectionListingServiceInterceptor" />
      </list>
    </property>
    <property name="handler" ref="previewIndexFileHandler" />
    
  </bean>

  <!-- MANAGE controllers -->

  
  <bean id="aboutResourceHandler" 
        class="org.vortikal.web.controller.properties.PropertyEditController"
        parent="requestLocalRepositoryAware">
    <property name="principalManager" ref="principalManager" />
    <property name="propertyTypeDefinitions">
      <list>
        <ref bean="lastModifiedPropDef" />
        <ref bean="modifiedByPropDef" />
        <ref bean="creationTimePropDef" />
        <ref bean="createdByPropDef" />
        <ref bean="ownerPropDef" />
        <!-- resourceType -->
        <!-- webadress -->
        <!-- webDAVadress -->
        <ref bean="contentLocalePropDef" />
        <ref bean="contentLengthPropDef" />

        <ref bean="titlePropDef" />
        <ref bean="skipInPathPropDef" />

        <ref bean="keywordsPropDef" />
        <ref bean="descriptionPropDef" />
        <ref bean="verifiedDatePropDef" />
        <ref bean="authorNamePropDef" />
        <ref bean="authorEmailPropDef" />
        <ref bean="authorURLPropDef" />
        
        <ref bean="contentTypePropDef" />
        <ref bean="userSpecifiedCharacterEncodingPropDef" />
        <ref bean="guessedCharacterEncodingPropDef" />
        <ref bean="characterEncodingPropDef" />

        <ref bean="plaintextEditPropDef" />
      </list>
    </property>
    <property name="propertyListModelName" value="basicPropList" />
    <property name="propertyMapModelName" value="aboutItems" />

    <property name="valueFactory" ref="valueFactory" />
    <property name="formView" value="admin" />
    <property name="successView" value="redirectToAbout" />

    <property name="commandName" value="form" />
    <property name="dateFormat" value="dd.MM.yyyy HH:mm:ss" />
  </bean>

  <bean id="fileUploadHandler" 
    class="org.vortikal.web.controller.repository.FileUploadController"
    parent="requestLocalRepositoryAware">
    <property name="formView" value="manageCollectionListing" />
    <property name="successView" value="redirectToManage" />
    <property name="commandName" value="uploadForm" />
    <property name="commandClass"
              value="org.vortikal.web.controller.repository.FileUploadCommand" />
  </bean>

  <bean id="deleteResourceHandler" 
    class="org.vortikal.web.controller.repository.DeleteResourceController"
    parent="requestLocalRepositoryAware">
    <property name="viewName" value="redirectToManage" />
  </bean>

  <bean id="lockResourceHandler" 
    class="org.vortikal.web.controller.repository.LockResourceController"
    parent="requestLocalRepositoryAware" />


  <bean id="unlockResourceHandler" 
    class="org.vortikal.web.controller.repository.UnlockResourceController"
    parent="requestLocalRepositoryAware" />


  <bean id="createDocumentHandler" 
    class="org.vortikal.web.controller.repository.CreateDocumentController"
    parent="requestLocalRepositoryAware">
    <property name="formView" value="manageCollectionListing" />
    <property name="successView" value="redirectToManage" />
    <property name="commandName" value="createDocumentForm" />
    <property name="commandClass"
      value="org.vortikal.web.controller.repository.CreateDocumentCommand" />
    <property name="validator">
      <bean class="org.vortikal.web.controller.repository.CreateDocumentCommandValidator"
            parent="requestLocalRepositoryAware" />
    </property>
    <property name="documentTemplates" ref="defaultDocumentTemplates" />
  </bean>

  <bean id="defaultDocumentTemplates" 
    class="org.vortikal.web.controller.repository.DefaultDocumentTemplates">
    <property name="templatesCollection"
              value="${documentTemplatesCollection}" />
    <property name="repository" ref="repository" />
    <property name="trustedToken" ref="trustedToken" />
    <property name="parseCategoryTemplates"
              value="${documentTemplatesParseCategoryTemplates}" />
    <property name="parseTopTemplates"
              value="${documentTemplatesParseTopTemplates}" />
  </bean>

  <bean id="documentTemplatesRefreshTrigger"
        class="org.vortikal.util.repository.MethodInvokingRepositoryEventTrigger">
    <property name="repository" ref="repository" />
    <property name="uriPattern" value="/vrtx/templates/.*" />
    <property name="targetObject" ref="defaultDocumentTemplates" />
    <property name="method" value="refresh" />
  </bean>


  <bean id="createCollectionHandler" 
    class="org.vortikal.web.controller.repository.CreateCollectionController"
    parent="requestLocalRepositoryAware">
    <property name="formView" value="manageCollectionListing" />
    <property name="successView" value="redirectToManage" />
    <property name="commandName" value="createCollectionForm" />
    <property name="commandClass"
      value="org.vortikal.web.controller.repository.CreateCollectionCommand" />
    <property name="validator">
      <bean class="org.vortikal.web.controller.repository.CreateCollectionCommandValidator"
            parent="requestLocalRepositoryAware" />
    </property>
  </bean>

  <bean id="renameHandler" 
    class="org.vortikal.web.controller.repository.RenameController"
    parent="requestLocalRepositoryAware">
    <property name="formView" value="admin" />
    <property name="successView" value="redirectToManage" />
    <property name="commandName" value="renameForm" />
    <property name="commandClass"
      value="org.vortikal.web.controller.repository.RenameCommand" />
    <property name="validator">
      <bean class="org.vortikal.web.controller.repository.RenameCommandValidator"
            parent="requestLocalRepositoryAware">
      </bean>
    </property>
  </bean>

  <bean id="ownershipHandler" 
    class="org.vortikal.web.controller.properties.OwnershipController"
    parent="requestLocalRepositoryAware">
    <property name="formView" value="admin" />
    <property name="successView" value="redirect" />
    <property name="commandName" value="ownershipForm" />
    <property name="commandClass" 
              value="org.vortikal.web.controller.properties.OwnershipCommand" />
    <property name="principalFactory" ref="principalFactory" />
  </bean>

  <bean id="aclInheritanceHandler" 
    class="org.vortikal.web.controller.permissions.ToggleAclInheritanceController"
    parent="requestLocalRepositoryAware">
    <property name="viewName" value="redirectToPermissions" />
  </bean>

  <bean id="abstractPermissionsHandler"
        abstract="true"
        class="org.vortikal.web.controller.permissions.ACLEditController"
        parent="requestLocalRepositoryAware">
    <property name="principalFactory" ref="principalFactory" />
    <property name="privilegePrincipalMap" ref="editPrivilegePrincipalMap" />
    <property name="formView" value="permissions" />
    <property name="commandClass" value="org.vortikal.web.controller.permissions.ACLEditCommand" />
    <property name="validator">
      <bean class="org.vortikal.web.controller.permissions.ACLEditCommandValidator">
        <property name="principalManager" ref="principalManager" />
        <property name="principalFactory" ref="principalFactory" />
      </bean>
    </property>
  </bean>


  <bean id="editReadPermissionsHandler" parent="abstractPermissionsHandler">
    <property name="privilege" ref="PRIVILEGE_READ" />
    <property name="successView" value="redirectToPermissions" />
    <property name="commandName" value="permissionsForm_read" />
  </bean>

  <bean id="editWritePermissionsHandler" parent="abstractPermissionsHandler">
    <property name="privilege" ref="PRIVILEGE_WRITE" />
    <property name="successView" value="redirectToPermissions" />
    <property name="commandName" value="permissionsForm_write" />
  </bean>

  <bean id="editAdminPermissionsHandler" parent="abstractPermissionsHandler">
    <property name="privilege" ref="PRIVILEGE_ALL" />
    <property name="successView" value="redirectToPermissions" />
    <property name="commandName" value="permissionsForm_all" />
  </bean>

  <bean id="editBindPermissionsHandler" parent="abstractPermissionsHandler">
    <property name="privilege" ref="PRIVILEGE_BIND" />
    <property name="successView" value="redirectToPermissions" />
    <property name="commandName" value="permissionsForm_bind" />
  </bean>

  <bean id="editReadProcessedPermissionsHandler" parent="abstractPermissionsHandler">
    <property name="privilege" ref="PRIVILEGE_READ_PROCESSED" />
    <property name="successView" value="redirectToPermissions" />
    <property name="commandName" value="permissionsForm_read-processed" />
  </bean>

  <bean id="permissionsHandler" 
    class="org.vortikal.web.controller.ResourceAwareParameterizableViewController"
    parent="requestLocalRepositoryAware">
    <property name="viewName" value="permissions" />
  </bean>

  <bean id="editPrivilegePrincipalMap" class="java.util.HashMap">
    <constructor-arg>
      <map>
        <entry key-ref="PRIVILEGE_READ" value-ref="PRINCIPAL_ALL" />
        <entry key-ref="PRIVILEGE_WRITE" value-ref="PRINCIPAL_AUTHENTICATED" />
        <entry key-ref="PRIVILEGE_ALL" value-ref="PRINCIPAL_AUTHENTICATED" />
        <entry key-ref="PRIVILEGE_BIND" value-ref="PRINCIPAL_AUTHENTICATED" />
        <entry key-ref="PRIVILEGE_READ_PROCESSED" value-ref="PRINCIPAL_ALL" />
      </map>
    </constructor-arg>
  </bean>



  <bean id="setResourcePropertyController"
        class="org.vortikal.web.controller.properties.SetResourcePropertyController"
        parent="requestLocalRepositoryAware">
    <property name="formView"><value>admin</value></property>
    <property name="successView"><value>redirect</value></property>
    <property name="commandName"><value>setResourcePropertyForm</value></property>
    <property name="commandClass">
      <value>org.vortikal.web.controller.properties.ResourcePropertyCommand</value>
    </property>
  </bean>

  <bean id="deleteResourcePropertyController"
        class="org.vortikal.web.controller.properties.DeleteResourcePropertyController"
        parent="requestLocalRepositoryAware">
    <property name="formView"><value>admin</value></property>
    <property name="successView"><value>redirect</value></property>
    <property name="commandName"><value>deleteResourcePropertyForm</value></property>
    <property name="commandClass">
      <value>org.vortikal.web.controller.properties.ResourcePropertyCommand</value>
    </property>
  </bean>

  <bean id="setContentTypeController" 
        class="org.vortikal.web.controller.properties.ContentTypeController"
        parent="requestLocalRepositoryAware">
    <property name="formView"><value>admin</value></property>
    <property name="successView"><value>redirect</value></property>
    <property name="commandName"><value>editContentTypeForm</value></property>
    <property name="commandClass">
      <value>org.vortikal.web.controller.properties.ContentTypeCommand</value>
    </property>
  </bean>

  <bean id="setContentLanguageController" 
        class="org.vortikal.web.controller.properties.ContentLanguageController"
        parent="requestLocalRepositoryAware">
    <property name="formView"><value>admin</value></property>
    <property name="successView"><value>redirect</value></property>
    <property name="commandName"><value>editContentLanguageForm</value></property>
    <property name="commandClass">
      <value>org.vortikal.web.controller.properties.ContentLanguageCommand</value>
    </property>
    <!-- Using java locale codes to store language -->
    <property name="possibleLanguages">
      <list>
        <value>unknown</value>
        <value>no_NO</value>
        <value>en</value>
        <value>no_NO_NY</value>
      </list>
    </property>
  </bean>

  <bean id="setCharacterEncodingController" 
        class="org.vortikal.web.controller.properties.CharacterEncodingController"
        parent="requestLocalRepositoryAware">
    <property name="formView"><value>admin</value></property>
    <property name="successView"><value>redirect</value></property>
    <property name="commandName"><value>editCharacterEncodingForm</value></property>
    <property name="commandClass">
      <value>org.vortikal.web.controller.properties.CharacterEncodingCommand</value>
    </property>
  </bean>

  <bean id="manageCollectionListingHandler" 
    class="org.vortikal.web.controller.ResourceAwareParameterizableViewController"
    parent="requestLocalRepositoryAware">
    <property name="viewName" value="manageCollectionListing" />
  </bean>

  <bean id="previewCollectionHandler"
        class="org.vortikal.web.controller.ResourceServiceURLController"
        parent="requestLocalRepositoryAware">
    <property name="viewName" value="previewIframe" />
    <property name="service" ref="viewService"/>
  </bean>


  <bean id="previewIndexFileHandler" 
        class="org.vortikal.web.controller.ResourceServiceURLController"
        parent="requestLocalRepositoryAware">
    <property name="service" ref="collectionListingService" />
    <property name="viewName" value="previewIframe"/>
    <property name="childNames" ref="indexFileList" />
  </bean>

  <bean id="previewIndexHtmlHandler" 
        class="org.vortikal.web.controller.ResourceServiceURLController"
        parent="requestLocalRepositoryAware">
    <property name="service" ref="collectionListingService" />
    <property name="viewName" value="previewIframe"/>
    <property name="childName" value="index.html" />
  </bean>

  <bean id="previewIndexEngHtmlHandler" 
        class="org.vortikal.web.controller.ResourceServiceURLController"
        parent="requestLocalRepositoryAware">
    <property name="service" ref="collectionListingService" />
    <property name="viewName" value="previewIframe"/>
    <property name="childName" value="index-eng.html" />
  </bean>

  <bean id="previewIndexHtmHandler" 
    class="org.vortikal.web.controller.ResourceServiceURLController"
    parent="requestLocalRepositoryAware">
    <property name="service" ref="collectionListingService" />
    <property name="childName" value="index.htm" />
    <property name="viewName" value="previewIframe" />
  </bean>

  <bean id="previewHTMLHandler"
        class="org.vortikal.web.controller.ResourceServiceURLController"
        parent="requestLocalRepositoryAware">
    <property name="service" ref="viewService" />
    <property name="viewName" value="previewIframe" />
  </bean>

  <bean id="previewImageHandler"
        class="org.vortikal.web.controller.ResourceServiceURLController"
        parent="requestLocalRepositoryAware">
    <property name="viewName" value="previewImage" />
    <property name="service" ref="viewService"/>
  </bean>

  <bean id="previewTextHandler"
        class="org.vortikal.web.controller.DisplayResourceController"
        parent="requestLocalRepositoryAware">
    <property name="ignoreLastModified" value="true" />
    <property name="viewName" value="previewText" />
    <property name="streamToString" value="true" />
  </bean>

  <bean id="previewFallbackHandler"
        class="org.vortikal.web.controller.DisplayResourceController"
        parent="requestLocalRepositoryAware">
    <property name="ignoreLastModified" value="true" />
    <property name="viewName" value="previewFallback" />
  </bean>



  <!-- MANAGE views -->

  <bean id="adminViewResolver" 
        class="org.vortikal.web.view.wrapper.MappingViewResolver">
    <property name="views">
      <map>
        <entry key="manageCollectionListing" 
               value-ref="manageCollectionListingView" />
        <entry key="admin"
               value-ref="aboutView" />
        <entry key="redirectToAbout"
               value-ref="redirectToAboutView" />
        <entry key="permissions"
               value-ref="permissionsView" />
        <entry key="previewImage"
               value-ref="previewImageView" />
        <entry key="previewIframe"
               value-ref="previewIframeView" />
        <entry key="previewText"
               value-ref="previewTextView" />
        <entry key="previewFallback"
               value-ref="previewFallbackView" />
      </map>
    </property>
    <property name="viewWrapper" ref="manageViewWrapper" />
  </bean>

  <!-- Manage wrapping -->

  <bean id="manageViewWrapper" 
        class="org.vortikal.web.view.wrapper.FilteringViewWrapper">
    <description>
      This wrapper wraps manage views with the manage view layout
      items. It uses three filters for head, header and footer
    </description>
    <property name="propagateExceptions" value="true" />
    <property name="staticHeaders">
      <map>
        <entry key="Cache-Control" value="no-cache, must-revalidate" />
        <entry key="Expires" value="0" />
      </map>
    </property>
    <property name="contentFilters">
      <list>
        <ref bean="manageHeadContentFilter" />
        <ref bean="manageHeaderContentFilter" />
        <ref bean="manageFooterContentFilter" />
      </list>
    </property>
    <property name="referenceDataProviders">
      <list>
        <ref bean="leaveAdminLinkProvider" />
        <ref bean="logoutLinkProvider" />
        <ref bean="tabsProvider" />
        <ref bean="resourceContextProvider" />

        <ref bean="versionProvider" />

        <ref bean="resourceMenuProvider" /> 
        <ref bean="switchLocaleActionsProvider" />
        <ref bean="lockUnlockActionsProvider" />
        <ref bean="manageBreadCrumbProvider" />
        <ref bean="resourceTitleProvider" />
        <ref bean="adminHtmlTitleProvider" />
      </list>
    </property>
  </bean>

  <bean id="manageLinkProvider"
        class="org.vortikal.web.referencedata.provider.ResourceServiceURLProvider"
        parent="requestLocalRepositoryAware">
    <property name="modelName" value="manageLink" />
    <property name="service" ref="manageService" />
  </bean>

  <bean id="manageHeadContentFilter"
        class="org.vortikal.web.view.wrapper.HtmlHeadContentFilter">
    <description>
      This filter merges the output from the 'manageHeadView' view
      into the HTML head element.
    </description>
    <property name="view" ref="manageHeadView"/>
  </bean>

  <bean id="manageHeadView" parent="freemarkerView">
    <property name="attributesMap">
      <map>
        <entry key="cssURLs">
          <list>
            <value>${cssBaseURL}/basic.css</value>
            <value>${cssBaseURL}/tabs.css</value>
          </list>
        </entry>
        <entry key="jsURLs">
          <list>
            <value>${cssBaseURL}/browser-sniffer.js</value>
            <value>${cssBaseURL}/admin-enhancements.js</value>
          </list>
        </entry>
      </map>
    </property>
    <property name="url" value="layouts/head.ftl" />
  </bean>

  <bean id="manageHeaderContentFilter"
        class="org.vortikal.web.view.wrapper.HtmlHeaderContentFilter">
    <description>
      This filter merges the output from the
      'manageHeaderView' view into the beginning of the HTML
      body element (before any other body content).
    </description>
    <property name="view" ref="manageHeaderView"/>
  </bean>

  <bean id="manageHeaderView" parent="freemarkerView">
    <property name="attributesMap">
      <map>
        <entry key="helpURL" value="${helpURL}" />
      </map>
    </property>
    <property name="url" value="layouts/header.ftl" />
  </bean>

  <bean id="manageFooterContentFilter"
        class="org.vortikal.web.view.wrapper.HtmlFooterContentFilter">
    <description>
      This filter merges the output from the
      'manageFooterView' view into end of the HTML
      body element (after any other body content).
    </description>
    <property name="view" ref="manageFooterView"/>
  </bean>

  <bean id="manageFooterView" parent="freemarkerView">
    <property name="url" value="layouts/footer.ftl" />
  </bean>

  <!-- Views -->

  <bean id="previewImageView" parent="freemarkerView">
    <property name="url" value="pages/preview-image.ftl" />
  </bean>

  <bean id="previewIframeView" parent="freemarkerView">
    <property name="url" value="pages/preview-iframe.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="iframeJSProvider" />
      </list>
    </property>
  </bean>
  
  <bean id="previewTextView" parent="freemarkerView">
    <property name="url" value="pages/preview-text.ftl" />
  </bean>
  
  <bean id="previewFallbackView" parent="freemarkerView">
    <property name="url" value="pages/preview-unavailable.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="resourceDetailProvider" />
      </list>
    </property>
  </bean>

  <bean id="permissionsView" parent="freemarkerView">
    <property name="url" value="pages/permissions.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="adminCSSProvider" />
        <ref bean="adminACLProvider" />
      </list>
    </property>
  </bean>

  <bean id="redirectToAboutView"
    class="org.vortikal.web.view.RedirectView">
    <description>Standard HTTP redirect view to the manage service</description>
    <property name="referenceDataProviders">
      <list>
        <ref bean="redirectToAboutProvider" />
      </list>
    </property>
  </bean>

  <bean id="redirectToAboutProvider" 
        class="org.vortikal.web.referencedata.provider.RedirectProvider"
        parent="requestLocalRepositoryAware">
    <property name="redirectToService" ref="aboutResourceService" />
  </bean>


  <bean id="aboutView" parent="freemarkerView">
    <property name="url" value="pages/about.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="aboutResourceHandler" /> 
        <ref bean="adminCSSProvider" />
        <ref bean="resourceDetailProvider" />
      </list>
    </property>
  </bean>

  <bean id="manageCollectionListingView" parent="freemarkerView">
    <property name="url" value="pages/manage-collectionlisting.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="adminCSSProvider" />
        <ref bean="parentLinkProvider" /> 
        <ref bean="collectionMenuProvider" /> 
        <ref bean="manageCollectionlistingProvider" />
      </list>
    </property>
  </bean>

  <!-- Static files for manage service: -->
  <bean id="managetStaticResourceLocation" class="org.vortikal.web.StaticResourceLocation">
    <property name="uriPrefix" value="${cssBaseURL}" />
    <property name="resourceLocation" value="${cssResourceLocation}" />
  </bean>


  <!-- Manage specific providers -->

  <bean id="adminCSSProvider"
        class="org.vortikal.web.referencedata.provider.StaticModelDataProvider">
    <property name="modelDataMap">
      <map>
        <entry key="cssURLs"> 
          <list>
            <value>${cssBaseURL}/admin.css</value>
            <value>${cssBaseURL}/basic.css</value>
            <value>${cssBaseURL}/tabs.css</value>
          </list>
        </entry>
      </map>
    </property>
  </bean>

  <bean id="iframeJSProvider"
        class="org.vortikal.web.referencedata.provider.StaticModelDataProvider">
    <property name="modelDataMap">
      <map>
        <entry key="jsURLs"> 
          <list>
            <value>${cssBaseURL}/browser-sniffer.js</value>
            <value>${cssBaseURL}/admin-enhancements.js</value>
            <value>${cssBaseURL}/dynamic-resize-iframe.js</value>
          </list>
        </entry>
      </map>
    </property>
  </bean>
  
  <bean id="adminHtmlTitleProvider" parent="abstractHtmlTitleProvider">
    <property name="localizationKeys">
      <map>
        <entry key="name" value="title.title" />
        <entry key="http://www.uio.no/vortex/custom-properties:title" value="title.title" />
      </map>
    </property>
  </bean>


  <bean id="adminACLProvider" 
        class="org.vortikal.web.referencedata.provider.ACLProvider" 
        parent="requestLocalRepositoryAware">

    <property name="aclInheritanceService"  ref="aclInheritanceService" />
    <property name="aclEditServices">
      <map>
        <entry key-ref="PRIVILEGE_READ" value-ref="editReadPermissionsService" />
        <entry key-ref="PRIVILEGE_WRITE" value-ref="editWritePermissionsService" />
        <entry key-ref="PRIVILEGE_ALL" value-ref="editAdminPermissionsService" />
        <entry key-ref="PRIVILEGE_BIND" value-ref="editBindPermissionsService" />
        <entry key-ref="PRIVILEGE_READ_PROCESSED" value-ref="editReadProcessedPermissionsService" />
      </map>
    </property>
    <property name="groupingPrivilegePrincipalMap" ref="editPrivilegePrincipalMap" />
  </bean>

  <bean id="manageCollectionlistingProvider" 
        class="org.vortikal.web.referencedata.provider.CollectionListingProvider" 
        parent="requestLocalRepositoryAware" >
    <property name="browsingService" ref="manageService" />
    <property name="childInfoItems">
      <list>
        <value>name</value>
        <value>owner</value>
        <value>content-length</value>
        <value>locked</value>
        <value>last-modified</value>
      </list>
    </property>
    <property name="linkedServices">
      <map>
        <entry key="delete" value-ref="deleteResourceService" />
        <!-- entry key="duplicate" value-ref="duplicateResourceService" / -->
      </map>
    </property>
    <property name="retrieveForProcessing" value="false" />
  </bean>


  <bean id="resourceMenuProvider" 
    class="org.vortikal.web.view.components.menu.DefaultListMenuProvider">
    <constructor-arg ref="resourceActionServicesFactory" />
    <constructor-arg value="globalMenu" />
    <constructor-arg ref="repository.requestLocal" />
  </bean>

  <bean id="resourceActionServicesFactory"
    class="org.vortikal.context.CategoryResolvingFactoryBean">
    <property name="clazz" value="org.vortikal.web.service.Service" />
    <property name="category" value="resourceMenu" />
    <property name="comparator">
      <bean class="org.vortikal.web.service.ServiceAttributeComparator">
        <property name="attributeName" value="resourceMenuOrder" />
      </bean>
    </property>
  </bean>

  <bean id="manageBreadCrumbProvider" 
        class="org.vortikal.web.referencedata.provider.BreadCrumbProvider" 
        parent="requestLocalRepositoryAware">
    <description>
      Breadcrumb provider that generates links to the manage service
    </description>
    <property name="breadcrumbName" value="manageBreadCrumb" />
    <property name="service" ref="manageService"/>
  </bean>

  <bean id="versionProvider" 
        class="org.vortikal.web.referencedata.provider.ParameterizableBeanProvider" >
    <property name="modelName" value="version" />
    <property name="object">
      <bean class="org.vortikal.util.Version">
      </bean>
    </property>
  </bean>


  <!-- MANAGE assertions -->

  <bean id="requiresReadPermissionAssertion"
        parent="abstractResourcePrincipalPermissionAssertion">
    <property name="requiresAuthentication" value="true" />
    <property name="permission" ref="ACTION_READ" />
  </bean>

  <bean id="requiresWritePermissionAssertion" 
        parent="abstractResourcePrincipalPermissionAssertion">
    <property name="requiresAuthentication" value="true" />
    <property name="permission" ref="ACTION_WRITE" />
  </bean>

<!--  <bean id="writeParentPermissionAssertion"
        parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" ref="ACTION_CREATE" />
  </bean>
-->
  <bean id="deleteResourcePermissionAssertion"
        parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" ref="ACTION_DELETE" />
    <property name="requiresAuthentication" value="true" />
  </bean>

  <bean id="writePermissionAssertion"
        parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" ref="ACTION_WRITE" />
  </bean>

  <bean id="bindPermissionAssertion"
        parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" ref="ACTION_CREATE" />
  </bean>

  <bean id="writeACLPermissionAssertion"
        parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" ref="ACTION_WRITE_ACL" />
  </bean>


  <bean id="readProcessedPermissionAssertion"
        parent="abstractResourcePrincipalPermissionAssertion">
    <property name="requiresAuthentication" value="true" />
    <property name="permission" ref="ACTION_READ_PROCESSED" />
  </bean>

  <bean id="unlockPermissionAssertion"
        parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" ref="ACTION_UNLOCK" />
  </bean>

  <bean id="lockPermissionAssertion"
        parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" ref="ACTION_WRITE" />
  </bean>

  <bean id="delegateOwnershipPermissionAssertion"
        parent="abstractResourcePrincipalPermissionAssertion">
    <property name="permission" ref="ACTION_WRITE_ACL" />
  </bean>

  <bean id="resourceNotRootAssertion" 
        class="org.vortikal.web.service.ResourceURIAssertion">
    <property name="uri" value="/" />
    <property name="inverted" value="true" />
  </bean>

  <bean id="adminVrtxParameterRule" class="org.vortikal.web.service.RequestParameterAssertion">
    <property name="parameterName" value="vrtx" />
    <property name="parameterValue" value="admin" />
  </bean>


  <bean id="localeParameterEqualsNO"
        class="org.vortikal.web.service.RequestParameterAssertion">
    <property name="parameterName" value="locale" />
    <property name="parameterValue" value="no" />
  </bean>

  <bean id="localeParameterEqualsNN"
        class="org.vortikal.web.service.RequestParameterAssertion">
    <property name="parameterName" value="locale" />
    <property name="parameterValue" value="nn" />
  </bean>

  <bean id="localeParameterEqualsEN"
        class="org.vortikal.web.service.RequestParameterAssertion">
    <property name="parameterName" value="locale" />
    <property name="parameterValue" value="en" />
  </bean>


  <!-- MANAGE error handlers -->

  <bean id="abstractReferencedataProvidingErrorHandler"
        class="org.vortikal.web.DefaultErrorHandler" abstract="true">
    <property name="referenceDataProviders" ref="standardManageReferenceDataProviders" />
  </bean>

  <bean id="standardManageReferenceDataProviders" class="java.util.ArrayList">
    <constructor-arg>
      <list>
        <ref bean="adminCSSProvider" />
        <ref bean="leaveAdminLinkProvider" />
        <ref bean="tabsProvider" />
        <ref bean="resourceContextProvider" />
        <ref bean="versionProvider" />
        <ref bean="manageBreadCrumbProvider" />
        <ref bean="lockUnlockActionsProvider" />            
        <ref bean="switchLocaleActionsProvider" />
        <ref bean="resourceMenuProvider" /> 
        <ref bean="resourceDetailProvider" />
      </list>
    </constructor-arg>
  </bean>


  <bean id="defaultManageErrorHandler" class="org.vortikal.web.DefaultErrorHandler">
    <property name="service" ref="manageService" />
    <property name="errorViewName" value="defaultManageError" />
    <property name="referenceDataProviders" ref="standardManageReferenceDataProviders" />
    <property name="statusCodeMappings">
      <map>
        <entry key="org.vortikal.repository.ResourceNotFoundException" value="404" />
        <entry key="org.vortikal.repository.AuthorizationException" value="403" />
      </map>
    </property>
  </bean>


  <bean id="manageErrorViewResolver"
        class="org.vortikal.web.view.wrapper.MappingViewResolver">
    <property name="views">
      <map>
        <entry key="defaultManageError" value-ref="defaultManageErrorView" />
      </map>
    </property>
    <property name="viewWrapper" ref="manageViewWrapper" />
  </bean>

  <bean id="defaultManageErrorView" parent="freemarkerView">
    <property name="url" value="pages/error/default-manage-error.ftl" />
  </bean>


</beans>
