<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

  <!-- 
    To use: 

    1. add to ~/.vrtx-context.xml:

    <import resource="classpath:/vortikal/beans/standard-extensions/saml/saml.xml" />


    2. add to ~/.vrtx.properties:

    webAuthenticationChallenge = saml.authenticationHandler
    saml.authenticationURL = <login url>
    saml.logoutURL = <logout url>
    saml.idpCertificate = <encoded IDP certificate>
    saml.keystorePath = <path to keystore>
    saml.keystorePassword = <keystore password>
    saml.privateKeyAlias = <alias of private key entry in keystore>
    saml.privateKeyPassword = <password of private key entry>
  -->


  <bean id="saml.authenticationHandler" class="org.vortikal.security.web.saml.SamlAuthenticationHandler">
    <property name="principalFactory" ref="principalFactory" />
    <property name="serviceProviderURI" value="${saml.serviceProviderURI}" />
    <property name="certificateManager" ref="saml.certificateManager" />
    <property name="privateKeyAlias" value="${saml.privateKeyAlias}" />
    <property name="idpCertificate" value="${saml.idpCertificate}" />

    <property name="authenticationURL" value="${saml.authenticationURL}" />
    <property name="logoutURL" value="${saml.logoutURL}" />
    <property name="serviceIdentifier" value="${saml.serviceIdentifier}" />
  </bean>


  <bean id="saml.certificateManager" class="org.vortikal.security.web.saml.CertificateManager">
    <constructor-arg><value>${saml.keystorePath}</value></constructor-arg>
    <constructor-arg><value>${saml.keystorePassword}</value></constructor-arg>
    <constructor-arg><value>${saml.privateKeyPassword}</value></constructor-arg>
  </bean>

  <!-- 
    - This service serves the purpose of receiving "post-logout" requests from IDP 
    - and then redirecting to the resource from where logout request was initiated
  -->
  <bean id="saml.postLogoutService" class="org.vortikal.web.service.ServiceImpl">
    <property name="order" value="-97000" />
    <property name="assertions">
      <list>
        <bean class="org.vortikal.web.service.RequestPathAssertion">
          <property name="path" value="${saml.serviceProviderURI}" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="saml.authenticationHandler" />
  </bean>
</beans>
