<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd">
    <!-- Location of property config files -->
    <bean id="vrtx.configLocations"
        class="org.springframework.beans.factory.config.ListFactoryBean">
    <property name="sourceList">
      <list>
        <value>classpath:/vortikal/beans/vortikal.properties</value>
        <value>classpath:vortikal-custom.properties</value>
        <value>file://${user.home}/*vortikal.properties</value>
        <value>file://${user.home}/*vrtx.properties</value>
        <value>file://${user.home}/*.vrtx.properties</value>
        <value>file://${user.dir}/*.vrtx.properties</value>
        
        <!-- Uncomment for in-memory repo testing: -->
        <!--<value>classpath:/vortikal/beans/in-memory-vortikal.properties</value>-->
      </list>
    </property>
  </bean>
  <bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
    <property name="ignoreResourceNotFound" value="true" />
    <property name="locations" ref="vrtx.configLocations" />
  </bean>
 
  <!-- Main Vortikal configuration -->
  <import resource="classpath:/vortikal/beans/vhost/main.xml" />
  
  <!-- Vortikal extensions enabled by default: -->
  <import resource="classpath:/vortikal/beans/standard-extensions/transformXml/transformXml.xml" />
  <import resource="classpath:/vortikal/beans/standard-extensions/editXml/editXml.xml" />
  

  <!-- Misc -->
  <bean id="stdReqFilter" class="org.vortikal.web.filter.StandardRequestFilter"
        parent="defaultRequestFilterCategoryBean">
    <property name="urlReplacements" ref="stdReqFilter.urlReplacements" />
    <property name="xForwardedFor" value="${request.xForwardedFor}" />
    <property name="requestForwardFieldHeader" value="${request.forwardFieldHeader}" />
  </bean>

  <!-- Fix for resin 3.0 -->
  <bean id="stdReqFilter.urlReplacements"
        class="org.springframework.beans.factory.config.MapFactoryBean">
    <property name="sourceMap">
      <map>
        <entry key="\+" value="%2B" />
      </map>
    </property>
  </bean>
  
</beans>
