<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" 
  "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

  <!-- Standard View resolver -->

  <bean id="viewResolver" class="org.vortikal.web.view.wrapper.MappingViewResolver">
    <property name="views">
      <map>
        <entry key="httpOptions">
          <ref bean="httpOptionsView" />
        </entry>
        <entry key="collectionRedirect">
          <ref bean="collectionRedirectView" />
        </entry>
        <entry key="redirect">
          <ref bean="redirectView" />
        </entry>
        <entry key="redirectToManage">
          <ref bean="redirectToManageView" />
        </entry>
        <entry key="redirectToPermissions">
          <ref bean="redirectToPermissionView" />
        </entry>
        <entry key="redirectToPreviewCollection">
          <ref bean="redirectToPreviewCollectionView" />
        </entry>
        <entry key="displayResource">
          <ref bean="displayResourceView" />
        </entry>
        <entry key="transformRssResource">
          <ref bean="transformRssView" />
        </entry>
        <entry key="collectionListing">
          <ref bean="collectionListingView" />
        </entry>
        <entry key="displayHTMLResource" 
               value-ref="displayResourceView" />
        <entry key="transformXmlResource"
               value-ref="transformXmlView" />
      </map>
    </property>
    <property name="viewWrapper" ref="decoratorViewWrapper" />
  </bean>

  <bean id="decoratorViewWrapper" 
        class="org.vortikal.web.view.wrapper.DecoratingViewWrapper">
    <property name="templateResolver" ref="templateResolver" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="collectionListingHtmlTitleProvider" />
        <ref bean="viewResourceMenuProvider" />
        <ref bean="viewBreadCrumbProvider" />
      </list>
    </property>
  </bean>


  <!-- FIXME: make expandable -->
  <bean id="templateResolver"
        class="org.vortikal.web.view.wrapper.ServiceAwareTemplateResolver">
    <property name="templateManager" ref="templateManager" />
    <property name="serviceTemplatesMap">
      <map>
        <entry key-ref="webService" value="defaultTemplate" />
        <entry key-ref="collectionListingService" value="defaultTemplate" />
        <entry key-ref="manageService" value="manageTemplate" />
      </map>
    </property>
  </bean>


  <bean id="templateManager"
        class="org.vortikal.web.view.wrapper.BeanContextTemplateManager" />

  <bean id="defaultTemplate"
        class="org.vortikal.web.view.wrapper.StandardDecoratorTemplate">
    <property name="templateSource">
      <bean class="org.vortikal.web.view.wrapper.RepositoryTemplateSource">
        <property name="token" ref="trustedToken" />
        <property name="repository" ref="repository.requestLocal" />
        <property name="uri" value="/vrtx/decorators/view.html" />
      </bean>
    </property>
  </bean>


  <bean id="core:head"
        class="org.vortikal.web.view.wrapper.ModelAccessingDecoratorComponent">
    <property name="namespace" value="core" />
    <property name="key" value="head" />
  </bean>

  <bean id="core:title"
        class="org.vortikal.web.view.wrapper.ModelAccessingDecoratorComponent">
    <property name="namespace" value="core" />
    <property name="key" value="title" />
  </bean>

  <bean id="core:body"
        class="org.vortikal.web.view.wrapper.ModelAccessingDecoratorComponent">
    <property name="namespace" value="core" />
    <property name="key" value="body" />
  </bean>

  <bean id="view:breadcrumb"
        class="org.vortikal.web.view.wrapper.ViewRenderingDecoratorComponent">
    <property name="view">
      <bean id="breadCrumbView" parent="freemarkerView">
        <property name="url" value="pages/components/display-breadcrumb.ftl" />
      </bean>   
    </property>
  </bean>





<!-- Manage -->

  <bean id="manageViewWrapper" 
        class="org.vortikal.web.view.wrapper.DecoratingViewWrapper">
    <property name="templateResolver" ref="templateResolver" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="leaveAdminLinkProvider" />
        <ref bean="logoutLinkProvider" />
        <ref bean="tabsProvider" />
        <ref bean="resourceContextProvider" />
        <!--ref bean="versionProvider" /-->
        <ref bean="resourceMenuProvider" /> 
        <ref bean="switchLocaleActionsProvider" />
        <ref bean="lockUnlockActionsProvider" />
        <ref bean="manageBreadCrumbProvider" />
        <ref bean="resourceTitleProvider" />
        <ref bean="adminHtmlTitleProvider" />
      </list>
    </property>

  </bean>


  <bean id="manageTemplate"
        class="org.vortikal.web.view.wrapper.StandardDecoratorTemplate">
    <property name="templateSource">
      <bean class="org.vortikal.web.view.wrapper.URLTemplateSource">
        <property name="url" value="file:///Users/gormap/foo.html" />
      </bean>
    </property>
  </bean>


  <bean id="manage:head"
        class="org.vortikal.web.view.wrapper.ViewRenderingDecoratorComponent">
    <property name="view" ref="manageHeadView" />
  </bean>

  <bean id="manage:header"
        class="org.vortikal.web.view.wrapper.ViewRenderingDecoratorComponent">
    <property name="view" ref="manageHeaderView" />
  </bean>

  <bean id="manage:link"
        class="org.vortikal.web.view.wrapper.ViewRenderingDecoratorComponent">
    <property name="view" ref="manageLinkView" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="manageLinkProvider" />
      </list>
    </property>
  </bean>

  <bean id="manageLinkProvider"
        class="org.vortikal.web.referencedata.provider.ResourceServiceURLProvider"
        parent="requestLocalRepositoryAware">
    <property name="modelName" value="manageLink" />
    <property name="service" ref="manageService" />
  </bean>

  <bean id="manageLinkView" parent="freemarkerView">
    <property name="url" value="layouts/manage-link.ftl" />
  </bean>



</beans>
