<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

  <bean id="xmlTransformService" class="org.vortikal.web.service.ServiceImpl">

    <property name="parent" ref="displayResourceService" />
    <property name="order" value="100" />

    <property name="assertions">
      <list>
        <ref bean="contentTypeMatchesXml" />
        <bean class="org.vortikal.web.service.ResourcePropertyAssertion">
          <property name="namespace">
            <value>http://www.uio.no/vortex/custom-properties</value>
          </property>
          <property name="name">
            <value>transform-view</value>
          </property>
          <property name="value">
            <value>yes</value>
          </property>
        </bean>
      </list>
    </property>
    <property name="handler">
      <ref bean="displayXmlResourceHandler" />
    </property>

  </bean>

  <bean id="transformIndexXmlFileService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="collectionListingService" />
    <property name="order" value="0" />

    <property name="assertions">
      <list>
        <bean id="hasIndexXmlAssertion" class="org.vortikal.web.service.ResourceChildAssertion">
          <property name="childName" value="index.xml" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="displayIndexXmlHandler" />
    <property name="services">
      <list>
        <bean id="indexXmlIsHtmlService" class="org.vortikal.web.service.ServiceImpl">
          <property name="assertions">
            <list>
              <bean id="indexXmlIsHtmlAssertion" class="org.vortikal.web.service.ResourceChildAssertion">
                <property name="childName" value="index.xml" />
                <property name="trustedToken" ref="trustedToken" />
                <property name="repository" ref="repository" />
                <property name="childResourceAssertion">
                  <ref bean="contentTypeMatchesHtml" />
                </property>
              </bean>
            </list>
          </property>
          <property name="handler" ref="displayIndexXmlAsHtmlHandler" />
        </bean>
      </list>
    </property>
  </bean>                

  <bean id="transformIndexEngXmlFileService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="collectionListingService" />
    <property name="order" value="10" />

    <property name="assertions">
      <list>
        <bean id="hasIndexEngXmlAssertion" class="org.vortikal.web.service.ResourceChildAssertion">
          <property name="childName" value="index-eng.xml" />
        </bean>
      </list>
    </property>
    <property name="handler" ref="displayIndexEngXmlHandler" />
    <property name="services">
      <list>
        <bean id="indexEngXmlIsHtmlService" class="org.vortikal.web.service.ServiceImpl">
          <property name="assertions">
            <list>
              <bean id="indexEngXmlIsHtmlAssertion" class="org.vortikal.web.service.ResourceChildAssertion">
                <property name="childName" value="index-eng.xml" />
                <property name="trustedToken" ref="trustedToken" />
                <property name="repository" ref="repository" />
                <property name="childResourceAssertion">
                  <ref bean="contentTypeMatchesHtml" />
                </property>
              </bean>
            </list>
          </property>
          <property name="handler" ref="displayIndexEngXmlAsHtmlHandler" />
        </bean>
      </list>
    </property>
  </bean>                


  <!-- Add the XSL provider to the central list: -->
  <bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
    <property name="targetObject" ref="transformXmlView" />
    <property name="targetMethod" value="addReferenceDataProvider" />
    <property name="arguments">
      <list>
        <ref bean="dmsQueryXslProvider" />
      </list>
    </property>
  </bean>


</beans>
