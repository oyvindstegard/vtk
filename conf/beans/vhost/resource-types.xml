<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

  <!-- Resource -->

  <bean id="resourceResourceTypeDefinition" class="org.vortikal.repository.resourcetype.ResourceTypeDefinitionImpl">
    <property name="name" value="resource"/>
    <property name="namespace" ref="DEFAULT_NAMESPACE" />
    <!-- Properties valid for the resource type -->
    <property name="propertyTypeDefinitions">
      <list>
        <ref bean="ownerPropDef" />
        <ref bean="collectionPropDef" />
        <ref bean="creationTimePropDef" />
        <ref bean="contentLastModifiedPropDef" />
        <ref bean="contentModifiedByPropDef" />
        <ref bean="propertiesLastModifiedPropDef" />
        <ref bean="propertiesModifiedByPropDef" />
        <ref bean="contentTypePropDef" />
        <ref bean="contentLengthPropDef" />
      </list>
    </property>
  </bean>

  <bean id="ownerPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl">
    <property name="name" value="owner" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_OWNER_EDITABLE" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="ownerEvaluator" />
    <property name="validator" ref="ownerEvaluator" />
  </bean>

  <bean id="ownerEvaluator" class="org.vortikal.repository.resourcetype.property.OwnerEvaluator">
    <property name="principalManager" ref="principalManager" />
  </bean>
  
  <bean id="collectionPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl">
    <property name="name" value="collection" />
    <property name="type" ref="TYPE_BOOLEAN" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_UNEDITABLE" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="collectionEvaluator" /> 
  </bean>

  <bean id="collectionEvaluator" class="org.vortikal.repository.resourcetype.property.CollectionEvaluator" />

  <bean id="creationTimePropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl">
    <property name="name" value="creationTime" />
    <property name="type" ref="TYPE_DATE" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_ROOT_EDITABLE" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="creationTimeEvaluator" />
  </bean>

  <bean id="creationTimeEvaluator" 
        class="org.vortikal.repository.resourcetype.property.CreationTimeEvaluator" />


  <bean id="contentLastModifiedPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl">
    <property name="name" value="contentLastModified" />
    <property name="type" ref="TYPE_DATE" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_ROOT_EDITABLE" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="contentLastModifiedEvaluator" />
    <property name="contentModificationEvaluator" ref="contentLastModifiedEvaluator" />
  </bean>

  <bean id="contentLastModifiedEvaluator" class="org.vortikal.repository.resourcetype.property.ContentLastModifiedEvaluator" />
  
  <bean id="contentModifiedByPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl">
    <property name="name" value="contentModifiedBy" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_ROOT_EDITABLE" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="contentModifiedByEvaluator" />
    <property name="contentModificationEvaluator" ref="contentModifiedByEvaluator" />
  </bean>

  <bean id="contentModifiedByEvaluator" class="org.vortikal.repository.resourcetype.property.ContentModifiedByEvaluator" />
  
  <bean id="propertiesLastModifiedPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl">
    <property name="name" value="propertiesLastModified" />
    <property name="type" ref="TYPE_DATE" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_ROOT_EDITABLE" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="propertiesLastModifiedEvaluator" />
    <property name="propertiesModificationEvaluator" ref="propertiesLastModifiedEvaluator" />
  </bean>

  <bean id="propertiesLastModifiedEvaluator" class="org.vortikal.repository.resourcetype.property.PropertiesLastModifiedEvaluator" />
  
  <bean id="propertiesModifiedByPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl">
    <property name="name" value="propertiesModifiedBy" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_ROOT_EDITABLE" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="propertiesModifiedByEvaluator" />
    <property name="propertiesModificationEvaluator" ref="propertiesModifiedByEvaluator" />
  </bean>

  <bean id="propertiesModifiedByEvaluator" class="org.vortikal.repository.resourcetype.property.PropertiesModifiedByEvaluator" />
  
  <bean id="contentTypePropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl">
    <property name="name" value="contentType" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_EDITABLE" />
    <property name="mandatory" value="true" />
    <property name="createEvaluator" ref="contentTypeEvaluator" />
  </bean>

  <bean id="contentTypeEvaluator" class="org.vortikal.repository.resourcetype.property.ContentTypeEvaluator" />
  
  <bean id="contentLengthPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl">
    <property name="name" value="contentLength" />
    <property name="type" ref="TYPE_LONG" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_UNEDITABLE" />
    <property name="mandatory" value="false" />
  </bean>

  <!-- File resource -->

  <bean id="fileResourceTypeDefinition" class="org.vortikal.repository.resourcetype.ResourceTypeDefinitionImpl">
    <property name="name" value="file"/>
    <property name="namespace" ref="DEFAULT_NAMESPACE" />
    <property name="parentTypeDefinition" ref="resourceResourceTypeDefinition" />
  </bean>

  <!-- Text resource -->

  <bean id="textResourceTypeDefinition" class="org.vortikal.repository.resourcetype.ResourceTypeDefinitionImpl">
    <property name="name" value="text"/>
    <property name="namespace" ref="DEFAULT_NAMESPACE" />
    <property name="parentTypeDefinition" ref="fileResourceTypeDefinition" />
    <property name="propertyTypeDefinitions">
      <list>
        <ref bean="characterEncodingPropDef" />
        <ref bean="contentLocalePropDef" />
      </list>
    </property>
  </bean>

  <bean id="characterEncodingPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl">
    <property name="name" value="characterEncoding" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_EDITABLE" />
    <property name="mandatory" value="false" />
  </bean>

  <bean id="contentLocalePropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl">
    <property name="name" value="characterEncoding" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_EDITABLE" />
    <property name="mandatory" value="false" />
  </bean>

  <!-- Html resource -->

  <bean id="htmlResourceTypeDefinition" class="org.vortikal.repository.resourcetype.ResourceTypeDefinitionImpl">
    <property name="name" value="html"/>
    <property name="namespace" ref="CUSTOM_NAMESPACE" />
    <property name="parentTypeDefinition" ref="textResourceTypeDefinition" />
  </bean>

  <!-- XML resource -->

  <bean id="xmlResource" class="org.vortikal.repository.resourcetype.ResourceTypeDefinitionImpl">
    <property name="name" value="xml-resource"/>
    <property name="namespace" ref="CUSTOM_NAMESPACE" />
    <property name="parentTypeDefinition" ref="textResourceTypeDefinition" />
    <property name="assertions">
      <list>
        <ref bean="contentTypeMatchesXml" />
      </list>
    </property>
    <property name="propertyTypeDefinitions">
      <list>
        <ref bean="webEditPropDef" />
        <ref bean="transformViewPropDef" />
      </list>
    </property>
  </bean>

  <bean id="webEditPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl">
    <property name="name" value="web-edit" />
    <property name="type" ref="TYPE_STRING" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_EDITABLE" />
    <property name="mandatory" value="false" />
  </bean>

  <bean id="transformViewPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl">
    <property name="name" value="transform-view" />
    <property name="type" ref="TYPE_STRING" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_EDITABLE" />
    <property name="mandatory" value="false" />
  </bean>

  <!-- Managed XML resource -->

  <bean id="managedXmlResource" class="org.vortikal.repository.resourcetype.ResourceTypeDefinitionImpl">
    <property name="name" value="managed-xml"/>
    <property name="namespace" ref="CUSTOM_NAMESPACE" />
    <property name="parentTypeDefinition" ref="xmlResource" />
    <property name="assertions">
      <list>
        <ref bean="webEditable" />
        <ref bean="viewTransformable" />
      </list>
    </property>
    <property name="propertyTypeDefinitions">
      <list>
        <ref bean="schemaPropDef" />
      </list>
    </property>
  </bean>

  <bean id="schemaPropDef" class="org.vortikal.repository.resourcetype.PropertyTypeDefinitionImpl">
    <property name="name" value="schema" />
    <property name="protectionLevel" ref="PROTECTION_LEVEL_UNEDITABLE" />
    <property name="mandatory" value="false" />
    <property name="contentModificationEvaluator" ref="schemaEvaluator" />
  </bean>

  <bean id="schemaEvaluator"
        class="org.vortikal.repository.resourcetype.property.XMLSchemaEvaluator" />

<!-- CONSTANTS -->

  <bean id="DEFAULT_NAMESPACE"
        class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
    <property name="staticField"
              value="org.vortikal.repository.Namespace.DEFAULT_NAMESPACE" />
  </bean>

  <bean id="CUSTOM_NAMESPACE"
        class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
    <property name="staticField"
              value="org.vortikal.repository.Namespace.CUSTOM_NAMESPACE" />
  </bean>

  <bean id="PROTECTION_LEVEL_EDITABLE"
        class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
    <property name="staticField"
              value="org.vortikal.repository.resourcetype.PropertyType.PROTECTION_LEVEL_EDITABLE" />
  </bean>

  <bean id="PROTECTION_LEVEL_PROTECTED"
        class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
    <property name="staticField"
              value="org.vortikal.repository.resourcetype.PropertyType.PROTECTION_LEVEL_PROTECTED" />
  </bean>

  <bean id="PROTECTION_LEVEL_OWNER_EDITABLE"
        class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
    <property name="staticField"
              value="org.vortikal.repository.resourcetype.PropertyType.PROTECTION_LEVEL_OWNER_EDITABLE" />
  </bean>

  <bean id="PROTECTION_LEVEL_ROOT_EDITABLE"
        class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
    <property name="staticField"
              value="org.vortikal.repository.resourcetype.PropertyType.PROTECTION_LEVEL_ROOT_EDITABLE" />
  </bean>

  <bean id="PROTECTION_LEVEL_UNEDITABLE"
        class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
    <property name="staticField"
              value="org.vortikal.repository.resourcetype.PropertyType.PROTECTION_LEVEL_UNEDITABLE" />
  </bean>

  <bean id="TYPE_STRING"
        class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
    <property name="staticField"
              value="org.vortikal.repository.resourcetype.PropertyType.TYPE_STRING" />
  </bean>

  <bean id="TYPE_DATE"
        class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
    <property name="staticField"
              value="org.vortikal.repository.resourcetype.PropertyType.TYPE_DATE" />
  </bean>

  <bean id="TYPE_BOOLEAN"
        class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
    <property name="staticField"
              value="org.vortikal.repository.resourcetype.PropertyType.TYPE_BOOLEAN" />
  </bean>

  <bean id="TYPE_LONG"
        class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
    <property name="staticField"
              value="org.vortikal.repository.resourcetype.PropertyType.TYPE_LONG" />
  </bean>

  <!-- ASSERTIONS -->

  <bean id="collection"
        class="org.vortikal.web.service.ResourceIsCollectionAssertion" />

  <bean id="webEditable" 
        class="org.vortikal.web.service.ResourcePropertyAssertion">
    <!--property name="namespace" ref="CUSTOM_NAMESPACE" /-->
    <property name="namespace" value="http://www.uio.no/vortex/custom-properties" />
    <property name="name" value="web-edit" />
    <property name="value" value="yes" />
  </bean>
                    
  <bean id="viewTransformable" 
        class="org.vortikal.web.service.ResourcePropertyAssertion">
    <property name="namespace" value="http://www.uio.no/vortex/custom-properties" />
    <!--property name="namespace" ref="CUSTOM_NAMESPACE" /-->
    <property name="name" value="transform-view" />
    <property name="value" value="yes" />
  </bean>


</beans>

