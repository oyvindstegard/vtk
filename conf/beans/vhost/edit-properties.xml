<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" 
"http://www.springframework.org/dtd/spring-beans.dtd">

<beans>


  <bean id="editPropertiesService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="manageService" />
    <!--property name="order"><value>9600</value></property-->
    <property name="categories">
      <set>
        <value>tabMenu</value>
      </set>
    </property>
    <property name="attributes">
      <map>
        <entry key="tabOrder"><value type="java.lang.Integer">400</value></entry>
      </map>
    </property>
    <property name="assertions">
      <list>
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName">
            <value>mode</value>
          </property>
          <property name="parameterValue">
            <value>edit-properties</value>
          </property>
        </bean>      
      </list>
    </property>
    <property name="services">
      <list>
        <ref bean="editStandardPropertiesService" />
        <ref bean="editUhtmlPropertiesService" />
      </list>
    </property>
    <property name="handler" ref="editStandardPropertiesHandler" />
  </bean>        

  <bean id="editStandardPropertiesService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="editPropertiesService" />
    <property name="assertions">
      <list>
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="group" />
          <property name="parameterValue" value="standard" />
        </bean>      
      </list>
    </property>
    <property name="handler" ref="editStandardPropertiesHandler" />
  </bean>        

  <bean id="editUhtmlPropertiesService" class="org.vortikal.web.service.ServiceImpl">
    <property name="parent" ref="editPropertiesService" />
    <property name="assertions">
      <list>
        <bean class="org.vortikal.web.service.ResourcePropertyAssertion">
          <property name="namespace" ref="WEB_3_0_NAMESPACE" />
          <property name="name" value="description" />
          <property name="value" value="yes" />
        </bean>
        <bean class="org.vortikal.web.service.RequestParameterAssertion">
          <property name="parameterName" value="group" />
          <property name="parameterValue" value="uhtml" />
        </bean>      
      </list>
    </property>
    <property name="handler" ref="editUhtmlPropertiesHandler" />
  </bean>        
  


  <bean id="editStandardPropertiesHandler" 
    class="org.vortikal.web.controller.properties.PropertyEditController"
    parent="requestLocalRepositoryAware">
    <property name="propertyTypeDefinitions">
      <list>
        <ref bean="ownerPropDef" />
        <ref bean="createdByPropDef" />
        <ref bean="collectionPropDef" />
        <ref bean="creationTimePropDef" />
        <ref bean="contentLastModifiedPropDef" />
        <ref bean="contentModifiedByPropDef" />
        <ref bean="propertiesLastModifiedPropDef" />
        <ref bean="propertiesModifiedByPropDef" />

        <ref bean="keywordsPropDef" />
        <ref bean="descriptionPropDef" />

        <ref bean="userSetCharacterEncodingPropDef" />
        <ref bean="guessedCharacterEncodingPropDef" />
        <ref bean="characterEncodingPropDef" />
      </list>
    </property>
    <property name="modelKey" value="standardPropList" />
    <property name="service" ref="editStandardPropertiesService" />

    <property name="valueFactory" ref="valueFactory" />
    <property name="formView" value="editProperties" />
    <property name="successView" value="editProperties" />

    <property name="commandName" value="form" />
    <property name="dateFormat" value="dd.MM.yyyy HH:mm:ss" />
    <!--
    <property name="commandClass">
      <value>org.vortikal.web.controller.properties.ResourceEnumerationPropertyCommand</value>
    </property>
    -->
  </bean>

  <bean id="editUhtmlPropertiesHandler" 
    class="org.vortikal.web.controller.properties.PropertyEditController"
    parent="requestLocalRepositoryAware">
    <property name="propertyTypeDefinitions">
      <list>
        <ref bean="unitPropDef" />
        <ref bean="topicPropDef" />
      </list>
    </property>
    <property name="modelKey" value="uhtmlPropList" />
    <property name="service" ref="editUhtmlPropertiesService" />
    <property name="valueFactory" ref="valueFactory" />
    <property name="formView" value="editProperties" />
    <property name="successView" value="editProperties" />

    <property name="commandName" value="form" />
    <property name="dateFormat" value="dd.MM.yyyy HH:mm:ss" />
    <!--
    <property name="commandClass">
      <value>org.vortikal.web.controller.properties.ResourceEnumerationPropertyCommand</value>
    </property>
    -->
  </bean>

  <bean id="editPropertiesView" parent="freemarkerView">
    <property name="url" value="pages/properties-listing.ftl" />
    <property name="referenceDataProviders">
      <list>
        <ref bean="editStandardPropertiesHandler" /> <!-- (Also a reference data provider) -->
        <ref bean="editUhtmlPropertiesHandler" />
        <ref bean="adminCSSProvider" />
      </list>
    </property>
  </bean>



  <bean id="adminViewResolver2" 
        parent="adminViewResolver">
    <property name="views">
      <map>
        <entry key="editProperties" value-ref="editPropertiesView" />
      </map>
    </property>
  </bean>


</beans>
